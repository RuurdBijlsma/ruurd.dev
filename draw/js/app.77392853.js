(function(t){function e(e){for(var n,o,c=e[0],r=e[1],l=e[2],u=0,d=[];u<c.length;u++)o=c[u],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&d.push(i[o][0]),i[o]=0;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n]);h&&h(e);while(d.length)d.shift()();return s.push.apply(s,l||[]),a()}function a(){for(var t,e=0;e<s.length;e++){for(var a=s[e],n=!0,c=1;c<a.length;c++){var r=a[c];0!==i[r]&&(n=!1)}n&&(s.splice(e--,1),t=o(o.s=a[0]))}return t}var n={},i={app:0},s=[];function o(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=t,o.c=n,o.d=function(t,e,a){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(a,n,function(e){return t[e]}.bind(null,n));return a},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/draw/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],r=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var h=r;s.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"034f":function(t,e,a){"use strict";var n=a("85ec"),i=a.n(n);i.a},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("draw-canvas",{staticClass:"my-dc"})],1)},s=[],o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"draw-canvas"},[a("div",{staticClass:"canvas-container",on:{keypress:t.handleKey}},[a("canvas",{ref:"canvas",staticClass:"canvas",attrs:{width:t.canvasWidth,height:t.canvasHeight},on:{touchstart:t.startTouch,mousedown:t.startMove,resize:t.canvasResize}},[t._v("Canvas is not supported ")])]),a("div",{staticClass:"controls"},[a("div",{staticClass:"colors"},[a("div",{staticClass:"selected-color",style:"background-color: "+t.activeRgb}),a("div",{staticClass:"color-grid"},t._l(t.colors,(function(e,n){return a("div",{key:n,staticClass:"color-row"},t._l(e,(function(e){var n=e[0],i=e[1],s=e[2],o=e[3];return a("div",{key:n+i+s+o,staticClass:"single-color",style:"background-color: rgb("+n+","+i+","+s+")",on:{click:function(e){return t.selectColor(n,i,s,o)}}})})),0)})),0)]),a("div",{staticClass:"tools"},[a("div",{staticClass:"brush",attrs:{active:"brush"===this.activeTool},on:{click:function(e){return t.selectTool("brush")}}}),a("div",{staticClass:"fill",attrs:{active:"fill"===this.activeTool},on:{click:function(e){return t.selectTool("fill")}}}),a("div",{staticClass:"erase",attrs:{active:"eraser"===this.activeTool},on:{click:function(e){return t.selectTool("eraser")}}})]),a("div",{staticClass:"brush-sizes"},t._l(t.brushSizes,(function(e){return a("div",{key:e,style:"\n                    height: "+e+"px;\n                    width: "+e+"px;\n                    background-color: "+t.activeRgb+";\n                    margin-top: "+(30-e/2)+"px;\n                ",attrs:{active:t.activeBrush===e},on:{click:function(a){return t.selectBrush(e)}}})})),0),a("div",{staticClass:"clear-canvas",on:{click:t.clearCanvas}})])])},c=[],r=(a("99af"),a("cb29"),a("4de4"),a("fb6a"),a("3835")),l=a("2909"),h=a("b85c"),u=(a("a434"),a("d4ec")),d=a("bee2"),v=function(){function t(){Object(u["a"])(this,t),this.reset()}return Object(d["a"])(t,[{key:"addCommand",value:function(t){this.commands.splice(this.stackPosition+1,this.commands.length),this.commands.push(t),this.stackPosition=this.commands.length-1}},{key:"executeCommand",value:function(t){this.addCommand(t),t.execute()}},{key:"undo",value:function(){this.commands.length>0&&this.stackPosition>=0?this.commands[this.stackPosition--].undo():console.log("Cant undo")}},{key:"redo",value:function(){this.stackPosition+1<this.commands.length?this.commands[++this.stackPosition].execute():console.log("Cant redo")}},{key:"reset",value:function(){this.commands=[],this.stackPosition=-1}}]),t}(),f=new v,b=(a("c975"),a("262e")),g=a("2caf"),p=function(){function t(){Object(u["a"])(this,t)}return Object(d["a"])(t,[{key:"undo",value:function(){}},{key:"execute",value:function(){}}]),t}(),m=function(t){Object(b["a"])(a,t);var e=Object(g["a"])(a);function a(t,n){var i;return Object(u["a"])(this,a),i=e.call(this),i.drawables=t,i.drawable=n,i}return Object(d["a"])(a,[{key:"undo",value:function(){this.drawables.splice(this.drawables.indexOf(this.drawable),1)}},{key:"execute",value:function(){this.drawables.push(this.drawable)}}]),a}(p),y=function(t){Object(b["a"])(a,t);var e=Object(g["a"])(a);function a(t){var n;return Object(u["a"])(this,a),n=e.call(this),n.drawables=t,n.drawablesBackup=Object(l["a"])(t),n}return Object(d["a"])(a,[{key:"undo",value:function(){var t;(t=this.drawables).push.apply(t,Object(l["a"])(this.drawablesBackup))}},{key:"execute",value:function(){this.drawables.splice(0,this.drawables.length)}}]),a}(p),w={name:"DrawCanvas",props:{},data:function(){return{activeTool:"brush",activeColor:[0,0,0,255],activeBrush:13,colors:[[[255,255,255,255],[193,193,193,255],[239,19,11,255],[255,113,0,255],[255,228,0,255],[0,204,0,255],[0,178,255,255],[35,31,211,255],[163,0,186,255],[211,124,170,255],[160,82,45]],[[0,0,0,255],[76,76,76,255],[116,11,7,255],[194,56,0,255],[232,162,0,255],[0,85,16,255],[0,86,158,255],[14,8,101,255],[85,0,105,255],[167,85,116,255],[99,48,13,255]]],brushSizes:[7,13,25,50],fingers:{},context:null,drawables:[],animationId:-1,canvasWidth:10,canvasHeight:10,commands:[],commandIndex:0}},mounted:function(){console.log(f);var t=this.$refs.canvas;this.context=t.getContext("2d"),this.animationId=requestAnimationFrame(this.render),this.canvasResize(),window.addEventListener("resize",this.canvasResize,!1),document.addEventListener("keyup",this.handleKey,!1),document.addEventListener("mousemove",this.move,!1),document.addEventListener("touchmove",this.moveTouch,!1),document.addEventListener("mouseup",this.endMove,!1),document.addEventListener("touchend",this.endTouch,!1),this.updateCursor(this.activeBrush,this.activeColor,this.activeTool)},beforeDestroy:function(){console.log("Destroying"),window.removeEventListener("resize",this.canvasResize),document.removeEventListener("keyup",this.handleKey),document.removeEventListener("mousemove",this.move),document.removeEventListener("touchmove",this.moveTouch),document.removeEventListener("mouseup",this.endMove),document.removeEventListener("touchend",this.endTouch),cancelAnimationFrame(this.animationId),f.reset()},methods:{render:function(){var t;this.context.fillStyle="rgb(255,255,255)",this.context.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.context.lineCap="round",this.context.lineJoin="round";var e,a=Object(h["a"])(this.drawables);try{for(a.s();!(e=a.n()).done;){var n=e.value;switch(n.type){case"line":this.context.beginPath(),this.context.strokeStyle=this.toRgb.apply(this,Object(l["a"])(n.color)),this.context.lineWidth=n.brush;var i,s=Object(h["a"])(n.line);try{for(s.s();!(i=s.n()).done;){var o=Object(r["a"])(i.value,2),c=o[0],u=o[1];this.context.lineTo(c,u)}}catch(d){s.e(d)}finally{s.f()}this.context.stroke();break;case"square":this.context.fillStyle=this.toRgb.apply(this,Object(l["a"])(n.color)),(t=this.context).fillRect.apply(t,Object(l["a"])(n.position).concat(Object(l["a"])(n.shape)));break;case"fill":this.context.drawImage(n.canvas,0,0);break;default:console.warn("No case set");break}}}catch(d){a.e(d)}finally{a.f()}this.animationId=requestAnimationFrame(this.render)},startTool:function(t,e,a){if("brush"===this.activeTool){var n=[[t,e]],i={type:"line",brush:this.activeBrush,color:this.activeColor,line:n};a.drawable=i,this.drawables.push(i)}else if("eraser"===this.activeTool){var s=[[t,e]],o={type:"line",brush:this.activeBrush,color:[255,255,255,255],line:s};a.drawable=o,this.drawables.push(o)}else"fill"===this.activeTool&&console.log("fill start")},moveTool:function(t,e,a){"brush"===this.activeTool||"eraser"===this.activeTool?a.drawable.line.push([t,e]):"fill"===this.activeTool&&console.log("fill move")},endTool:function(t,e,a){if("brush"===this.activeTool||"eraser"===this.activeTool)a.drawable.line.push([t,e]),f.addCommand(new m(this.drawables,a.drawable)),delete a.drawable;else if("fill"===this.activeTool){var n=performance.now();this.fill3(t,e,this.activeColor),console.log("fill done",performance.now()-n)}},getNeighbours:function(t,e,a,n){var i,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return i=s?[[a-o,n+0],[a+o,n+0],[a+0,n-o],[a+0,n+o],[a-o,n+o],[a+o,n+o],[a+o,n-o],[a-o,n-o]]:[[a-o,n+0],[a+o,n+0],[a+0,n-o],[a+0,n+o]],i.filter((function(i){var s=Object(r["a"])(i,2),o=s[0],c=s[1];return!(o===a&&c===n)&&o>=0&&o<t&&c>=0&&c<e}))},colorEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},colorDistance:function(t,e){return Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])+Math.abs(t[2]-e[2])+Math.abs(t[3]-e[3])},fill3:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.activeColor,n=this.context.getImageData(0,0,this.canvasWidth,this.canvasHeight),i=document.createElement("canvas");i.width=this.canvasWidth,i.height=this.canvasHeight;var s=i.getContext("2d"),o=s.getImageData(0,0,this.canvasWidth,this.canvasHeight),c=4*(e*this.canvasWidth+t),l=n.data.slice(c,c+4);if(!this.colorEquals(l,a)){var u={type:"fill",canvas:i,color:a};if(f.executeCommand(new m(this.drawables,u)),0===this.drawables.filter((function(t){return"line"===t.type})).length)return s.fillStyle="rgba(".concat(a[0],",").concat(a[1],",").concat(a[2],",").concat(a[3],")"),void s.fillRect(0,0,this.canvasWidth,this.canvasHeight);var d=function(t){return n.data[t+0]===l[0]&&n.data[t+1]===l[1]&&n.data[t+2]===l[2]&&n.data[t+3]===l[3]},v=4*this.canvasWidth,b=function(t){var e,i=[t,t+v,t-v,t+4,t-4,t+v+4,t-v+4,t+v-4,t-v-4].filter((function(t){return t<n.data.length&&t>=0})),s=Object(h["a"])(i);try{for(s.s();!(e=s.n()).done;){var c=e.value;o.data[c+0]=a[0],o.data[c+1]=a[1],o.data[c+2]=a[2],o.data[c+3]=a[3]}}catch(r){s.e(r)}finally{s.f()}n.data[t+0]=a[0],n.data[t+1]=a[1],n.data[t+2]=a[2],n.data[t+3]=a[3]},g=[[t,e]];while(g.length){var p=void 0,y=void 0,w=g.pop(),C=Object(r["a"])(w,2),k=C[0],T=C[1];c=4*(T*this.canvasWidth+k);while(d(c))T--,c=4*(T*this.canvasWidth+k);p=!1,y=!1;while(1){if(T++,c=4*(T*this.canvasWidth+k),!(T<this.canvasHeight&&d(c)))break;b(c),k>0&&(d(c-4)?p||(g.push([k-1,T]),p=!0):p&&(p=!1)),k<this.canvasWidth-1&&(d(c+4)?y||(g.push([k+1,T]),y=!0):y&&(y=!1)),c+=v}}s.putImageData(o,0,0)}},clearCanvas:function(){f.executeCommand(new y(this.drawables))},selectColor:function(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255;this.activeColor=[t,e,a,n],this.updateCursor(this.activeBrush,this.activeColor,this.activeTool)},selectTool:function(t){this.activeTool=t,this.updateCursor(this.activeBrush,this.activeColor,this.activeTool)},selectBrush:function(t){this.activeBrush=t,this.updateCursor(this.activeBrush,this.activeColor,this.activeTool)},updateCursor:function(t,e,a){"eraser"===a&&(e=[255,255,255,255]),"fill"===a&&(t=2);var n=document.createElement("canvas"),i=n.getContext("2d"),s=10;n.width=t+2*s,n.height=t+2*s,console.log(n.width,n.height),i.fillStyle=this.toRgb.apply(this,Object(l["a"])(e)),i.lineWidth=s,i.arc(n.width/2,n.height/2,t/2,0,2*Math.PI),i.strokeStyle="rgba(128,128,128,0.5)",i.stroke(),i.fill();var o=n.toDataURL("image/png");this.$refs.canvas.style.cursor="url(".concat(o,") ").concat(Math.floor(n.width/2)," ").concat(Math.floor(n.height/2),", auto")},handleKey:function(t){"KeyZ"===t.code&&t.ctrlKey&&t.shiftKey?f.redo():"KeyZ"===t.code&&t.ctrlKey?f.undo():"KeyF"===t.code?this.selectTool("fill"):"KeyE"===t.code?this.selectTool("eraser"):"KeyB"===t.code?this.selectTool("brush"):"Delete"===t.code&&this.clearCanvas()},startMove:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;console.log("startMove",e),this.fingers[e]||(this.fingers[e]={});var a=this.fingers[e];a.down=!0;var n=this.$refs.canvas.getBoundingClientRect(),i=n.top,s=n.left,o=t.pageX-s,c=t.pageY-i;this.startTool(o,c,a)},move:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(console.log("move",e),this.fingers[e]&&this.fingers[e].down){var a=this.$refs.canvas.getBoundingClientRect(),n=a.top,i=a.left,s=t.pageX-i,o=t.pageY-n;this.moveTool(s,o,this.fingers[e])}},endMove:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(console.log("endMove",e),this.fingers[e]){if(this.fingers[e].down){var a=this.$refs.canvas.getBoundingClientRect(),n=a.top,i=a.left,s=t.pageX-i,o=t.pageY-n;this.endTool(s,o,this.fingers[e])}this.fingers[e].down=!1}},startTouch:function(t){var e,a=Object(h["a"])(t.touches);try{for(a.s();!(e=a.n()).done;){var n=e.value;this.startMove(n,n.identifier)}}catch(i){a.e(i)}finally{a.f()}},moveTouch:function(t){var e,a=Object(h["a"])(t.touches);try{for(a.s();!(e=a.n()).done;){var n=e.value;this.move(n,n.identifier)}}catch(i){a.e(i)}finally{a.f()}},endTouch:function(t){var e,a=Object(h["a"])(t.changedTouches);try{for(a.s();!(e=a.n()).done;){var n=e.value;this.endMove(n,n.identifier)}}catch(i){a.e(i)}finally{a.f()}},canvasResize:function(){console.log("resize");var t=this.$refs.canvas,e=t.getBoundingClientRect(),a=e.width,n=e.height;this.canvasWidth=a,this.canvasHeight=n},toRgb:function(t,e,a,n){return"rgba(".concat(t,",").concat(e,",").concat(a,",").concat(n,")")}},computed:{activeRgb:function(){return this.toRgb.apply(this,Object(l["a"])(this.activeColor))}}},C=w,k=(a("fd4e"),a("2877")),T=Object(k["a"])(C,o,c,!1,null,"763dc0b6",null),O=T.exports,j={name:"App",components:{DrawCanvas:O}},x=j,R=(a("034f"),Object(k["a"])(x,i,s,!1,null,null,null)),M=R.exports;n["a"].config.productionTip=!1,new n["a"]({render:function(t){return t(M)}}).$mount("#app")},"85ec":function(t,e,a){},fd4e:function(t,e,a){"use strict";var n=a("fd66"),i=a.n(n);i.a},fd66:function(t,e,a){}});
//# sourceMappingURL=app.77392853.js.map