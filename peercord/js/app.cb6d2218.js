(function(e){function t(t){for(var r,i,c=t[0],a=t[1],u=t[2],d=0,m=[];d<c.length;d++)i=c[d],o[i]&&m.push(o[i][0]),o[i]=0;for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r]);l&&l(t);while(m.length)m.shift()();return s.push.apply(s,u||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],r=!0,c=1;c<n.length;c++){var a=n[c];0!==o[a]&&(r=!1)}r&&(s.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={app:0},s=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/peercord/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],a=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=a;s.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var r=n("64a9"),o=n.n(r);o.a},"0f6a":function(e,t,n){},1:function(e,t){},2:function(e,t){},2353:function(e,t,n){"use strict";var r=n("0f6a"),o=n.n(r);o.a},3:function(e,t){},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var r=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},s=[],i=(n("034f"),n("2877")),c={},a=Object(i["a"])(c,o,s,!1,null,null,null),u=a.exports,l=n("9483");Object(l["a"])("".concat("/peercord/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var d=n("43f9"),m=n.n(d),f=(n("51de"),n("e094"),n("8c4f")),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},[n("server-browser",{staticClass:"browser",attrs:{server:e.$route.query.server,room:e.$route.query.room},on:{connect:e.connected,disconnect:e.disconnected}}),n("md-content",{staticClass:"main-content"},[n("h3",[e._v("Your name: "+e._s(e.userName))]),e.messages.length>0?n("md-list",{staticClass:"messages-list"},e._l(e.messages,function(t){return n("md-list-item",{staticClass:"message-item"},[n("div",{staticClass:"md-list-item-text"},[n("span",[e._v(e._s(t.from))]),n("span",[e._v(e._s(t.text))])])])}),1):e._e(),n("md-field",[n("label",[e._v("Type a message")]),n("md-input",{on:{keypress:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.sendMessage(e.message),e.message=""}},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}})],1)],1)],1)},h=[],v=(n("6b54"),n("a481"),n("96cf"),n("3b8d")),g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"server-browser"},[n("md-content",{staticClass:"content"},[n("md-list",{staticClass:"server-list"},[n("md-list-item",[n("div",{staticClass:"md-list-item-text"},[n("md-field",[n("label",[e._v("Add new server")]),n("md-input",{model:{value:e.serverIp,callback:function(t){e.serverIp=t},expression:"serverIp"}})],1)],1),n("md-button",{staticClass:"md-icon-button md-list-action",attrs:{type:"submit"},on:{click:function(t){e.addServer(e.serverIp),e.serverIp=""}}},[n("md-icon",[e._v("add")])],1)],1),e._l(e.servers,function(t){return n("md-list-item",{key:t.ip,attrs:{"md-expand":t.online,"md-expanded":t.online}},[t.loading?n("md-icon",{staticClass:"rotate",attrs:{title:"Checking connection to "+t.ip}},[e._v("\n                    cached\n                ")]):t.online?n("md-icon",{class:t.ip===e.connectedServer.ip?"md-primary":"",attrs:{title:t.ip+" is online"}},[e._v("rss_feed\n                ")]):n("md-icon",{attrs:{title:t.ip+" is offline"}},[e._v("error_outline")]),n("div",{staticClass:"md-list-item-text",attrs:{title:t.ip}},[e._v("\n                    "+e._s(t.ip)+"\n                ")]),t.ip!==e.connectedServer.ip?n("md-button",{staticClass:"md-icon-button md-list-action",attrs:{title:"Remove "+t.ip+" from list"},on:{click:function(n){return e.removeServer(t.ip)}}},[n("md-icon",[e._v("delete")])],1):e._e(),n("md-list",{attrs:{slot:"md-expand"},slot:"md-expand"},[n("md-list-item",{staticClass:"md-inset"},[n("div",{staticClass:"md-list-item-text"},[n("md-field",[n("label",[e._v("Create room")]),n("md-input",{attrs:{required:""},model:{value:e.roomName,callback:function(t){e.roomName=t},expression:"roomName"}}),n("span",{staticClass:"md-error"},[e._v("Room cannot be empty")])],1)],1),n("md-button",{staticClass:"md-icon-button md-list-action md-primary",attrs:{title:"Connect to "+t.ip+"#"+e.roomName},on:{click:function(n){e.connectServer(t,e.roomName),e.roomName=""}}},[n("md-icon",[e._v("keyboard_arrow_right")])],1)],1),e._l(t.rooms,function(r){return n("md-list-item",{key:r.name,staticClass:"md-inset"},[n("div",{staticClass:"md-list-item-text",attrs:{title:t.ip+"#"+r.name}},[n("span",[e._v(e._s(r.name))]),t.online?n("span",[e._v("Users online: "+e._s(r.userCount))]):e._e()]),r.name===t.room&&t.ip===e.connectedServer.ip?n("md-button",{staticClass:"md-icon-button md-list-action",attrs:{title:"Disconnect from "+t.ip+"#"+r.name},on:{click:function(n){return e.disconnectServer(t.ip)}}},[n("md-icon",[e._v("stop")])],1):n("md-button",{staticClass:"md-icon-button md-list-action md-primary",attrs:{title:"Connect to "+t.ip+"#"+r.name},on:{click:function(n){return e.connectServer(t,r.name)}}},[n("md-icon",[e._v("keyboard_arrow_right")])],1)],1)})],2)],1)})],2)],1)],1)},w=[],k=(n("20d6"),n("7514"),n("ac6a"),n("ac4d"),n("8a81"),n("768b")),b=n("d225"),y=n("b0b4"),C=n("051a"),_=n.n(C),S=n("8055"),x=n.n(S),O=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(b["a"])(this,e),this.wrtc=n,this.trickle=t,this.socket=null,this.url="",this.peers={},this._events={},this.printDebug=!1,this.roomCount=-1,this.room="",this.socketId=""}return Object(y["a"])(e,[{key:"join",value:function(e){var t=this;return this.room=e,new Promise(function(n){var r;t.socket.emit("join",e),r=function(){var e;1===t.roomCount?n():(e=function(){n(),t.off("fullConnect",e)},t.on("fullConnect",e));t.off("roomCount",r)},t.on("roomCount",r)})}},{key:"connect",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(r,o){t.url=e;var s=["websocket"];n||s.push("polling"),t.socket=x()(e,{transports:s}),t.socket.on("roomCount",function(e){t.roomCount=e,t.log("New room count: "+e+" users"),t.fire("roomCount",e),t.checkFullConnect()}),t.socket.on("connect",function(){r(t.socket),t.log("Connected to socket server")}),t.socket.on("connect_error",function(e){t.log("Error connecting to socket server",e),o(e)}),t.socket.on("socketId",function(e){t.log("My socket id = ".concat(e)),t.fire("socketId",e),t.socketId=e}),t.socket.on("initialize",function(e){t.log("Initializing with ",e),t.peers[e]=t.createPeer(e,!0)}),t.socket.on("destroy",function(e){t.peers.hasOwnProperty(e)?(t.peers[e].destroy(),delete t.peers[e],t.fire("disconnect",e),t.log("Destroying peer",e,"peer count:",t.getConnectedPeerCount())):t.log("Unable to destroy peer, it does not exist")}),t.socket.on("signal",function(e){var n=Object(k["a"])(e,2),r=n[0],o=n[1];t.log("Receiving signal from ",r),t.peers.hasOwnProperty(r)||(t.log("".concat(r," is initializing with me")),t.peers[r]=t.createPeer(r,!1)),t.log("Signalling ".concat(r),o),t.peers[r].signal(o)})})}},{key:"broadcast",value:function(e){for(var t in this.log("Broadcasting to ".concat(this.getConnectedPeerCount()," peers: ").concat(e)),this.peers)this.peers.hasOwnProperty(t)&&null!==this.peers[t]&&(console.log("broadcasting ",e),this.peers[t].send(e))}},{key:"broadcastStream",value:function(e){for(var t in this.log("Broadcasting stream to ".concat(this.getConnectedPeerCount()," peers: ").concat(e)),this.peers)this.peers.hasOwnProperty(t)&&null!==this.peers[t]&&this.peers[t].addStream(e)}},{key:"broadcastRemoveStream",value:function(e){for(var t in this.log("broadcastRemoveStream to ".concat(this.getConnectedPeerCount()," peers: ").concat(e)),this.peers)this.peers.hasOwnProperty(t)&&null!==this.peers[t]&&this.peers[t].removeStream(e)}},{key:"createPeer",value:function(e,t){var n=this,r={initiator:t,trickle:this.trickle};this.wrtc&&(r.wrtc=this.wrtc,this.log("Using wrtc",r));var o=new _.a(r);return o.on("error",function(r){n.fire("error",o,e,{peer:o,error:r,initiator:t}),n.log("error",r)}),o.on("signal",function(t){n.log("Emitting signal to socket: ".concat(e)),n.socket.emit("message",[e,"signal",t])}),o.on("connect",function(){n.fire("connect",e);var t=n.getConnectedPeerCount();n.log("New peer connection, peer count: ",t),n.checkFullConnect()}),o.on("data",function(t){n.fire("data",e,t),n.log("data: "+t)}),o.on("stream",function(t){n.fire("stream",e,t),n.log("stream: ",t)}),o.on("track",function(t,r){n.fire("track",t,e,r),n.log("track: ",t,"stream",r)}),o.on("close",function(){return n.log("Peer connection closed",o)}),o}},{key:"getConnectedPeerCount",value:function(){var e=0;for(var t in this.peers)this.peers.hasOwnProperty(t)&&this.peers[t].connected&&e++;return e}},{key:"checkFullConnect",value:function(){var e=this.getConnectedPeerCount();e+1>=this.roomCount&&(this.log("Fully connected to room, peer count: ",e,"room count: ",this.roomCount),this.fire("fullConnect"))}},{key:"destroy",value:function(){for(var e in this.socket.close(),this.peers)this.peers.hasOwnProperty(e)&&this.peers[e].destroy()}},{key:"off",value:function(e,t){this._events.hasOwnProperty(e)&&this._events[e].splice(this._events[e].indexOf(t),1)}},{key:"on",value:function(e,t){this._events.hasOwnProperty(e)||(this._events[e]=[]),this._events[e].push(t)}},{key:"fire",value:function(e){if(this._events.hasOwnProperty(e)){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=!0,s=!1,i=void 0;try{for(var c,a=this._events[e][Symbol.iterator]();!(o=(c=a.next()).done);o=!0){var u=c.value;u.apply(void 0,n)}}catch(l){s=!0,i=l}finally{try{o||null==a.return||a.return()}finally{if(s)throw i}}}}},{key:"log",value:function(){var e;this.printDebug&&(e=console).log.apply(e,arguments)}}],[{key:"getServerRooms",value:function(){var e=Object(v["a"])(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return"/"!==t[t.length-1]&&(t+="/"),e.prev=1,e.next=4,fetch(t+"rooms");case 4:return n=e.sent,e.next=7,n.json();case 7:return e.abrupt("return",e.sent);case 10:return e.prev=10,e.t0=e["catch"](1),e.abrupt("return",null);case 13:case"end":return e.stop()}},e,null,[[1,10]])}));function t(t){return e.apply(this,arguments)}return t}()}]),e}(),N=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";Object(b["a"])(this,e),this.ip=t,this.online=n,this.rooms=r,this.loading=o,this.room=s},j={name:"server-browser",components:{},props:["room","server"],data:function(){return{serverIp:"https://ruurd.dev:5858",roomName:"",connectedServer:new N("-1"),serverUserCountUpdater:!1,servers:[],meshNetwork:null}},mounted:function(){var e=Object(v["a"])(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(null!==localStorage.getItem("servers")&&JSON.parse(localStorage.servers).forEach(function(e){var n=new N(e);t.servers.push(n),t.updateServerInfo(e,n)}),this.servers.find(function(e){return e.ip===t.serverIp})&&(this.serverIp=""),this.serverUserCountUpdater=setInterval(Object(v["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t.servers.forEach(function(e){return t.updateServerInfo(e.ip,e)});case 1:case"end":return e.stop()}},e)})),2e3),!this.server){e.next=9;break}if(console.log("this.server",this.server),this.servers.find(function(e){return e.ip===t.server})){e.next=8;break}return e.next=8,this.addServer(this.server);case 8:this.room&&(console.log("this.room",this.room),this.connectServer(this.servers.find(function(e){return e.ip===t.server}),this.room));case 9:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),methods:{connectServer:function(){var e=Object(v["a"])(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.meshNetwork&&this.disconnectServer(this.meshNetwork.url),this.meshNetwork=new O,this.meshNetwork.printDebug=!1,e.next=5,this.meshNetwork.connect(t.ip,!0);case 5:return this.updateServerInfo(t.ip,t),e.next=8,this.meshNetwork.join(n);case 8:t.room=n,this.connectedServer=t,this.$route.params.server=t.ip,this.$route.params.room=n,this.$emit("connect",this.meshNetwork);case 13:case"end":return e.stop()}},e,this)}));function t(t,n){return e.apply(this,arguments)}return t}(),updateServerInfo:function(){var e=Object(v["a"])(regeneratorRuntime.mark(function e(t){var n,r,o,s=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]&&s[1],e.next=3,O.getServerRooms(t);case 3:return r=e.sent,o=null!==r,r=r||[],!1!==n&&(n.online=o,n.rooms=r,n.loading=!1),e.abrupt("return",new N(t,o,r,!1));case 8:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}(),disconnectServer:function(){var e=Object(v["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t===this.meshNetwork.url?(this.meshNetwork.destroy(),this.$emit("disconnect",this.meshNetwork),this.meshNetwork=null,this.updateServerInfo(this.connectedServer.ip,this.connectedServer),this.connectedServer=new N("-1")):console.warn("cannot disconnect from this server, you're not connected to it");case 1:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),removeServer:function(e){this.servers.find(function(t){return t.ip===e})&&(this.servers.splice(this.servers.findIndex(function(t){return t.ip===e}),1),localStorage.servers=JSON.stringify(this.servers.map(function(e){return e.ip})))},addServer:function(){var e=Object(v["a"])(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("adding server",t),!this.servers.find(function(e){return e.ip===t})){e.next=3;break}return e.abrupt("return");case 3:return n=new N(t),this.servers.push(n),localStorage.servers=JSON.stringify(this.servers.map(function(e){return e.ip})),e.next=8,this.updateServerInfo(t,n);case 8:console.log("Server info: ",n);case 9:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},beforeDestroy:function(){clearInterval(this.serverUserCountUpdater)}},P=j,I=(n("2353"),Object(i["a"])(P,g,w,!1,null,"3b108604",null)),R=I.exports,M=n("fdc6"),$=n.n(M),E={name:"home",components:{ServerBrowser:R},data:function(){return{message:"",messages:[],peerMesh:null,userName:$.a.generate()}},mounted:function(){var e=Object(v["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:null!==localStorage.getItem("userName")&&(this.userName=localStorage.userName);case 1:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),methods:{sendMessage:function(e){if(this.peerMesh){var t={from:this.userName,text:e};this.showMessage(t),this.peerMesh.broadcast(JSON.stringify(t))}},showMessage:function(e){this.messages.push(e),setTimeout(function(){var e=document.querySelectorAll(".message-item");e[e.length-1].scrollIntoView()})},connected:function(e){var t=this;this.peerMesh=e,this.$router.replace({query:{room:e.room,server:e.url}}),console.log("Connected",e),e.on("data",function(e,n){var r=JSON.parse(n.toString());t.showMessage(r)}),e.on("stream",function(e,t){console.log({stream:t,id:e})})},disconnected:function(e){this.$router.replace({}),console.log("Disconnected",e)}}},U=E,D=(n("bacf"),Object(i["a"])(U,p,h,!1,null,"69027167",null)),J=D.exports;r["default"].use(f["a"]);var q=new f["a"]({routes:[{path:"/",name:"home",component:J}]});r["default"].config.productionTip=!1,r["default"].use(m.a),new r["default"]({router:q,render:function(e){return e(u)}}).$mount("#app")},"64a9":function(e,t,n){},b89f:function(e,t,n){},bacf:function(e,t,n){"use strict";var r=n("b89f"),o=n.n(r);o.a}});
//# sourceMappingURL=app.cb6d2218.js.map