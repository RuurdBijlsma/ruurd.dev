(function(e){function t(t){for(var r,i,a=t[0],c=t[1],u=t[2],d=0,m=[];d<a.length;d++)i=a[d],o[i]&&m.push(o[i][0]),o[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(m.length)m.shift()();return s.push.apply(s,u||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],r=!0,a=1;a<n.length;a++){var c=n[a];0!==o[c]&&(r=!1)}r&&(s.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={app:0},s=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/peercord/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var l=c;s.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var r=n("64a9"),o=n.n(r);o.a},"054d":function(e,t,n){"use strict";var r=n("77db"),o=n.n(r);o.a},1:function(e,t){},2:function(e,t){},3:function(e,t){},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var r=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},s=[],i=(n("034f"),n("2877")),a={},c=Object(i["a"])(a,o,s,!1,null,null,null),u=c.exports,l=n("9483");Object(l["a"])("".concat("/peercord/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var d=n("43f9"),m=n.n(d),p=(n("51de"),n("e094"),n("bd62"),n("2560")),h=n("8c4f"),f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},[e._l(e.privateIdStates,function(t){return n("audio",{key:e.listKey,attrs:{volume:t.volume,muted:t.mute,autoplay:""},domProps:{srcObject:t.stream}})}),n("md-app",{attrs:{"md-mode":"fixed","md-scrollbar":!1}},[n("md-app-toolbar",{staticClass:"md-primary"},[n("md-button",{staticClass:"md-icon-button",on:{click:function(t){e.menuVisible=!e.menuVisible}}},[n("md-icon",[e._v("menu")])],1),n("span",{staticClass:"md-title"},[e._v("Peercord")])],1),n("md-app-drawer",{attrs:{"md-active":e.menuVisible},on:{"update:mdActive":function(t){e.menuVisible=t},"update:md-active":function(t){e.menuVisible=t}}},[n("server-browser",{attrs:{server:e.$route.query.server,room:e.$route.query.room},on:{connect:e.connected,disconnect:e.disconnected}})],1),n("md-app-content",{staticClass:"main-content"},[n("vue-simple-context-menu",{ref:"vueSimpleContextMenu",attrs:{elementId:"myUniqueId",options:e.contextOptions},on:{"option-clicked":e.optionClicked}}),null!==e.peerMesh?n("md-list",{key:e.listKey,staticClass:"md-accent"},[n("md-subheader",[e._v("Online users")]),e._l(e.syncedIdStates,function(t){return n("md-list-item",{on:{contextmenu:function(n){return n.preventDefault(),n.stopPropagation(),e.handleClick(n,t)}}},[n("md-icon",[e._v("account_circle")]),n("span",{staticClass:"md-list-item-text"},[e._v(e._s(t.user))])],1)})],2):e._e(),null===this.peerMesh?n("md-empty-state",{attrs:{"md-icon":"devices_other","md-label":"Connect to a server to begin","md-description":"Add a server on the menu to the left to start, then click the blue arrow next to a room to join that room."}}):n("md-content",{staticClass:"chat-box"},[n("h3",{on:{click:function(t){e.promptActive=!e.promptActive}}},[e._v("Your name: "+e._s(e.syncedState.user))]),n("md-dialog-prompt",{attrs:{"md-active":e.promptActive,"md-title":"What's your name?","md-input-placeholder":"Type your new username...","md-confirm-text":"Done"},on:{"update:mdActive":function(t){e.promptActive=t},"update:md-active":function(t){e.promptActive=t}},model:{value:e.syncedState.user,callback:function(t){e.$set(e.syncedState,"user",t)},expression:"syncedState.user"}}),e.messages.length>0?n("md-list",{key:e.listKey,ref:"messagesList",staticClass:"messages-list"},e._l(e.messages,function(t){return n("md-list-item",{staticClass:"message-item"},[n("div",{staticClass:"md-list-item-text message",attrs:{me:"me"===t.from}},[t.show?n("span",{style:"color: "+t.color},[e._v(e._s(e.syncedIdStates[t.from].user))]):e._e(),n("span",[e._v(e._s(t.text))])])])}),1):e._e(),n("md-field",[n("label",[e._v("Type a message")]),n("md-input",{on:{keypress:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.sendMessage(e.message),e.message=""}},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}})],1)],1)],1)],1)],2)},v=[],g=(n("6b54"),n("a481"),n("96cf"),n("3b8d")),y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"server-browser"},[n("md-list",{staticClass:"server-list"},[n("md-list-item",[n("div",{staticClass:"md-list-item-text"},[n("md-field",[n("label",[e._v("Add new server")]),n("md-input",{model:{value:e.serverIp,callback:function(t){e.serverIp=t},expression:"serverIp"}})],1)],1),n("md-button",{staticClass:"md-icon-button md-list-action",attrs:{type:"submit"},on:{click:function(t){e.addServer(e.serverIp),e.serverIp=""}}},[n("md-icon",[e._v("add")])],1)],1),e._l(e.servers,function(t){return n("md-list-item",{key:t.ip,attrs:{"md-expand":t.online,"md-expanded":t.online}},[t.loading?n("md-icon",{staticClass:"rotate",attrs:{title:"Checking connection to "+t.ip}},[e._v("\n                cached\n            ")]):t.online?n("md-icon",{class:t.ip===e.connectedServer.ip?"md-primary":"",attrs:{title:t.ip+" is online"}},[e._v("rss_feed\n            ")]):n("md-icon",{attrs:{title:t.ip+" is offline"}},[e._v("error_outline")]),n("div",{staticClass:"md-list-item-text",attrs:{title:t.ip}},[e._v("\n                "+e._s(t.ip)+"\n            ")]),t.ip!==e.connectedServer.ip?n("md-button",{staticClass:"md-icon-button md-list-action",attrs:{title:"Remove "+t.ip+" from list"},on:{click:function(n){return e.removeServer(t.ip)}}},[n("md-icon",[e._v("delete")])],1):e._e(),n("md-list",{attrs:{slot:"md-expand"},slot:"md-expand"},[n("md-list-item",{staticClass:"md-inset"},[n("div",{staticClass:"md-list-item-text"},[n("md-field",[n("label",[e._v("Create room")]),n("md-input",{attrs:{required:""},model:{value:e.roomName,callback:function(t){e.roomName=t},expression:"roomName"}}),n("span",{staticClass:"md-error"},[e._v("Room cannot be empty")])],1)],1),n("md-button",{staticClass:"md-icon-button md-list-action md-primary",attrs:{title:"Connect to "+t.ip+"#"+e.roomName},on:{click:function(n){return e.connectServer(t,e.roomName)}}},[n("md-icon",[e._v("keyboard_arrow_right")])],1)],1),e._l(t.rooms,function(r){return n("md-list-item",{key:r.id,staticClass:"md-inset"},[n("div",{staticClass:"md-list-item-text",attrs:{title:t.ip+"#"+r.id}},[n("span",[e._v(e._s(r.id))]),t.online?n("span",[e._v("Users online: "+e._s(r.userCount))]):e._e()]),r.id===t.room&&t.ip===e.connectedServer.ip?n("md-button",{staticClass:"md-icon-button md-list-action",attrs:{title:"Disconnect from "+t.ip+"#"+r.id},on:{click:function(n){return e.disconnectServer(t.ip)}}},[n("md-icon",[e._v("stop")])],1):n("md-button",{staticClass:"md-icon-button md-list-action md-primary",attrs:{title:"Connect to "+t.ip+"#"+r.id},on:{click:function(n){return e.connectServer(t,r.id)}}},[n("md-icon",[e._v("keyboard_arrow_right")])],1)],1)})],2)],1)})],2)],1)},w=[],b=(n("20d6"),n("7514"),n("ac6a"),n("d225")),k=n("b0b4"),S=n("308d"),x=n("6bb5"),O=n("4e2b"),C=n("051a"),_=n.n(C),j=n("faa1"),R=n.n(j),N=n("8055"),I=n.n(N),P=function(e){function t(e){var n;return Object(b["a"])(this,t),n=Object(S["a"])(this,Object(x["a"])(t).call(this)),n.socket=null,n.rooms=[],n.appName=e,n.id="",n.roomCount=0,n}return Object(O["a"])(t,e),Object(k["a"])(t,[{key:"getRoomCount",value:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.socket.emit("room-count",t,n),e.next=3,this.waitFor("room-count",5e3);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"create",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.socket.emit("create",e,t,n,r)}},{key:"join",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.socket.emit("join",e,t,n)}},{key:"leave",value:function(e,t){this.socket.emit("leave",e,t)}},{key:"broadcast",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(t=this.socket).emit.apply(t,["broadcast",e].concat(r))}},{key:"message",value:function(e,t){for(var n,r=arguments.length,o=new Array(r>2?r-2:0),s=2;s<r;s++)o[s-2]=arguments[s];console.log("emitting message ".concat(e," ").concat(t," ").concat(o)),(n=this.socket).emit.apply(n,["message",e,t].concat(o))}},{key:"connect",value:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){var n,r=this,o=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]&&o[1],e.abrupt("return",new Promise(function(e,o){r.url=t;var s=["websocket"];n||s.push("polling"),r.socket=I()(t,{transports:s}),r.socket.on("connect",function(){e(r.socket)}),r.socket.on("connect_error",function(e){o(e)}),r.socket.on("room-count",function(e){r.roomCount=e,r.emit("room-count",e)}),r.socket.on("socket-id",function(e){r.emit("socket-id",e),r.id=e}),r.socket.on("initialize",function(e,t){r.emit("initialize",e,t)}),r.socket.on("destroy",function(e){r.emit("destroy",e)}),r.socket.on("signal",function(e,t){r.emit("signal",e,t)})}));case 2:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"destroy",value:function(){this.socket&&this.socket.close()}},{key:"waitFor",value:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){var n,r=this,o=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]&&o[1],e.abrupt("return",new Promise(function(e,o){var s;!1!==n&&(s=setTimeout(function(){o("Timeout while waiting for event "+t+" to fire (timeout: "+n+"ms)")},+n)),r.once(t,function(){!1!==n&&clearTimeout(s),e.apply(void 0,arguments)})}));case 2:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()}]),t}(R.a),M=function(e){function t(e){var n,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(b["a"])(this,t),n=Object(S["a"])(this,Object(x["a"])(t).call(this)),n.wrtc=o,n.appName=e,n.trickle=r,n.peers={},n.printDebug=!0,n.room="",n.broadcastedStream=null,n.signal=new P(e),n}return Object(O["a"])(t,e),Object(k["a"])(t,[{key:"getServerRooms",value:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){var n,r=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return"/"!==t[t.length-1]&&(t+="/"),e.prev=1,e.next=4,fetch(t+"rooms");case 4:return n=e.sent,e.next=7,n.json();case 7:return e.t0=function(e){return e.appName===r.appName},e.abrupt("return",e.sent.filter(e.t0));case 11:return e.prev=11,e.t1=e["catch"](1),e.abrupt("return",null);case 14:case"end":return e.stop()}},e,null,[[1,11]])}));function t(t){return e.apply(this,arguments)}return t}()},{key:"create",value:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){var n,r,o=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=o.length>1&&void 0!==o[1]?o[1]:"",r=o.length>2&&void 0!==o[2]&&o[2],this.signal.create(this.appName,t,n,r);case 3:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"join",value:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){var n,r,o=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"",this.signal.join(this.appName,t,n),this.room=t,e.next=5,this.signal.waitFor("room-count",5e3);case 5:if(r=e.sent,this.checkFullConnect(),1===r){e.next=10;break}return e.next=10,this.waitFor("full-connect",1e4);case 10:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"connect",value:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){var n,r=this,o=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]&&o[1],e.next=3,this.signal.connect(t,n);case 3:this.signal.on("room-count",function(e){r.emit("room-count",e),r.checkFullConnect()}),this.signal.on("socket-id",function(e){r.emit("socket-id",e)}),this.signal.on("initialize",function(e,t){r.log("Initializing with ",t),r.peers[t]=r.createPeer(t,!0)}),this.signal.on("destroy",function(e){if(r.peers.hasOwnProperty(e)){try{r.peers[e].destroy()}catch(t){}delete r.peers[e],r.emit("disconnect",e),r.log("Destroying peer",e,"peer count:",r.getConnectedPeerCount())}else r.log("Unable to destroy peer, it does not exist")}),this.signal.on("signal",function(e,t){r.log("Receiving signal from ",e),r.peers.hasOwnProperty(e)||(r.log("".concat(e," is initializing with me")),r.peers[e]=r.createPeer(e,!1)),r.log("Signalling ".concat(e),t),r.peers[e].signal(t)});case 8:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"broadcast",value:function(e){for(var t in this.log("Broadcasting to ".concat(this.getConnectedPeerCount()," peers: ").concat(e)),this.peers)this.peers.hasOwnProperty(t)&&null!==this.peers[t]&&(console.log("broadcasting ",e),"string"===typeof e?this.peers[t].send(e):this.peers[t].send(JSON.stringify(e)))}},{key:"send",value:function(e,t){this.log("Sending to ".concat(e,": ").concat(t)),this.peers.hasOwnProperty(e)&&null!==this.peers[e]&&(console.log("broadcasting ",t),"string"===typeof t?this.peers[e].send(t):this.peers[e].send(JSON.stringify(t)))}},{key:"broadcastStream",value:function(e){for(var t in this.broadcastedStream=e,this.log("Broadcasting stream to ".concat(this.getConnectedPeerCount()," peers: ").concat(e)),this.peers)this.peers.hasOwnProperty(t)&&null!==this.peers[t]&&this.peers[t].addStream(e)}},{key:"sendStream",value:function(e,t){this.log("Sending stream to ".concat(e,": ").concat(t)),this.peers.hasOwnProperty(e&&null!==this.peers[e])&&this.peers[e].addStream(t)}},{key:"removeStream",value:function(e,t){this.log("Removing stream to ".concat(e,": ").concat(t)),this.peers.hasOwnProperty(e&&null!==this.peers[e])&&this.peers[e].removeStream(t)}},{key:"broadcastRemoveStream",value:function(e){for(var t in this.broadcastedStream=null,this.log("broadcastRemoveStream to ".concat(this.getConnectedPeerCount()," peers: ").concat(e)),this.peers)this.peers.hasOwnProperty(t)&&null!==this.peers[t]&&this.peers[t].removeStream(e)}},{key:"createPeer",value:function(e,t){var n=this,r={initiator:t,trickle:this.trickle};this.wrtc&&(r.wrtc=this.wrtc,this.log("Using wrtc",r)),null!==this.broadcastedStream&&(r.stream=this.broadcastedStream);var o=new _.a(r);return o.on("error",function(r){console.warn(r),n.emit("error",o,e,{peer:o,error:r,initiator:t}),n.log("error",r)}),o.on("signal",function(t){n.log("Emitting signal to socket: ".concat(e)),n.signal.message(e,"signal",t)}),o.on("connect",function(){var t=n.getConnectedPeerCount();n.log("New peer connection, peer count: ",t),n.emit("connect",e),n.checkFullConnect()}),o.on("data",function(t){n.emit("data",e,t),n.log("data: "+t)}),o.on("stream",function(t){console.log("Stream received!"),n.emit("stream",e,t),n.log("stream: ",t)}),o.on("track",function(t,r){n.emit("track",t,e,r),n.log("track: ",t,"stream",r)}),o.on("close",function(){return n.log("Peer connection closed",o)}),o}},{key:"getConnectedPeerCount",value:function(){var e=0;for(var t in this.peers)this.peers.hasOwnProperty(t)&&this.peers[t].connected&&e++;return e}},{key:"checkFullConnect",value:function(){var e=this.getConnectedPeerCount();console.log(e),e+1>=this.signal.roomCount&&(this.log("Fully connected to room, peer count: ",e,"room count: ",this.signal.roomCount),this.emit("full-connect"))}},{key:"destroy",value:function(){for(var e in this.signal.destroy(),this.peers)if(this.peers.hasOwnProperty(e)){try{this.peers[e].destroy()}catch(t){}delete this.peers[e]}}},{key:"log",value:function(){var e;this.printDebug&&(e=console).log.apply(e,arguments)}},{key:"waitFor",value:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){var n,r=this,o=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]&&o[1],e.abrupt("return",new Promise(function(e,o){var s;!1!==n&&(s=setTimeout(function(){o("Timeout while waiting for event "+t+" to fire (timeout: "+n+"ms)")},+n)),r.once(t,function(){!1!==n&&clearTimeout(s),e.apply(void 0,arguments)})}));case 2:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"url",get:function(){return this.signal.url}}]),t}(R.a),U=function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";Object(b["a"])(this,e),this.ip=t,this.online=n,this.rooms=r,this.loading=o,this.room=s},A={name:"server-browser",components:{},props:["room","server"],data:function(){return{serverIp:"https://api.ruurd.dev",roomName:"",connectedServer:new U("-1"),serverUserCountUpdater:!1,servers:[],meshNetwork:new M("peercord")}},mounted:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(null!==localStorage.getItem("servers")&&JSON.parse(localStorage.servers).forEach(function(e){var n=new U(e);t.servers.push(n),t.updateServerInfo(e,n)}),this.servers.find(function(e){return e.ip===t.serverIp})&&(this.serverIp=""),this.serverUserCountUpdater=setInterval(Object(g["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t.servers.forEach(function(e){return t.updateServerInfo(e.ip,e)});case 1:case"end":return e.stop()}},e)})),2e3),!this.server){e.next=8;break}if(this.servers.find(function(e){return e.ip===t.server})){e.next=7;break}return e.next=7,this.addServer(this.server);case 7:this.room&&this.connectServer(this.servers.find(function(e){return e.ip===t.server}),this.room);case 8:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),methods:{connectServer:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t,n){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.roomName="",this.meshNetwork&&this.disconnectServer(this.meshNetwork.url),this.meshNetwork.printDebug=!1,e.next=5,this.meshNetwork.connect(t.ip,!0);case 5:return this.updateServerInfo(t.ip,t),e.next=8,this.meshNetwork.join(n);case 8:t.room=n,this.connectedServer=t,console.log("Emitting connect"),this.$emit("connect",this.meshNetwork);case 12:case"end":return e.stop()}},e,this)}));function t(t,n){return e.apply(this,arguments)}return t}(),updateServerInfo:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){var n,r,o,s=arguments;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]&&s[1],e.next=3,this.meshNetwork.getServerRooms(t);case 3:return r=e.sent,o=null!==r,r=r||[],!1!==n&&(n.online=o,n.rooms=r,n.loading=!1),e.abrupt("return",new U(t,o,r,!1));case 8:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),disconnectServer:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t===this.meshNetwork.url?(this.meshNetwork.destroy(),this.$emit("disconnect",this.meshNetwork),this.updateServerInfo(this.connectedServer.ip,this.connectedServer),this.connectedServer=new U("-1")):console.warn("cannot disconnect from this server, you're not connected to it");case 1:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),removeServer:function(e){this.servers.find(function(t){return t.ip===e})&&(this.servers.splice(this.servers.findIndex(function(t){return t.ip===e}),1),localStorage.servers=JSON.stringify(this.servers.map(function(e){return e.ip})))},addServer:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.servers.find(function(e){return e.ip===t})){e.next=2;break}return e.abrupt("return");case 2:return n=new U(t),this.servers.push(n),localStorage.servers=JSON.stringify(this.servers.map(function(e){return e.ip})),e.next=7,this.updateServerInfo(t,n);case 7:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},beforeDestroy:function(){clearInterval(this.serverUserCountUpdater),this.meshNetwork&&this.meshNetwork.destroy()}},F=A,T=(n("054d"),Object(i["a"])(F,y,w,!1,null,"febe2f4a",null)),J=T.exports,$=n("fdc6"),D=n.n($),V=n("4710"),E=n.n(V),q={name:"home",components:{ServerBrowser:J},data:function(){return{menuVisible:!1,colorHash:new E.a,innerWidth:window.innerWidth,listKey:0,promptActive:!1,showServerBrowser:!0,message:"",messages:[],peerMesh:null,privateIdStates:{},syncedIdStates:{},contextOptions:[{name:"Mute"},{name:"Adjust volume"}],syncedState:{user:D.a.generate()}}},mounted:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:null!==localStorage.getItem("userName")&&(this.syncedState.user=localStorage.userName),this.syncedIdStates["me"]=this.syncedState,window.addEventListener("resize",function(){return t.innerWidth=innerWidth});case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),methods:{getVoice:function(){var e=speechSynthesis.getVoices();return e[Math.floor(Math.random()*e.length)]},speak:function(e){var t=new SpeechSynthesisUtterance(e);t.voice=this.getVoice(),speechSynthesis.speak(t)},handleClick:function(e,t){this.$refs.vueSimpleContextMenu.showMenu(e,t)},optionClicked:function(e){window.alert(JSON.stringify(e))},sendMessage:function(e){this.speak(e),this.peerMesh&&(this.message="",this.showMessage("me",e),this.peerMesh.broadcast(JSON.stringify({event:"message",value:e})))},showMessage:function(e,t){var n={text:t,from:e,color:this.colorHash.hex(e),show:!0},r=this.messages[this.messages.length-1];r&&r.from===e&&(n.show=!1),this.messages.push(n),console.log(n),setTimeout(function(){var e=document.querySelectorAll(".message-item"),t=e[e.length-1];t&&t.scrollIntoView()})},getMicrophone:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!0,video:!1});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}(),connected:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t){var n=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("Connected",t),this.showServerBrowser=!1,this.peerMesh=t,e.next=5,this.$router.replace({query:{room:t.room,server:t.url}});case 5:return this.broadcast("initialState",this.syncedState),t.on("connect",function(e){console.log("User connected",e),n.speak("User connected")}),t.on("disconnect",function(e){console.log("User disconnected",e),n.speak("User disconnected"),delete n.syncedIdStates[e],delete n.privateIdStates[e],n.forceListUpdate()}),t.on("data",function(e,t){var r=JSON.parse(t.toString());switch(r.event){case"initialState":console.log("initialState, replying with my syncedState",e,r.value),n.syncedIdStates[e]=r.value,n.forceListUpdate(),n.send(e,"syncedState",n.syncedState);break;case"syncedState":console.log("updating syncedState",e,r.value),n.syncedIdStates[e]=r.value,n.forceListUpdate();break;case"message":console.log("receiving message",e,r.value),n.showMessage(e,r.value);break;default:console.log("Unknown event",r);break}}),t.on("stream",function(e,t){n.privateIdStates[e]||(n.privateIdStates[e]={});var r=n.privateIdStates[e];r.stream=t,console.log(r),n.forceListUpdate()}),console.warn("Requesting microphone permissions!"),e.t0=t,e.next=14,this.getMicrophone();case 14:e.t1=e.sent,e.t0.broadcastStream.call(e.t0,e.t1);case 16:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),forceListUpdate:function(){this.listKey++,setTimeout(function(){var e=document.querySelectorAll(".message-item"),t=e[e.length-1];t&&t.scrollIntoView()})},disconnected:function(e){this.$router.replace({}),this.peerMesh=null,console.log("Disconnected",e),this.syncedIdStates={me:this.syncedState}},send:function(e,t,n){this.peerMesh&&this.peerMesh.peers.hasOwnProperty(e)&&this.peerMesh.peers[e].send(JSON.stringify({event:t,value:n}))},broadcast:function(e,t){this.peerMesh&&this.peerMesh.broadcast(JSON.stringify({event:e,value:t}))}},watch:{syncedState:{handler:function(){localStorage.userName=this.syncedState.user,this.forceListUpdate(),this.broadcast("syncedState",this.syncedState)},deep:!0}},beforeDestroy:function(){for(var e in this.privateIdStates)this.privateIdStates.hasOwnProperty(e)&&cancelAnimationFrame(this.privateIdStates[e].interval)}},L=q,z=(n("8e96"),Object(i["a"])(L,f,v,!1,null,"3d9f72e9",null)),B=z.exports;r["default"].use(h["a"]);var K=new h["a"]({routes:[{path:"/",name:"home",component:B}]});r["default"].config.productionTip=!1,r["default"].component("vue-simple-context-menu",p["a"]),r["default"].use(m.a),new r["default"]({router:K,render:function(e){return e(u)}}).$mount("#app")},"64a9":function(e,t,n){},"77db":function(e,t,n){},8827:function(e,t,n){},"8e96":function(e,t,n){"use strict";var r=n("8827"),o=n.n(r);o.a}});
//# sourceMappingURL=app.322f7ff6.js.map