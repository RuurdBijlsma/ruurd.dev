(function(e){function t(t){for(var r,o,i=t[0],c=t[1],u=t[2],f=0,p=[];f<i.length;f++)o=i[f],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&p.push(s[o][0]),s[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(p.length)p.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,i=1;i<n.length;i++){var c=n[i];0!==s[c]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},s={app:0},a=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/vuemusic/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var r=n("64a9"),s=n.n(r);s.a},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var r=n("2b0e"),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},a=[],o={name:"App",mounted:function(){}},i=o,c=(n("034f"),n("2877")),u=Object(c["a"])(i,s,a,!1,null,null,null),l=u.exports,f=n("8c4f"),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home"},[n("md-content",{staticClass:"main-content",style:{height:""===e.activeSong.name?"100%":"calc(100% - 250px)"}},[n("h1",{staticClass:"title md-title"},[e._v("Liked Songs")]),n("md-button",{staticClass:"md-raised md-primary shuffle-button",on:{click:e.shufflePlay}},[e._v("Shuffle Play")]),n("song-list",{staticClass:"song-list",attrs:{"active-song":e.activeSong,songs:e.songs},on:{play:e.playSong}})],1),""!==e.activeSong.name?n("md-content",{staticClass:"bottom-card md-primary"},[n("div",{staticClass:"song-card"},[n("div",{staticClass:"album-art",style:{"background-image":"url("+e.activeSong.album.images[0].url+")"}}),n("div",{staticClass:"song-info"},[n("span",[e._v(e._s(e.activeSong.name))]),n("span",[e._v(e._s(e.activeSong.artists.map((function(e){return e.name})).join(", ")))])])]),n("div",{staticClass:"seek-bar",on:{mousedown:e.seekDown,touchstart:function(t){return e.seekDown(t.touches[0])}}},[n("span",{staticClass:"song-time"},[e._v(e._s(e.secondsToHms(e.songProgress*e.activeSong.duration_ms/1e3)))]),n("div",{ref:"seekContainer",staticClass:"seek-container"},[n("div",{staticClass:"seek-progress",style:{width:Math.round(100*e.songProgress)+"%"}}),n("div",{staticClass:"seek-thumb",style:{left:"calc("+Math.round(100*e.songProgress)+"% - 16px / 2)"}})]),n("span",{staticClass:"song-duration"},[e._v(e._s(e.secondsToHms(e.activeSong.duration_ms/1e3)))])]),n("div",{staticClass:"music-controls"},[n("md-button",{staticClass:"md-icon-button",on:{click:function(t){return e.toggleShuffle()}}},[n("md-icon",{style:e.shuffle?"opacity: 1":"opacity: 0.6"},[e._v("shuffle")])],1),n("md-button",{staticClass:"md-icon-button",on:{click:e.skipPrevious}},[n("md-icon",[e._v("skip_previous")])],1),n("md-button",{staticClass:"md-icon-button md-raised",on:{click:function(t){e.playing?e.pause():e.play()}}},[e.playing?n("md-icon",[e._v("pause")]):n("md-icon",[e._v("play_arrow")])],1),n("md-button",{staticClass:"md-icon-button",on:{click:e.skipNext}},[n("md-icon",[e._v("skip_next")])],1),n("md-button",{staticClass:"md-icon-button",on:{click:function(t){e.repeat=!e.repeat}}},[n("md-icon",{style:e.repeat?"opacity: 1":"opacity: 0.6"},[e._v("repeat")])],1)],1)]):e._e(),n("audio",{ref:"player",staticClass:"audio-player"})],1)},h=[],d=(n("28a5"),n("386d"),n("7f7f"),n("14b9"),n("f576"),n("6b54"),n("75fc")),g=(n("7514"),n("96cf"),n("3b8d")),m=(n("6762"),n("2fdb"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"song-list"},e._l(e.songs,(function(t){return n("md-list-item",{staticClass:"song-item",on:{click:function(n){return e.playSong(t)}}},[n("div",{staticClass:"md-list-item-text"},[n("span",{staticClass:"song-title"},[e._v(e._s(t.name))]),n("span",{staticClass:"song-artist"},[e._v(e._s(t.artists.map((function(e){return e.name})).join(", ")))])]),e.activeSong.id===t.id?n("md-button",{staticClass:"md-primary md-icon-button md-list-action md-disabled"},[n("md-icon",{staticClass:"song-options"},[e._v("volume_up")])],1):e._e(),n("md-button",{staticClass:"md-icon-button md-list-action"},[n("md-icon",{staticClass:"song-options"},[e._v("more_vert")])],1)],1)})),1)}),v=[],b={name:"SongList",props:{songs:Array,activeSong:Object},data:function(){return{}},methods:{playSong:function(e){this.$emit("play",e)}},mounted:function(){}},y=b,k=(n("c202"),Object(c["a"])(y,m,v,!1,null,"69037bce",null)),S=k.exports,w=n("d225"),x=n("b0b4"),_=n("308d"),O=n("6bb5"),j=n("4e2b"),C=function(){function e(t){Object(w["a"])(this,e),this.baseUrl=t}return Object(x["a"])(e,[{key:"request",value:function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(t,n,r){var s,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.baseUrl+"/"+n.join("/"),{method:t,headers:{"Content-Type":"application/json"},body:void 0===r?void 0:JSON.stringify(r)});case 2:return s=e.sent,e.next=5,s.text();case 5:return a=e.sent,e.prev=6,e.abrupt("return",JSON.parse(a));case 10:e.prev=10,e.t0=e["catch"](6),console.log("Error parsing json response:",a);case 13:case"end":return e.stop()}}),e,this,[[6,10]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()},{key:"get",value:function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(){var t,n,r,s=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(t=s.length,n=new Array(t),r=0;r<t;r++)n[r]=s[r];return e.next=3,this.request("get",n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"post",value:function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(t){var n,r,s,a=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(n=a.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=a[s];return console.info("[POST]",r,t),e.next=4,this.request("post",r,t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),e}(),R=function(e){function t(){return Object(w["a"])(this,t),Object(_["a"])(this,Object(O["a"])(t).call(this,""))}return Object(j["a"])(t,e),Object(x["a"])(t,[{key:"setServer",value:function(e){this.baseUrl=e}},{key:"search",value:function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.get("search?query="+encodeURIComponent(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getStreamUrl",value:function(e){return this.baseUrl+"/stream/?id="+e}}]),t}(C),M=new R,P=location.href.includes("localhost")||location.href.includes("127.0.0.1"),T=P?"http://localhost:3000":"https://ruurd.dev:3000";M.setServer(T);var N={data:function(){return{timeUpdater:-1,songProgress:0,seeking:!1,songs:[],shuffledSongs:[],playing:!1,repeat:!0,shuffle:!1,activeSong:{name:"",artists:[],album:{images:[{url:""}]}}}},mounted:function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(){var t,n,r,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.getToken(),t=JSON.parse(localStorage.token),!localStorage.getItem("tracks")){e.next=9;break}console.log("Retrieving tracks from Cache"),n=JSON.parse(localStorage.tracks),console.log("Updating tracks from Cache"),this.getTracks(t).then((function(e){s.songs=e.map((function(e){return e.track})),localStorage.tracks=JSON.stringify(e)})),e.next=13;break;case 9:return console.log("Retrieving tracks from Spotify"),e.next=12,this.getTracks(t);case 12:n=e.sent;case 13:this.songs=n.map((function(e){return e.track})),localStorage.tracks=JSON.stringify(n),console.log(this.songs),null!==localStorage.getItem("lastPlayed")&&(r=this.songs.find((function(e){return e.id===localStorage.lastPlayed})),r&&this.playSong(r,!0)),document.addEventListener("mousemove",(function(e){return s.mouseMove(e)})),document.addEventListener("touchmove",(function(e){return s.mouseMove(e.touches[0])})),document.addEventListener("mouseup",(function(e){return s.mouseUp(e)})),document.addEventListener("touchend",(function(e){return s.mouseUp(e.touches[0])})),this.timeUpdater=setInterval((function(){var e=s.$refs.player.currentTime/(s.activeSong.duration_ms/1e3);e=Math.max(Math.min(e,1),0),s.songProgress=e}),200);case 22:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),beforeDestroy:function(){clearInterval(this.timeUpdater)},methods:{shufflePlay:function(){this.toggleShuffle(!0),this.playSong(this.shuffledSongs[0])},shuffleArray:function(e){var t,n,r=e.length;while(r)n=Math.floor(Math.random()*r--),t=e[r],e[r]=e[n],e[n]=t;return e},toggleShuffle:function(e){this.shuffle=void 0!==e?e:!this.shuffle,this.shuffle&&(this.shuffledSongs=this.shuffleArray(Object(d["a"])(this.songs)))},secondsToHms:function(e){if(isNaN(e)||void 0===e)return"0:00";e=Math.round(e);var t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=e%60;return t=t.toString(),n=n.toString(),r=r.toString(),"0"!==t&&(n=n.padStart(2,"0"),r=r.padStart(2,"0")),r=r.padStart(2,"0"),"0"===t?"".concat(n,":").concat(r):"".concat(t,":").concat(n,":").concat(r)},skipNext:function(){var e=this.songs.indexOf(this.activeSong);if(e===this.songs.length-1){if(!this.repeat)return void console.log("Not skipping, repeat is off");e=-1}this.shuffle?this.playSong(this.shuffledSongs[e+1]):this.playSong(this.songs[e+1])},skipPrevious:function(){var e=this.$refs.player;if(e.currentTime<5){var t=this.songs.indexOf(this.activeSong);0===t&&(t=this.songs.length),this.shuffle?this.playSong(this.shuffledSongs[t-1]):this.playSong(this.songs[t-1])}else e.currentTime=0},mouseUp:function(){this.seeking&&(this.seeking=!1)},mouseMove:function(e){this.seeking&&this.seekToEvent(e)},seekDown:function(e){this.seeking=!0,this.seekToEvent(e)},seekToEvent:function(e){var t=(e.pageX-this.$refs.seekContainer.offsetLeft)/this.$refs.seekContainer.offsetWidth;t=Math.max(Math.min(t,1),0),this.songProgress=t;var n=this.activeSong.duration_ms/1e3;this.$refs.player.currentTime=n*t},play:function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("play"),""!==this.activeSong.name){e.next=3;break}return e.abrupt("return");case 3:return this.playing=!0,e.next=6,this.$refs.player.play();case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),pause:function(){console.log("pause"),this.playing=!1,this.$refs.player.pause()},setSongMetaData:function(e){var t=this,n=e.artists.map((function(e){return e.name})).join(", ");document.title=n+" - "+e.name,"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:e.name,artist:n,artwork:[{src:e.album.images[0].url,type:"image/png"}]}),navigator.mediaSession.setActionHandler("play",Object(g["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.play();case 2:case"end":return e.stop()}}),e)})))),navigator.mediaSession.setActionHandler("pause",Object(g["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.pause();case 2:case"end":return e.stop()}}),e)})))),navigator.mediaSession.setActionHandler("previoustrack",(function(){t.skipNext()})),navigator.mediaSession.setActionHandler("nexttrack",(function(){t.skipPrevious()})))},playSong:function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(t){var n,r,s,a,o,i=this,c=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]&&c[1],t.id!==this.activeSong.id){e.next=5;break}return this.$refs.player.currentTime=0,n||this.play(),e.abrupt("return");case 5:return localStorage.lastPlayed=t.id,this.activeSong=t,this.setSongMetaData(t),r=t.artists.map((function(e){return e.name})).join(" ")+" - "+t.name,e.next=11,M.search(r);case 11:s=e.sent,a=M.getStreamUrl(s[0].id),o=this.$refs.player,o.src=a,o.oncanplay=Object(g["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i.playing=!n,n){e.next=4;break}return e.next=4,o.play();case 4:case"end":return e.stop()}}),e)}))),o.onended=function(){return i.skipNext()};case 17:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),getTracks:function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(t){var n,r,s,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=[],r="https://api.spotify.com/v1/me/tracks?limit=50";case 2:if(!r){e.next=12;break}return e.next=5,fetch(r,{method:"GET",headers:{Authorization:"Bearer "+t.token}});case 5:return e.next=7,e.sent.json();case 7:s=e.sent,r=s.next,n.push(s),e.next=2;break;case 12:return a=n.map((function(e){return e.items})).reduce((function(e,t){return e.concat(t)})),e.abrupt("return",a);case 14:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),getToken:function(){var e=Object(g["a"])(regeneratorRuntime.mark((function e(){var t,n,r,s,a,o,i,c,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(null===localStorage.getItem("token")){e.next=7;break}if(t=JSON.parse(localStorage.token),t.expires=+t.expires,n=Math.floor(+new Date/1e3),!(t.expires-n>=3e3)){e.next=7;break}return console.log("didnt request new token :)"),e.abrupt("return",t);case 7:if(r="cd272aa2194c46c7a460e9a202f66002",s=P?"http://localhost:8080/vuemusic/#/":"https://ruurd.dev/vuemusic/#/",!location.search.includes("error")){e.next=12;break}return document.write("Error, access was not granted"),e.abrupt("return");case 12:if(null===localStorage.getItem("state")&&(localStorage.state=Math.random()),location.hash.includes("access_token=")){e.next=17;break}return a="user-library-read",location.href="https://accounts.spotify.com/authorize?response_type=token&state=".concat(localStorage.state,"&client_id=").concat(r).concat(a?"&scope="+encodeURIComponent(a):"","&redirect_uri=").concat(encodeURIComponent(s)),e.abrupt("return");case 17:if(o=location.hash.split("access_token=")[1].split("&")[0],i=location.hash.split("token_type=")[1].split("&")[0],c=location.hash.split("expires_in=")[1].split("&")[0],u=location.hash.split("state=")[1].split("&")[0],this.$router.push("/"),u===localStorage.state){e.next=26;break}return document.write("Error, possible mitm attack, state doesn't match"),localStorage.state=Math.random(),e.abrupt("return");case 26:localStorage.state=Math.random(),localStorage.token=JSON.stringify({token:o,type:i,expires:Math.floor(+new Date/1e3)+ +c});case 28:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},name:"home",components:{SongList:S}},U=N,E=(n("f750"),Object(c["a"])(U,p,h,!1,null,"0964a177",null)),$=E.exports;r["default"].use(f["a"]);var A=new f["a"]({routes:[{path:"/",name:"home",component:$},{path:"/access_token*",name:"Token redirect",component:$}]}),J=n("9483");Object(J["a"])("".concat("/vuemusic/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var I=n("43f9"),D=n.n(I);n("51de"),n("9d4f");r["default"].use(D.a),r["default"].config.productionTip=!1,new r["default"]({router:A,render:function(e){return e(l)}}).$mount("#app")},6380:function(e,t,n){},"64a9":function(e,t,n){},"9d4f":function(e,t,n){},c202:function(e,t,n){"use strict";var r=n("c807"),s=n.n(r);s.a},c807:function(e,t,n){},f750:function(e,t,n){"use strict";var r=n("6380"),s=n.n(r);s.a}});
//# sourceMappingURL=app.541524c1.js.map