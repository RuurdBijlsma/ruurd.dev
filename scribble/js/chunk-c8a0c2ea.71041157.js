(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c8a0c2ea"],{"04fa":function(t,e,a){},"7d36":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"game"},[a("p",[t._v(t._s(t.guessWord))]),a("div",{staticClass:"game-content"},[a("div",{staticClass:"users"},t._l(t.everyone,(function(e){return a("div",[a("img",{attrs:{src:e.avatar,alt:"User avatar"}}),e.name?a("p",[t._v(t._s(e.name))]):a("p",[a("i",[t._v("Unnamed")])])])})),0),a("div",{staticClass:"draw-content"},[t.activePlayer!==t.me?a("video",{ref:"streamViewer",staticClass:"stream-viewer",attrs:{controls:"",autoplay:"",width:"800",height:"420"},domProps:{srcObject:null!==t.activePlayer?t.activePlayer.stream:null}}):t._e(),a("simple-draw",{directives:[{name:"show",rawName:"v-show",value:t.activePlayer===t.me,expression:"activePlayer === me"}],ref:"draw",staticClass:"draw",attrs:{updateCanvas:t.activePlayer===t.me}})],1),a("div",{staticClass:"chat"},[a("v-form",{attrs:{autocomplete:"off"},on:{submit:t.sendChat}},[a("div",{staticClass:"chat-content"},t._l(t.chatMessages,(function(e){return a("p",{key:e.id,staticClass:"chat-message"},[a("span",{staticClass:"chat-message-user",style:"color: "+t.stringToColor(e.user.id)},[t._v(t._s(e.user.name))]),a("span",{staticClass:"chat-message-text"},[t._v(t._s(e.text))])])})),0),a("v-text-field",{staticClass:"chat-field",attrs:{auto:"",filled:""},model:{value:t.chatText,callback:function(e){t.chatText=e},expression:"chatText"}}),a("v-btn",{staticClass:"chat-icon",attrs:{type:"submit",icon:""}},[a("v-icon",[t._v("mdi-send")])],1)],1)],1)])])},r=[],n=(a("99af"),a("7db0"),a("fb6a"),a("d3b7"),a("25f0"),a("4f96")),o=a("2909"),i=(a("96cf"),a("1da1")),c=a("3556"),u=a("21ca"),l={name:"Game",components:{SimpleDraw:c["a"]},data:function(){return{host:!1,settings:null,me:new u["a"]({}),others:[],everyone:[],mesh:null,activePlayer:null,currentRound:0,guessWord:"",chatText:"",chatMessages:[]}},mounted:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:0,t.mesh=t.$store.state.mesh,t.settings=t.$store.state.game.settings,t.me=t.$store.state.game.me,t.others=t.$store.state.game.others,t.everyone=[t.me].concat(Object(o["a"])(t.others)).sort((function(t,e){return t>e?1:-1})),a=t.others.length,0===a&&t.hostStart(),t.mesh.on("data",(function(e,s){var r=t.everyone.find((function(t){return t.id===e})),o=JSON.parse(s),i=Object(n["a"])(o),c=i[0],u=i.slice(1);switch(console.log("Received data",c,u),c){case"loaded":if(!t.me.host)break;--a<=0&&t.hostStart(),console.log("id",e,"user",r,"loaded",u,"loadRemaining",a);break;case"start":t.clientStart();break;case"startRound":var l=t.everyone.find((function(t){return t.id===u[0]}));t.generalStartRound(l);break;case"word":t.setGuessWord(u[0]);break;case"chat":t.submitChatText(r,u[0]);break}})),t.mesh.on("stream",(function(e,a){console.log("Received stream",e,a);var s=t.everyone.find((function(t){return t.id===e}));s.stream=a})),t.me.host?(console.log("me is host",t.me,t.me.host),t.mesh.broadcast(["start",t.settings])):(s=t.others.find((function(t){return t.host})),console.log("me is not host",t.me,t.me.host,"found host:",s),t.mesh.send(s.id,["loaded"]));case 11:case"end":return e.stop()}}),e)})))()},methods:{hostStart:function(){console.log("[HOST START]"),this.generalStart(),this.generalStartRound(this.everyone[0]),this.mesh.broadcast(["start"]),this.mesh.broadcast(["startRound",this.activePlayer.id])},clientStart:function(){console.log("[clientStart]"),this.generalStart()},generalStart:function(){console.log("[generalStart]"),this.mesh.broadcastStream(this.$refs.draw.getStream())},generalStartRound:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:console.log("[generalStartRound]"),e.currentRound++,e.activePlayer=t,e.activePlayer===e.me&&e.startRound();case 4:case"end":return a.stop()}}),a)})))()},startRound:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("[startRound]"),e.next=3,t.chooseWord();case 3:a=e.sent,t.mesh.broadcast(["word",a]),t.setGuessWord(a);case 6:case"end":return e.stop()}}),e)})))()},chooseWord:function(){return Object(i["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("[chooseWord]"),t.abrupt("return",new Promise((function(t){t("ladder")})));case 2:case"end":return t.stop()}}),t)})))()},setGuessWord:function(t){this.guessWord=t},sendChat:function(t){t.preventDefault(),this.mesh.broadcast(["chat",this.chatText]),this.submitChatText(this.me,this.chatText),this.chatText=""},submitChatText:function(t,e){this.text===this.guessWord&&alert("you are winner"),this.chatMessages.push({id:Math.floor(1e6*Math.random()),text:e,user:t})},stringToColor:function(t){var e=function(t){for(var e=0,a=0;a<t.length;a++)e=t.charCodeAt(a)+((e<<5)-e);return e},a=function(t){var e=(16777215&t).toString(16).toUpperCase();return"00000".substring(0,6-e.length)+e};return"#"+a(e(t))}}},h=l,d=(a("9fbf"),a("2877")),m=a("6544"),f=a.n(m),v=a("8336"),g=a("4bd4"),p=a("132d"),b=a("8654"),w=Object(d["a"])(h,s,r,!1,null,"e03c8b44",null);e["default"]=w.exports;f()(w,{VBtn:v["a"],VForm:g["a"],VIcon:p["a"],VTextField:b["a"]})},"9fbf":function(t,e,a){"use strict";var s=a("04fa"),r=a.n(s);r.a}}]);
//# sourceMappingURL=chunk-c8a0c2ea.71041157.js.map