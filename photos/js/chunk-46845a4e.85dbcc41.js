(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-46845a4e"],{"27c8":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"trash",style:{maxHeight:"calc(100vh - "+(t.$vuetify.application.top+t.$vuetify.application.bottom)+"px)"}},[a("div",{staticClass:"container"},[t.trashItems.length>0?a("div",{staticClass:"trash-items"},[a("h2",{staticClass:"mb-4"},[t._v("Trash")]),a("div",{staticClass:"items"},t._l(t.trashItems,(function(e){return a("v-card",{key:e.filePath,staticClass:"mb-8",attrs:{"max-width":350}},[a("v-img",{attrs:{"max-height":200,src:t.api+"/photos/blocked/"+e.id}}),a("v-card-title",[t._v(t._s(e.filePath))]),a("v-card-subtitle",[t._v(" Deleted at "+t._s(t.formatDate(e.createdAt))+" ")]),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{loading:e.loading,icon:"",color:"primary"},on:{click:function(a){return t.downloadItem(e)}}},[a("v-icon",[t._v("mdi-download")])],1)],1)],1)})),1)]):a("h2",[t._v("No items in trash")]),t.errorItems.length>0?a("div",{staticClass:"failed-items mt-10"},[a("h2",{staticClass:"mb-4"},[t._v("Failed to process")]),a("div",{staticClass:"items"},t._l(t.errorItems,(function(e){return a("v-card",{key:e.filePath,staticClass:"mb-8",attrs:{"max-width":350}},[a("v-img",{attrs:{"max-height":200,src:t.api+"/photos/blocked/"+e.id}}),a("v-card-title",[t._v(t._s(e.filePath))]),a("v-card-subtitle",[t._v(" Failed at "+t._s(t.formatDate(e.createdAt))+" "),a("v-divider",{staticClass:"mt-2 mb-2"}),t._l(t.errorLines(e),(function(e){return a("p",{staticClass:"error-line"},[t._v(t._s(e))])}))],2),a("v-card-actions",[a("v-spacer"),a("v-btn",{attrs:{loading:e.loading,icon:"",color:"primary"},on:{click:function(a){return t.downloadItem(e)}}},[a("v-icon",[t._v("mdi-download")])],1),a("v-btn",{attrs:{loading:e.retrying,text:"",color:"primary"},on:{click:function(a){return t.retry(e)}}},[t._v("Retry")])],1)],1)})),1)]):t._e()])])},n=[],s=a("1da1"),i=(a("96cf"),a("4de4"),a("d3b7"),a("99af"),a("3ca3"),a("ddb0"),a("2b3d"),a("ac1f"),a("1276"),a("b166")),o=a("2b0e"),c=a("1a43"),d=o["default"].extend({name:"Trash",components:{},data:function(){return{trashItems:[],errorItems:[],api:c["a"]}},mounted:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("apiRequest",{url:"photos/blockedItems"});case 2:a=e.sent,t.trashItems=a.filter((function(t){return"deleted"===t.reason})),t.errorItems=a.filter((function(t){return"error"===t.reason})),console.log(t.trashItems,t.errorItems);case 6:case"end":return e.stop()}}),e)})))()},methods:{retry:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o["default"].set(t,"retrying",!0),a.next=3,e.$store.dispatch("apiRequest",{url:"photos/retryProcess",body:{filePath:t.filePath}});case 3:r=a.sent,!1===r.success?e.$store.dispatch("addSnack",{text:"Failed to process item again"}):e.$store.dispatch("addSnack",{text:"Processed item successfully",toText:"Visit",to:"/photo/".concat(r.id)}),o["default"].set(t,"retrying",!1);case 6:case"end":return a.stop()}}),a)})))()},downloadItem:function(t){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,n,s,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o["default"].set(t,"downloading",!0),a.prev=1,a.next=4,fetch("".concat(c["a"],"/photos/blocked/").concat(t.id)).then((function(t){return t.blob()}));case 4:if(r=a.sent,!("text/html"===r.type&&r.size<1e3)){a.next=8;break}throw e.$store.dispatch("addSnack",{text:"Item not found on server!"}),new Error("Not found");case 8:console.log(r),n=window.URL.createObjectURL(r),s=document.createElement("a"),s.style.display="none",s.href=n,i=t.filePath.split("/"),s.download=i[i.length-1],document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(n),a.next=23;break;case 20:a.prev=20,a.t0=a["catch"](1),console.warn("Download failed",a.t0);case 23:return a.prev=23,o["default"].set(t,"downloading",!1),a.finish(23);case 26:case"end":return a.stop()}}),a,null,[[1,20,23,26]])})))()},errorLines:function(t){var e,a,r,n;return null!==(e=null===t||void 0===t||null===(a=t.error)||void 0===a||null===(r=a.message)||void 0===r||null===(n=r.split)||void 0===n?void 0:n.call(r,"\n"))&&void 0!==e?e:[]},formatDate:function(t){return Object(i["a"])(new Date(t),"H:mm:ss, eeee dd MMMM yyyy")}}}),l=d,u=(a("aeba"),a("2877")),m=a("6544"),f=a.n(m),h=a("8336"),v=a("b0af"),p=a("99d9"),b=a("ce7e"),w=a("132d"),g=a("adda"),y=a("2fa4"),k=Object(u["a"])(l,r,n,!1,null,"44623cf2",null);e["default"]=k.exports;f()(k,{VBtn:h["a"],VCard:v["a"],VCardActions:p["a"],VCardSubtitle:p["b"],VCardTitle:p["d"],VDivider:b["a"],VIcon:w["a"],VImg:g["a"],VSpacer:y["a"]})},aeba:function(t,e,a){"use strict";a("efbe")},efbe:function(t,e,a){}}]);
//# sourceMappingURL=chunk-46845a4e.85dbcc41.js.map