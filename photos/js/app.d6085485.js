(function(t){function e(e){for(var r,o,s=e[0],c=e[1],l=e[2],u=0,h=[];u<s.length;u++)o=s[u],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&h.push(a[o][0]),a[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);d&&d(e);while(h.length)h.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],r=!0,o=1;o<n.length;o++){var s=n[o];0!==a[s]&&(r=!1)}r&&(i.splice(e--,1),t=c(c.s=n[0]))}return t}var r={},o={app:0},a={app:0},i=[];function s(t){return c.p+"js/"+({}[t]||t)+"."+{"chunk-078598d1":"4dc75ae4","chunk-1385e022":"963db354","chunk-704590ec":"2f215d36"}[t]+".js"}function c(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.e=function(t){var e=[],n={"chunk-078598d1":1,"chunk-1385e022":1,"chunk-704590ec":1};o[t]?e.push(o[t]):0!==o[t]&&n[t]&&e.push(o[t]=new Promise((function(e,n){for(var r="css/"+({}[t]||t)+"."+{"chunk-078598d1":"3f3a78a0","chunk-1385e022":"5c698d0d","chunk-704590ec":"2efca91c"}[t]+".css",a=c.p+r,i=document.getElementsByTagName("link"),s=0;s<i.length;s++){var l=i[s],u=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(u===r||u===a))return e()}var h=document.getElementsByTagName("style");for(s=0;s<h.length;s++){l=h[s],u=l.getAttribute("data-href");if(u===r||u===a)return e()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=e,d.onerror=function(e){var r=e&&e.target&&e.target.src||a,i=new Error("Loading CSS chunk "+t+" failed.\n("+r+")");i.code="CSS_CHUNK_LOAD_FAILED",i.request=r,delete o[t],d.parentNode.removeChild(d),n(i)},d.href=a;var p=document.getElementsByTagName("head")[0];p.appendChild(d)})).then((function(){o[t]=0})));var r=a[t];if(0!==r)if(r)e.push(r[2]);else{var i=new Promise((function(e,n){r=a[t]=[e,n]}));e.push(r[2]=i);var l,u=document.createElement("script");u.charset="utf-8",u.timeout=120,c.nc&&u.setAttribute("nonce",c.nc),u.src=s(t);var h=new Error;l=function(e){u.onerror=u.onload=null,clearTimeout(d);var n=a[t];if(0!==n){if(n){var r=e&&("load"===e.type?"missing":e.type),o=e&&e.target&&e.target.src;h.message="Loading chunk "+t+" failed.\n("+r+": "+o+")",h.name="ChunkLoadError",h.type=r,h.request=o,n[1](h)}a[t]=void 0}};var d=setTimeout((function(){l({type:"timeout",target:u})}),12e4);u.onerror=u.onload=l,document.head.appendChild(u)}return Promise.all(e)},c.m=t,c.c=r,c.d=function(t,e,n){c.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)c.d(n,r,function(e){return t[e]}.bind(null,r));return n},c.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(e,"a",e),e},c.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},c.p="/photos/",c.oe=function(t){throw console.error(t),t};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],u=l.push.bind(l);l.push=e,l=l.slice();for(var h=0;h<l.length;h++)e(l[h]);var d=u;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("cd49")},"034f":function(t,e,n){"use strict";n("85ec")},"1a43":function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r="https://api.ruurd.dev"},"3d36":function(t,e,n){"use strict";n("eb5c")},5024:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"frame",staticClass:"photo-grid"},t._l(t.photoRows,(function(e){return n("div",{ref:"rows",refInFor:!0,staticClass:"block-row"},t._l(e,(function(e){return n("div",{staticClass:"photo-block"},[n("div",{staticClass:"block-day",class:{"hide-date":e.hideDate},style:{maxWidth:Math.floor(e.width)+"px"},attrs:{title:e.day}},[t._v(" "+t._s(e.day)+" ")]),n("div",{staticClass:"photos"},t._l(e.layoutMedias,(function(r){var o=r.media,a=r.visualWidth,i=r.visualHeight;return n("router-link",{key:o.id,staticClass:"photo",style:{height:i+"px",width:a+"px"},attrs:{to:t.currentPath+"/photo/"+o.id}},["photo"===o.type?n("div",{staticClass:"image-container"},[n("div",{staticClass:"image-background",style:{backgroundImage:"url("+t.getThumbUrl(o.id,e.height)+")"}}),n("div",{staticClass:"image-overlay"},[n("div",{staticClass:"image-info"},["vr"===o.subType?n("v-icon",{staticClass:"icon",attrs:{color:"white"}},[t._v(" mdi-rotate-3d-variant ")]):"portrait"===o.subType?n("v-icon",{staticClass:"icon",attrs:{color:"white"}},[t._v(" mdi-blur ")]):t._e()],1)])]):n("div",{staticClass:"video-container",on:{mouseleave:function(e){return t.pauseVideo(o.id)},mouseenter:function(e){return t.playVideo(o.id)}}},[n("video",{ref:"video"+o.id,refInFor:!0,attrs:{poster:""+t.getThumbUrl(o.id,e.height),muted:"",loop:"",src:t.api+"/photos/webm/"+o.id+".webm"},domProps:{muted:!0}}),n("div",{staticClass:"video-overlay"},[n("div",{staticClass:"video-info"},[n("span",{staticClass:"video-duration"},[t._v(t._s(t.toHms(o.duration/1e3)))]),"none"===o.subType?n("v-icon",{staticClass:"icon",attrs:{color:"white"}},[t._v(" mdi-play-circle-outline ")]):"slomo"===o.subType?n("v-icon",{staticClass:"icon",attrs:{color:"white"}},[t._v(" mdi-play-speed ")]):t._e()],1)])])])})),1)])})),0)})),0)},o=[],a=n("b85c"),i=n("3835"),s=n("1da1"),c=(n("99af"),n("d81d"),n("fb6a"),n("8a79"),n("96cf"),n("2b0e")),l=n("1a43");n("d3b7"),n("25f0"),n("4d90");function u(t){if(isNaN(t)||void 0===t)return"0:00";t=Math.round(t);var e=Math.floor(t/3600),n=Math.floor(t%3600/60),r=t%60,o=e.toString(),a=n.toString(),i=r.toString();return"0"!==o&&(a=a.padStart(2,"0"),i=i.padStart(2,"0")),i=i.padStart(2,"0"),"0"===o?"".concat(a,":").concat(i):"".concat(o,":").concat(a,":").concat(i)}var h=c["a"].extend({name:"PhotoGrid",props:{photos:{type:Array,required:!0},timeline:{type:Boolean,default:!1}},data:function(){return{photoRows:[],frameWidth:window.innerWidth-256,api:l["a"]}},beforeDestroy:function(){window.removeEventListener("resize",this.onResize)},mounted:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.updateFrameWidth(),e.next=3,t.calculateLayout();case 3:window.addEventListener("resize",t.onResize,!1);case 4:case"end":return e.stop()}}),e)})))()},methods:{getThumbUrl:function(t,e){return"".concat(l["a"],"/photos/").concat(e>260?"small":"tiny","/").concat(t,".webp")},calculateLayout:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var n,r,o,s,c,l,u,h,d,p,f,m,v,g,b,y,w,x,M,S,k,P,O,T,j,L,R,D,E,C,$,_,q,F,V,H,I,A,N,W,G,B,Y,U,J,z,K,Q,X,Z,tt,et,nt,rt,ot,at,it,st,ct,lt,ut,ht;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.photos.map((function(t){return{media:t,visualWidth:0,visualHeight:0}})),0!==n.length){e.next=4;break}return t.photoRows=[],e.abrupt("return");case 4:t.updateFrameWidth(),r=(new Date).getFullYear(),o=(new Date).toDateString(),s=new Date((new Date).getTime()-864e5).toDateString(),c=function(t){var e=t.toDateString(),n=t.getMonth()+1,a=t.getTime();return e===o?["Today",n,a]:e===s?["Yesterday",n,a]:t.getFullYear()===r?[e.substr(0,e.length-5),n,a]:[e,n,a]},l=c(n[0].media.createDate),u=Object(i["a"])(l,3),h=u[0],d=u[1],p=u[2],f={day:h,month:d,date:p,layoutMedias:[]},m=[],v=Object(a["a"])(n);try{for(v.s();!(g=v.n()).done;)b=g.value,y=c(b.media.createDate),w=Object(i["a"])(y,3),x=w[0],M=w[1],S=w[2],f.day!==x&&(m.push(f),f={day:x,month:M,layoutMedias:[],date:S}),f.layoutMedias.push(b)}catch(dt){v.e(dt)}finally{v.f()}for(m.push(f),k=t.frameWidth-2,P=150+Math.min(window.innerWidth/30,64),O=[],T=[],j={layoutMedias:[],day:h,month:d,date:p,width:0,height:0,hideDate:!1},L=0,R=0,D=0,E=m;D<E.length;D++){C=E[D],$=C.day,_=C.month,q=Object(a["a"])(C.layoutMedias);try{for(q.s();!(F=q.n()).done;)V=F.value,H=P*V.media.ratio,I=L+H,A=k-L,N=C.layoutMedias.length,W=_!==j.month,G=$!==j.day,B=I>k||G&&A-H<100||G&&N>3||G&&R>3||t.timeline&&W,(B||G)&&(j.layoutMedias.length>0&&T.push(j),j={layoutMedias:[],day:$,width:0,height:0,hideDate:B&&!G,month:_,date:C.date},B&&(T.length>0&&O.push(T),T=[],L=0)),L+=H,j.layoutMedias.push(V)}catch(dt){q.e(dt)}finally{q.f()}R=C.layoutMedias.length}for(T.push(j),O.push(T),Y=5,U=40,J=0,z=O;J<z.length;J++){K=z[J],Q=[],X=Object(a["a"])(K);try{for(X.s();!(Z=X.n()).done;)tt=Z.value,tt.width=tt.layoutMedias.map((function(t){return t.media.ratio*P})).reduce((function(t,e){return t+e})),Q.push(tt.width)}catch(dt){X.e(dt)}finally{X.f()}et=Q.reduce((function(t,e){return t+e})),nt=K.map((function(t){return(t.layoutMedias.length-1)*Y})),rt=(K.length-1)*U,ot=nt.reduce((function(t,e){return t+e}))+rt,at=(k-ot)/et,at>2.1&&(at=1),it=Object(a["a"])(K);try{for(it.s();!(st=it.n()).done;){ct=st.value,ct.height=P*at,lt=Object(a["a"])(ct.layoutMedias);try{for(lt.s();!(ut=lt.n()).done;)ht=ut.value,ht.visualHeight=P*at,ht.visualWidth=P*ht.media.ratio*at}catch(dt){lt.e(dt)}finally{lt.f()}}}catch(dt){it.e(dt)}finally{it.f()}}t.photoRows=O,t.$emit("photoRowsUpdate");case 30:case"end":return e.stop()}}),e)})))()},onResize:function(){this.$vuetify.breakpoint.width===window.innerWidth&&this.$vuetify.breakpoint.height===window.innerHeight||requestAnimationFrame(this.calculateLayout)},updateFrameWidth:function(){var t,e;this.frameWidth=null!==(t=null===(e=this.$refs.frame)||void 0===e?void 0:e.clientWidth)&&void 0!==t?t:window.innerWidth-this.$vuetify.application.left},playVideo:function(t){var e,n,r=null===(e=this.$refs["video"+t])||void 0===e?void 0:e[0];null===r||void 0===r||null===(n=r.play)||void 0===n||n.call(r)},pauseVideo:function(t){var e,n,r=null===(e=this.$refs["video"+t])||void 0===e?void 0:e[0];null===r||void 0===r||null===(n=r.pause)||void 0===n||n.call(r)},scrollIntoView:function(t,e,n){var r=new Date;r.setFullYear(n),r.setMonth(e-1),r.setDate(t);var o=r.getTime(),a=this.photoRows;while(1){var i=Math.floor(a.length/2),s=a[i][0].date;if(a=o<s?a.slice(i):a.slice(0,i),1===a.length)break}var c=this.$refs.rows;console.log("Scrolling into view",t,e,n),c[this.photoRows.indexOf(a[0])].scrollIntoView()},toHms:function(t){return u(t)}},computed:{currentPath:function(){var t=this.$route.path;return t.endsWith("/")?t.substr(0,t.length-1):t}},watch:{photos:function(){requestAnimationFrame(this.calculateLayout)}}}),d=h,p=(n("e16a"),n("2877")),f=n("6544"),m=n.n(f),v=n("132d"),g=Object(p["a"])(d,r,o,!1,null,"06641cbe",null);e["a"]=g.exports;m()(g,{VIcon:v["a"]})},"73b2":function(t,e,n){t.exports=n.p+"img/transparent-icon-512.e6e999bf.png"},"85ec":function(t,e,n){},b0d1:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n("b85c"),o=n("d4ec"),a=n("bee2"),i=(n("d81d"),n("07ac"),n("caad"),function(){function t(e,n,r,a,i,s,c){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,p=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};Object(o["a"])(this,t),this.id=e,this.filename=n,this.createDate=r,this.width=a,this.height=i,this.type=s,this.duration=l,this.subType=c,this.classifications=u,this.location=h,this.size=d,this.exif=p}return Object(a["a"])(t,[{key:"ratio",get:function(){return 0===this.height?1:this.width/this.height}}],[{key:"fromObject",value:function(e){var n,o,a=e.id,i=void 0===a?"":a,s=e.filename,c=void 0===s?"":s,l=e.createDate,u=void 0===l?"":l,h=e.width,d=void 0===h?0:h,p=e.height,f=void 0===p?0:p,m=e.type,v=void 0===m?"":m,g=e.subType,b=void 0===g?"":g,y=e.durationMs,w=void 0===y?null:y,x=e.MediaClassifications,M=void 0===x?null:x,S=e.MediaLocation,k=void 0===S?null:S,P=e.bytes,O=void 0===P?"-1":P,T=e.exif,j=void 0===T?{}:T;b=b.toLowerCase(),v=v.toLowerCase();var L=k?{latitude:k.latitude,longitude:k.longitude,altitude:k.altitude,places:null===(n=k.MediaPlaces)||void 0===n||null===(o=n.map)||void 0===o?void 0:o.call(n,(function(t){return{type:t.type,name:t.text}}))}:null,R=M?M.map((function(t){var e,n={},o=Object(r["a"])(t.MediaGlossaries);try{for(o.s();!(e=o.n()).done;){var a=e.value,i=a.level,s=a.text;n[i]={glossary:s,level:i}}}catch(p){o.e(p)}finally{o.f()}var c,l=Object(r["a"])(t.MediaLabels);try{for(l.s();!(c=l.n()).done;){var u=c.value,h=u.level,d=u.text;n[h].labels||(n[h].labels=[]),n[h].labels.push(d)}}catch(p){l.e(p)}finally{l.f()}return{confidence:t.confidence,levels:Object.values(n)}})):null;return new t(i,c,new Date(u),d,f,"image"===v?"photo":"video",["portrait","vr","slomo"].includes(b)?b:"none",w,R,L,isFinite(+O)?+O:null,j)}}]),t}())},cd49:function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),o=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-app",{staticClass:"app"},[r("v-app-bar",{attrs:{elevation:"0",app:"","clipped-left":""}},[r("img",{staticClass:"logo-icon",attrs:{src:n("73b2"),alt:"icon"}}),r("v-app-bar-title",{staticClass:"logo-text"},[t._v("Photos")]),r("v-spacer"),r("v-text-field",{attrs:{dense:"",solo:"","hide-details":"",label:"Search...","append-icon":"mdi-magnify"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.startSearch(e)}},model:{value:t.query,callback:function(e){t.query=e},expression:"query"}}),r("v-spacer"),r("v-btn",{attrs:{icon:""}},[r("v-icon",[t._v("mdi-cog")])],1)],1),r("v-navigation-drawer",{attrs:{"expand-on-hover":!0,permanent:"",app:"",floating:"",clipped:"","hide-overlay":""}},[r("v-list",{attrs:{dense:"",nav:""}},[r("v-list-item",{attrs:{to:"/",exact:""}},[r("v-list-item-icon",[r("v-icon",[t._v("mdi-home-outline")])],1),r("v-list-item-content",[r("v-list-item-title",[t._v("Photos")])],1)],1),r("v-list-item",{attrs:{to:"/explore",exact:""}},[r("v-list-item-icon",[r("v-icon",[t._v("mdi-magnify")])],1),r("v-list-item-content",[r("v-list-item-title",[t._v("Explore")])],1)],1),r("v-list-item",{attrs:{to:"/map",exact:""}},[r("v-list-item-icon",[r("v-icon",[t._v("mdi-earth")])],1),r("v-list-item-content",[r("v-list-item-title",[t._v("Photo map")])],1)],1)],1)],1),r("v-main",[r("router-view")],1)],1)},a=[],i=n("1da1"),s=(n("96cf"),n("b0c0"),r["a"].extend({name:"App",data:function(){return{query:""}},mounted:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.$route.params.query&&(console.warn("setting query"),t.query=t.$route.params.query),t.$store.getters.isLoggedIn||"Login"===t.$route.name){e.next=4;break}return e.next=4,t.$router.push("/login");case 4:console.log(t.$store);case 5:case"end":return e.stop()}}),e)})))()},methods:{startSearch:function(){""!==this.query&&void 0!==this.query&&(this.$route.params.query===this.query?this.$store.dispatch("search",this.query):"Search"===this.$route.name?(this.$router.push("/search/".concat(this.query)),this.$store.dispatch("search",this.query)):this.$router.push({path:"/search/".concat(this.query)}))}},watch:{"$route.params.query":function(){this.query=this.$route.params.query}}})),c=s,l=(n("034f"),n("2877")),u=n("6544"),h=n.n(u),d=n("7496"),p=n("40dc"),f=n("bb78"),m=n("8336"),v=n("132d"),g=n("8860"),b=n("da13"),y=n("5d23"),w=n("34c3"),x=n("f6c4"),M=n("f774"),S=n("2fa4"),k=n("8654"),P=Object(l["a"])(c,o,a,!1,null,null,null),O=P.exports;h()(P,{VApp:d["a"],VAppBar:p["a"],VAppBarTitle:f["a"],VBtn:m["a"],VIcon:v["a"],VList:g["a"],VListItem:b["a"],VListItemContent:y["a"],VListItemIcon:w["a"],VListItemTitle:y["b"],VMain:x["a"],VNavigationDrawer:M["a"],VSpacer:S["a"],VTextField:k["a"]});var T=n("9483");Object(T["a"])("".concat("/photos/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(t){console.error("Error during service worker registration:",t)}});n("d3b7"),n("3ca3"),n("ddb0");var j=n("8c4f"),L=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"home",staticClass:"home",on:{scroll:t.homeScroll}},[n("router-view"),t.initialLoading?n("div",{staticClass:"progress-center"},[n("v-progress-circular",{attrs:{color:"primary",size:t.$vuetify.breakpoint.width/4,indeterminate:""}})],1):0===t.flatPhotos.length?n("div",{staticClass:"no-results"},[n("div",{staticClass:"no-results-center"},[n("v-icon",{staticClass:"icon",attrs:{"x-large":""}},[t._v("mdi-image")]),n("div",{staticClass:"caption"},[t._v('No photos"')])],1)]):t._e(),n("div",{staticClass:"grid"},[t.topLoaded||t.initialLoading?t._e():n("div",{staticClass:"loading-top"},[n("v-progress-linear",{attrs:{indeterminate:""}})],1),n("photo-grid",{ref:"photoGrid",attrs:{timeline:"",photos:t.flatPhotos}}),t.bottomLoaded||t.initialLoading?t._e():n("div",{staticClass:"loading-bottom"},[n("v-progress-linear",{attrs:{indeterminate:""}})],1)],1),n("canvas",{ref:"scrubber",staticClass:"scrubber",attrs:{width:100,height:t.canvasHeight}}),n("div",{staticClass:"scrubber scrubber-events",on:{mouseenter:function(e){t.overScrub=!0},mouseleave:function(e){t.overScrub=!1},mousedown:t.scrubStart}})],1)},R=[],D=n("2909"),E=n("3835"),C=n("b85c"),$=(n("d81d"),n("99af"),n("25f0"),n("b680"),n("a434"),n("a15b"),n("0481"),n("b0d1")),_=n("5024"),q=n("1a43"),F=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],V=new Date,H=r["a"].extend({name:"Home",components:{PhotoGrid:_["a"]},data:function(){return{api:q["a"],photosPerMonth:[],photos:[],homeElement:{},canvas:{},context:{},photoGrid:null,scrollMonthStart:0,scrollLoadPromise:null,scrolling:!1,scrollData:{y:0,year:V.getFullYear(),month:V.getMonth()+1,day:V.getDate()},scrollTimeout:-1,prevScroll:-2e3,scrollThreshold:4e3,gettingPhotos:!1,scrubbing:!1,scrubTimeout:-1,lastScrubTimestamp:-1,overScrub:!1,scrubData:{y:0,year:V.getFullYear(),month:V.getMonth()+1},maxPhotos:800,initialLoading:!0}},beforeDestroy:function(){document.removeEventListener("mousemove",this.scrubMove),document.removeEventListener("mouseup",this.scrubEnd)},mounted:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return document.addEventListener("mousemove",t.scrubMove,!1),document.addEventListener("mouseup",t.scrubEnd,!1),t.canvas=t.$refs.scrubber,t.context=t.canvas.getContext("2d"),e.next=6,t.$store.dispatch("apiRequest",{url:"photos/months"});case 6:return n=e.sent,t.photosPerMonth=n.map((function(t){var e=t.year,n=void 0===e?0:e,r=t.month,o=void 0===r?0:r,a=t.count,i=void 0===a?0:a;return{year:n,month:o,count:i,loaded:!1}})),e.next=10,t.getPhotos({monthOffset:0});case 10:t.photos=e.sent,t.initialLoading=!1,t.homeElement=t.$refs.home,t.photoGrid=t.$refs.photoGrid,t.render(),t.photoGrid.$once("photoRowsUpdate",(function(){return t.$nextTick((function(){t.scrollData=t.getScrollData()}))}));case 16:case"end":return e.stop()}}),e)})))()},methods:{render:function(){requestAnimationFrame(this.render),this.context.clearRect(0,0,this.canvas.width,this.canvas.height);var t=!this.scrubbing&&!this.overScrub;this.drawYears(t),(this.overScrub||this.scrubbing)&&this.drawScrollThumb(this.scrubData.y,this.scrubData.year,this.scrubData.month),this.scrolling&&!this.scrubbing?this.drawScrollThumb(this.scrollData.y,this.scrollData.year,this.scrollData.month,!0):this.scrubbing||this.drawScrollThumb(this.scrollData.y,this.scrollData.year,this.scrollData.month,!0,!1)},drawLoadedRegion:function(){for(var t=0,e=0,n=0;n<this.scrollMonthStart;n++){var r=this.photosPerMonth[n];t+=r.count/this.totalPhotos}for(var o=this.scrollMonthStart;o<this.scrollMonthStart+this.scrollMonthLength;o++){var a=this.photosPerMonth[o];e+=a.count/this.totalPhotos}this.context.fillStyle="rgba(50,255,100,0.3)";var i=50;this.context.fillRect(this.canvas.width-i,t*this.canvas.height,i,e*this.canvas.height)},drawScrollThumb:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=15,i=a+10+3;t<i&&o&&(t=i);var s=this.$vuetify.theme.dark;this.context.fillStyle=this.$vuetify.theme.themes[s?"dark":"light"].primary;var c=r?35:50;if(this.context.fillRect(this.canvas.width-c,t,c,r?2:3),this.context.fillStyle="rgba(255,255,255,0.8)",o){var l="".concat(F[n-1]," ").concat(e),u=this.context.measureText(l),h=u.width;this.context.fillRect(this.canvas.width-h-10,t-a-10,h+10,a+10),this.context.fillStyle="black",this.context.fillText(l,this.canvas.width-h-5,t-a+5)}},drawYears:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.context.fillStyle=t?"rgba(0,0,0,0.5)":"black";var e=0,n=-1,r=12;this.context.font="".concat(r,"px Roboto");var o,a=Object(C["a"])(this.photosPerMonth);try{for(a.s();!(o=a.n()).done;){var i=o.value;if(i.year!==n){n=i.year;var s=n.toString(),c=this.context.measureText(s),l=c.width;this.context.fillText(s,this.canvas.width-l-5,e+r)}e+=Math.round(i.count/this.totalPhotos*(this.canvas.height-r))}}catch(u){a.e(u)}finally{a.f()}},scrubStart:function(t){this.scrubbing=!0,this.scrubByEvent(t)},scrubMove:function(t){var e=0,n=0,r=0,o=0;if(this.overScrub||this.scrubbing){var a=this.dateFromScrubEvent(t),i=Object(E["a"])(a,4);e=i[0],n=i[1],r=i[2],o=i[3]}if(this.scrubbing&&this.scrub(e,n,r,o),this.overScrub||this.scrubbing){var s=t.pageY-this.$vuetify.application.top;this.scrubData={y:s,year:o,month:r}}},scrubEnd:function(t){if(this.scrubbing){this.scrubbing=!1,clearTimeout(this.scrubTimeout);var e=this.dateFromScrubEvent(t),n=Object(E["a"])(e,4),r=n[0],o=n[1],a=n[2],i=n[3];this.scrub(r,o,a,i)}},dateFromScrubEvent:function(t){var e=(t.pageY-this.$vuetify.application.top)/(this.$vuetify.breakpoint.height-this.$vuetify.application.top);e=Math.max(0,Math.min(1,1.01*e));var n=this.totalPhotos,r=n*e,o=0,a=0,i=0,s=0,c=0;for(a=0;a<this.photosPerMonth.length;a++){var l=this.photosPerMonth[a];if(o+l.count>=r){s=l.month,c=l.year;var u=new Date(c,s+1,0).getDate(),h=1-(r-o)/l.count;i=Math.floor(u*h);break}o+=l.count}return[a,i,s,c]},scrubByEvent:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,s,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.dateFromScrubEvent(t),o=Object(E["a"])(r,4),a=o[0],i=o[1],s=o[2],c=o[3],n.next=3,e.scrub(a,i,s,c);case 3:case"end":return n.stop()}}),n)})))()},scrub:function(t,e,n,r){var o=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!(t>=o.scrollMonthStart&&t<o.scrollMonthStart+o.scrollMonthLength)){a.next=4;break}return console.log("scroll to :",[e,n,r]),o.photoGrid.scrollIntoView(e,n,r),a.abrupt("return");case 4:i=performance.now(),o.lastScrubTimestamp=i,o.scrubTimeout=setTimeout((function(){i===o.lastScrubTimestamp&&o.loadScrubData(t,e,n,r)}),300);case 7:case"end":return a.stop()}}),a)})))()},loadScrubData:function(t,e,n,r){var o=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return console.log("scrub to :",[e,n,r]),t=Math.max(0,t-1),a.next=4,o.getPhotos({monthOffset:t,minimumMonths:2});case 4:i=a.sent,o.scrollMonthStart=t,console.log("start",o.scrollMonthStart,"length",o.scrollMonthLength),o.photos=i,o.scrollLoadPromise=new Promise((function(t){return setTimeout(t,200)})),o.photoGrid.$once("photoRowsUpdate",(function(){return o.$nextTick((function(){o.photoGrid.scrollIntoView(e,n,r),o.homeScroll()}))}));case 10:case"end":return a.stop()}}),a)})))()},getScrollData:function(){var t=V.getFullYear(),e=V.getMonth()+1,n=V.getDate(),r=this.homeElement.scrollTop+100,o=this.photoGrid.photoRows;if(0===o.length)return{y:0,year:t,month:e,day:n};var a,i=null,s=4,c=Object(C["a"])(o);try{for(c.s();!(a=c.n()).done;){var l,u=a.value,h=u[0].height+s,d=Object(C["a"])(u);try{for(d.s();!(l=d.n()).done;){var p=l.value;if(!p.hideDate){h+=22;break}}}catch(x){d.e(x)}finally{d.f()}if(r-=h,r<=0){i=u;break}}}catch(x){c.e(x)}finally{c.f()}null===i&&(i=o[o.length-1]);var f=new Date(i[0].date);e=f.getMonth()+1,t=f.getFullYear(),n=f.getDate();for(var m=0,v=0;v<this.scrollMonthStart;v++){var g=this.photosPerMonth[v];m+=g.count/this.totalPhotos}r=this.homeElement.scrollTop;var b=this.flatPhotos.length/this.totalPhotos,y=(r+this.homeElement.clientHeight)/this.homeElement.scrollHeight,w=(m+b*y)*this.canvas.height;return{y:w,year:t,month:e,day:n}},homeScroll:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.scrolling=!0,clearTimeout(t.scrollTimeout),t.scrollTimeout=setTimeout((function(){return t.scrolling=!1}),1e3),t.scrollData=t.getScrollData(),n=t.homeElement.scrollTop,!(Math.abs(t.prevScroll-n)<180)){e.next=7;break}return e.abrupt("return");case 7:if(t.prevScroll=n,r=t.homeElement.scrollHeight-n-t.homeElement.clientHeight,!(n<3e3||r<3e3)){e.next=14;break}return e.next=12,Promise.race([t.scrollLoadPromise,t.waitSleep(1)]);case 12:o=e.sent,o||(t.scrollLoadPromise=t.loadScrollData(r,n));case 14:case"end":return e.stop()}}),e)})))()},unloadMonths:function(){var t=this;if(this.flatPhotos.length>this.maxPhotos){var e=this.flatPhotos.length-Math.round(this.maxPhotos/2),n=(this.homeElement.scrollTop+this.homeElement.clientHeight/2)/this.homeElement.scrollHeight,r=this.homeElement.scrollTop,o=this.homeElement.scrollHeight-r-this.homeElement.clientHeight;if(console.log("too many photos! scrollPercent: ".concat(n.toFixed(2),", scrollTop: ").concat(r,", scrollBottom: ").concat(o)),n<.5&&o>this.scrollThreshold){for(var a=0,i=this.scrollMonthStart+this.scrollMonthLength-1;i>=this.scrollMonthStart;i--){if(e-=this.photosPerMonth[i].count,e<=0)break;a++}console.log({removeNMonths:a}),this.photos.splice(this.photos.length-a,a)}else if(n>=.5&&r>this.scrollThreshold){for(var s=0,c=this.scrollMonthStart;c<this.scrollMonthStart+this.photos.length;c++){if(e-=this.photosPerMonth[c].count,e<=0)break;s++}console.log({removeNMonths:s}),this.scrollMonthStart+=s,this.updatePhotosKeepScroll((function(){return t.photos.splice(0,s)}))}}},loadScrollData:function(t,e){var n=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var o,a,i,s,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!(e<n.scrollThreshold)||n.gettingPhotos){r.next=11;break}if(o=0===n.scrollMonthStart,!o){r.next=4;break}return r.abrupt("return");case 4:return r.next=6,n.getPhotos({monthOffset:n.scrollMonthStart-1,up:!0});case 6:return a=r.sent,n.scrollMonthStart-=a.length,r.next=10,n.updatePhotosKeepScroll((function(){var t;return(t=n.photos).unshift.apply(t,Object(D["a"])(a))}));case 10:n.unloadMonths();case 11:if(!(t<n.scrollThreshold)||n.gettingPhotos){r.next=22;break}if(s=n.scrollMonthStart+n.scrollMonthLength===n.photosPerMonth.length,!s){r.next=15;break}return r.abrupt("return");case 15:return r.next=17,n.getPhotos({monthOffset:n.scrollMonthStart+n.scrollMonthLength});case 17:return c=r.sent,(i=n.photos).push.apply(i,Object(D["a"])(c)),r.next=21,n.waitForLayoutUpdate();case 21:n.unloadMonths();case 22:case"end":return r.stop()}}),r)})))()},updatePhotosKeepScroll:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,s,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=null!==(r=e.homeElement.scrollHeight)&&void 0!==r?r:0,a=e.homeElement.scrollTop+e.homeElement.clientHeight,t(),n.next=5,e.waitForLayoutUpdate();case 5:i=0,s=e.homeElement.scrollHeight,a>s&&(i=a-e.homeElement.scrollTop),c=s-o,e.homeElement.scrollBy({top:c+i,left:0});case 10:case"end":return n.stop()}}),n)})))()},waitForLayoutUpdate:function(){var t=this;return new Promise((function(e){t.photoGrid.$once("photoRowsUpdate",(function(){return t.$nextTick((function(){e()}))}))}))},getPhotos:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,s,c,l,u,h,d,p,f;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=t.requestMinimum,o=void 0===r?50:r,a=t.monthOffset,i=void 0===a?0:a,s=t.minimumMonths,c=void 0===s?0:s,l=t.up,u=void 0!==l&&l,e.gettingPhotos=!0,h=[],d=i;case 4:if(!(u?d>=0:d<e.photosPerMonth.length)){n.next=13;break}if(p=e.photosPerMonth[d],h.push(p),o-=p.count,!(o<0&&h.length>=c)){n.next=10;break}return n.abrupt("break",13);case 10:d+=u?-1:1,n.next=4;break;case 13:return console.log("Requesting months",h.map((function(t){return[t.year,t.month].join(", ")}))),n.next=16,e.$store.dispatch("apiRequest",{url:"photos/month-photos",body:{months:h.map((function(t){return[t.year,t.month]}))}});case 16:return f=n.sent,u&&(f=f.reverse()),e.gettingPhotos=!1,n.abrupt("return",f.map((function(t){return t.map($["a"].fromObject)})));case 20:case"end":return n.stop()}}),n)})))()},waitSleep:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return new Promise((function(e){return setTimeout(e,t)}))}},computed:{topLoaded:function(){return 0===this.scrollMonthStart},bottomLoaded:function(){return this.scrollMonthStart+this.scrollMonthLength===this.photosPerMonth.length},scrollMonthLength:function(){return this.photos.length},flatPhotos:function(){return this.photos.flat()},canvasHeight:function(){return this.$vuetify.breakpoint.height-this.$vuetify.application.top-this.$vuetify.application.bottom},totalPhotos:function(){var t,e=0,n=Object(C["a"])(this.photosPerMonth);try{for(n.s();!(t=n.n()).done;){var r=t.value;e+=r.count}}catch(o){n.e(o)}finally{n.f()}return e}},watch:{flatPhotos:function(){this.$store.commit("viewerQueue",this.flatPhotos)}}}),I=H,A=(n("3d36"),n("490a")),N=n("8e36"),W=Object(l["a"])(I,L,R,!1,null,"339320b3",null),G=W.exports;h()(W,{VIcon:v["a"],VProgressCircular:A["a"],VProgressLinear:N["a"]}),r["a"].use(j["a"]);var B=[{path:"/",name:"Home",component:G,children:[{path:"/photo/:id",name:"HomePhoto",component:function(){return n.e("chunk-1385e022").then(n.bind(null,"6ec5"))}}]},{path:"/search/:query",name:"Search",component:function(){return n.e("chunk-078598d1").then(n.bind(null,"2d3b"))},children:[{path:"/search/:query/photo/:id",name:"SearchPhoto",component:function(){return n.e("chunk-1385e022").then(n.bind(null,"6ec5"))}}]},{path:"/login",name:"Login",component:function(){return n.e("chunk-704590ec").then(n.bind(null,"a55b"))}}],Y=new j["a"]({routes:B}),U=Y,J=n("5530"),z=n("2f62"),K=n("bfa9"),Q=new K["a"]({reducer:function(t){return{email:t.email,password:t.password,verifiedLogin:t.verifiedLogin}},storage:window.localStorage});r["a"].use(z["a"]);var X=new z["a"].Store({state:{api:q["a"],searchResults:[],email:"",password:"",viewerQueue:[]},getters:{isLoggedIn:function(t){return""!==t.email&&""!==t.password}},mutations:{viewerQueue:function(t,e){return t.viewerQueue=e},searchResults:function(t,e){return t.searchResults=e},login:function(t,e){var n=e.email,r=e.password;t.email=n,t.password=r}},actions:{apiRequest:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,n){var r,o,a,i,s,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.state,o=e.getters,a=n.url,i=n.body,s=void 0===i?{}:i,o.isLoggedIn){t.next=4;break}return t.abrupt("return",{loggedIn:!1,result:null});case 4:return t.next=6,fetch("".concat(r.api,"/").concat(a),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object(J["a"])({auth:{email:r.email,password:r.password}},s))}).then((function(t){return t.text()}));case 6:return c=t.sent,t.prev=7,t.abrupt("return",JSON.parse(c));case 11:return t.prev=11,t.t0=t["catch"](7),console.warn("Can't parse",{url:a,txt:c}),t.abrupt("return",null);case 15:case"end":return t.stop()}}),t,null,[[7,11]])})));function e(e,n){return t.apply(this,arguments)}return e}(),checkLogin:function(t,e){return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.state,o=t.commit,a=e.email,i=e.password,n.next=4,fetch("".concat(r.api,"/auth"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth:{email:a,password:i}})}).then((function(t){return t.json()}));case 4:return s=n.sent,o("login",{email:a,password:i}),n.abrupt("return",s);case 7:case"end":return n.stop()}}),n)})))()},search:function(t,e){return Object(i["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.dispatch,o=t.commit,t.state,n.next=3,r("apiRequest",{url:"photos/search?q=".concat(e)});case 3:a=n.sent,i=a.map($["a"].fromObject),o("searchResults",i);case 6:case"end":return n.stop()}}),n)})))()}},modules:{},plugins:[Q.plugin]}),Z=n("f309");r["a"].use(Z["a"]);var tt=new Z["a"]({theme:{themes:{dark:{primary:"#5996d1"},light:{primary:"#318bd5"}}}});r["a"].config.productionTip=!1,new r["a"]({router:U,store:X,vuetify:tt,render:function(t){return t(O)}}).$mount("#app")},cfbd:function(t,e,n){},e16a:function(t,e,n){"use strict";n("cfbd")},eb5c:function(t,e,n){}});
//# sourceMappingURL=app.d6085485.js.map