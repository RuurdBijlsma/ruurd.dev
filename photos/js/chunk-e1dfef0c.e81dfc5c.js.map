{"version":3,"sources":["webpack:///./src/views/Trash.vue?9f25","webpack:///./src/views/Trash.vue?bd96","webpack:///./src/views/Trash.vue","webpack:///./src/views/Trash.vue?3cf6","webpack:///./src/views/Trash.vue?9420"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","style","maxHeight","$vuetify","application","top","bottom","trashItems","length","_v","_l","item","key","filePath","attrs","api","_s","formatDate","createdAt","loading","on","$event","downloadItem","errorItems","errorLines","line","retrying","retry","_e","staticRenderFns","extend","name","components","data","mounted","$store","dispatch","url","blocked","filter","b","reason","console","log","methods","set","body","result","success","text","toText","to","id","fetch","then","resp","blob","type","size","Error","window","URL","createObjectURL","a","document","createElement","display","href","pathParts","split","download","appendChild","click","revokeObjectURL","error","message","dateString","format","Date","component","VBtn","VCard","VCardActions","VCardSubtitle","VCardTitle","VDivider","VIcon","VImg","VSpacer"],"mappings":"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","file":"js/chunk-e1dfef0c.e81dfc5c.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Trash.vue?vue&type=style&index=0&id=65533488&scoped=true&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"trash\",style:({\n        maxHeight: (\"calc(100vh - \" + (_vm.$vuetify.application.top + _vm.$vuetify.application.bottom) + \"px)\"),\n     })},[_c('div',{staticClass:\"container\"},[(_vm.trashItems.length > 0)?_c('div',{staticClass:\"trash-items\"},[_c('h2',{staticClass:\"mb-4\"},[_vm._v(\"Trash\")]),_c('div',{staticClass:\"items\"},_vm._l((_vm.trashItems),function(item){return _c('v-card',{key:item.filePath,staticClass:\"mb-8\",attrs:{\"max-width\":350}},[_c('v-img',{attrs:{\"max-height\":200,\"src\":(_vm.api + \"/photos/blocked/\" + (item.id))}}),_c('v-card-title',[_vm._v(_vm._s(item.filePath))]),_c('v-card-subtitle',[_vm._v(\" Deleted at \"+_vm._s(_vm.formatDate(item.createdAt))+\" \")]),_c('v-card-actions',[_c('v-spacer'),_c('v-btn',{attrs:{\"loading\":item.loading,\"icon\":\"\",\"color\":\"primary\"},on:{\"click\":function($event){return _vm.downloadItem(item)}}},[_c('v-icon',[_vm._v(\"mdi-download\")])],1)],1)],1)}),1)]):_c('h2',[_vm._v(\"No items in trash\")]),(_vm.errorItems.length > 0)?_c('div',{staticClass:\"failed-items mt-10\"},[_c('h2',{staticClass:\"mb-4\"},[_vm._v(\"Failed to process\")]),_c('div',{staticClass:\"items\"},_vm._l((_vm.errorItems),function(item){return _c('v-card',{key:item.filePath,staticClass:\"mb-8\",attrs:{\"max-width\":350}},[_c('v-img',{attrs:{\"max-height\":200,\"src\":(_vm.api + \"/photos/blocked/\" + (item.id))}}),_c('v-card-title',[_vm._v(_vm._s(item.filePath))]),_c('v-card-subtitle',[_vm._v(\" Failed at \"+_vm._s(_vm.formatDate(item.createdAt))+\" \"),_c('v-divider',{staticClass:\"mt-2 mb-2\"}),_vm._l((_vm.errorLines(item)),function(line){return _c('p',{staticClass:\"error-line\"},[_vm._v(_vm._s(line))])})],2),_c('v-card-actions',[_c('v-spacer'),_c('v-btn',{attrs:{\"loading\":item.loading,\"icon\":\"\",\"color\":\"primary\"},on:{\"click\":function($event){return _vm.downloadItem(item)}}},[_c('v-icon',[_vm._v(\"mdi-download\")])],1),_c('v-btn',{attrs:{\"loading\":item.retrying,\"text\":\"\",\"color\":\"primary\"},on:{\"click\":function($event){return _vm.retry(item)}}},[_vm._v(\"Retry\")])],1)],1)}),1)]):_vm._e()])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport {format} from \"date-fns\";\nimport Vue from \"vue\";\nimport {api} from \"@/ts/constants\";\n\nexport default Vue.extend({\n    name: \"Trash\",\n    components: {},\n    data: () => ({\n        trashItems: [] as any[],\n        errorItems: [] as any[],\n\n        api,\n    }),\n    async mounted() {\n        let blocked = await this.$store.dispatch('apiRequest', {url: 'photos/blockedItems'});\n        this.trashItems = blocked.filter((b: { reason: string; }) => b.reason === 'deleted');\n        this.errorItems = blocked.filter((b: { reason: string; }) => b.reason === 'error');\n        console.log(this.trashItems, this.errorItems);\n    },\n    methods: {\n        async retry(item: any) {\n            Vue.set(item, 'retrying', true);\n            let result = await this.$store.dispatch('apiRequest', {\n                url: 'photos/retryProcess',\n                body: {filePath: item.filePath}\n            });\n            if (result.success === false) {\n                this.$store.dispatch('addSnack', {text: 'Failed to process item again'});\n            } else {\n                this.$store.dispatch('addSnack', {\n                    text: `Processed item successfully`,\n                    toText: 'Visit',\n                    to: `/photo/${result.id}`\n                });\n            }\n            Vue.set(item, 'retrying', false);\n        },\n        async downloadItem(item: any) {\n            Vue.set(item, 'downloading', true);\n            try {\n                let blob = await fetch(`${api}/photos/blocked/${item.id}`).then(resp => resp.blob());\n                if (blob.type === 'text/html' && blob.size < 1000) {\n                    this.$store.dispatch('addSnack', {text: \"Item not found on server!\"});\n                    throw new Error(\"Not found\");\n                }\n                console.log(blob);\n                const url = window.URL.createObjectURL(blob);\n                const a = document.createElement('a');\n                a.style.display = 'none';\n                a.href = url;\n                let pathParts = item.filePath.split('/');\n                a.download = pathParts[pathParts.length - 1];\n                document.body.appendChild(a);\n                a.click();\n                window.URL.revokeObjectURL(url);\n            } catch (e) {\n            } finally {\n                Vue.set(item, 'downloading', false);\n            }\n        },\n        errorLines(item: any) {\n            return item?.error?.message?.split?.('\\n') ?? [];\n        },\n        formatDate(dateString: string) {\n            return format(new Date(dateString), 'H:mm:ss, eeee dd MMMM yyyy')\n        },\n    },\n});\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--13-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Trash.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--13-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Trash.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Trash.vue?vue&type=template&id=65533488&scoped=true&\"\nimport script from \"./Trash.vue?vue&type=script&lang=ts&\"\nexport * from \"./Trash.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./Trash.vue?vue&type=style&index=0&id=65533488&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"65533488\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VCardActions } from 'vuetify/lib/components/VCard';\nimport { VCardSubtitle } from 'vuetify/lib/components/VCard';\nimport { VCardTitle } from 'vuetify/lib/components/VCard';\nimport { VDivider } from 'vuetify/lib/components/VDivider';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VImg } from 'vuetify/lib/components/VImg';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VCard,VCardActions,VCardSubtitle,VCardTitle,VDivider,VIcon,VImg,VSpacer})\n"],"sourceRoot":""}