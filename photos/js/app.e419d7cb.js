(function(e){function t(t){for(var o,r,s=t[0],c=t[1],u=t[2],l=0,h=[];l<s.length;l++)r=s[l],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&h.push(i[r][0]),i[r]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);d&&d(t);while(h.length)h.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],o=!0,r=1;r<n.length;r++){var s=n[r];0!==i[s]&&(o=!1)}o&&(a.splice(t--,1),e=c(c.s=n[0]))}return e}var o={},r={app:0},i={app:0},a=[];function s(e){return c.p+"js/"+({}[e]||e)+"."+{"chunk-46845a4e":"85dbcc41","chunk-4aa48bc8":"f46a07de","chunk-4ba78246":"cbdcfc50","chunk-6b60678c":"48d9139e","chunk-742b9690":"2779a361","chunk-1d9a72b3":"81e3800d","chunk-46b666e5":"377f2c95","chunk-71a0882b":"efa71e63","chunk-d936b74e":"0107de27","chunk-a1fd35c4":"6c76181a","chunk-f6deb52a":"fe5c555f"}[e]+".js"}function c(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.e=function(e){var t=[],n={"chunk-46845a4e":1,"chunk-4aa48bc8":1,"chunk-4ba78246":1,"chunk-6b60678c":1,"chunk-1d9a72b3":1,"chunk-46b666e5":1,"chunk-71a0882b":1,"chunk-d936b74e":1,"chunk-a1fd35c4":1,"chunk-f6deb52a":1};r[e]?t.push(r[e]):0!==r[e]&&n[e]&&t.push(r[e]=new Promise((function(t,n){for(var o="css/"+({}[e]||e)+"."+{"chunk-46845a4e":"c880cbdd","chunk-4aa48bc8":"1615f453","chunk-4ba78246":"9cd14fdd","chunk-6b60678c":"fb2e4d30","chunk-742b9690":"31d6cfe0","chunk-1d9a72b3":"d37a3c29","chunk-46b666e5":"cfd15aea","chunk-71a0882b":"7eff596e","chunk-d936b74e":"b7e2c61b","chunk-a1fd35c4":"eabe9df0","chunk-f6deb52a":"d9dd8c3c"}[e]+".css",i=c.p+o,a=document.getElementsByTagName("link"),s=0;s<a.length;s++){var u=a[s],l=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(l===o||l===i))return t()}var h=document.getElementsByTagName("style");for(s=0;s<h.length;s++){u=h[s],l=u.getAttribute("data-href");if(l===o||l===i)return t()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=t,d.onerror=function(t){var o=t&&t.target&&t.target.src||i,a=new Error("Loading CSS chunk "+e+" failed.\n("+o+")");a.code="CSS_CHUNK_LOAD_FAILED",a.request=o,delete r[e],d.parentNode.removeChild(d),n(a)},d.href=i;var m=document.getElementsByTagName("head")[0];m.appendChild(d)})).then((function(){r[e]=0})));var o=i[e];if(0!==o)if(o)t.push(o[2]);else{var a=new Promise((function(t,n){o=i[e]=[t,n]}));t.push(o[2]=a);var u,l=document.createElement("script");l.charset="utf-8",l.timeout=120,c.nc&&l.setAttribute("nonce",c.nc),l.src=s(e);var h=new Error;u=function(t){l.onerror=l.onload=null,clearTimeout(d);var n=i[e];if(0!==n){if(n){var o=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;h.message="Loading chunk "+e+" failed.\n("+o+": "+r+")",h.name="ChunkLoadError",h.type=o,h.request=r,n[1](h)}i[e]=void 0}};var d=setTimeout((function(){u({type:"timeout",target:l})}),12e4);l.onerror=l.onload=u,document.head.appendChild(l)}return Promise.all(t)},c.m=e,c.c=o,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)c.d(n,o,function(t){return e[t]}.bind(null,o));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/photos/",c.oe=function(e){throw console.error(e),e};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=t,u=u.slice();for(var h=0;h<u.length;h++)t(u[h]);var d=l;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"034f":function(e,t,n){"use strict";n("85ec")},"0a18":function(e,t,n){"use strict";n("9453")},1889:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"e",(function(){return s})),n.d(t,"d",(function(){return c})),n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return l})),n.d(t,"f",(function(){return h}));var o=n("3835"),r=n("1da1");n("96cf"),n("ac1f"),n("466d"),n("99af"),n("6b93"),n("b680"),n("d3b7"),n("25f0"),n("4d90"),n("3ca3"),n("ddb0"),n("2b3d");function i(e,t){return a.apply(this,arguments)}function a(){return a=Object(r["a"])(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,fetch(t).then((function(e){return e.blob()})).then((function(e){var o=window.URL.createObjectURL(e),r=document.createElement("a");r.style.display="none",r.href=o,r.download=n,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(t)})).catch((function(e){return console.warn("file download error",e)}));case 2:case"end":return e.stop()}}),e)}))),a.apply(this,arguments)}function s(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}function c(){var e=document.createElement("div");e.style.visibility="hidden",e.style.overflow="scroll",e.style.msOverflowStyle="scrollbar",document.body.appendChild(e);var t=document.createElement("div");e.appendChild(t);var n=e.offsetWidth-t.offsetWidth;return e.parentNode.removeChild(e),n}function u(e){var t=e.match(/(^|[^0-9])(\d\d\d\d)-(\d\d)-(\d\d)[^0-9]/);if(t){var n=t,r=Object(o["a"])(n,5),i=r[2],a=r[3],s=r[4];return new Date("".concat(i,"-").concat(a,"-").concat(s," 15:00:00"))}if(t=e.match(/(^|[^0-9])([21]\d\d\d)(\d\d)(\d\d)[^0-9](\d\d)(\d\d)(\d\d)/),t){var c=t,u=Object(o["a"])(c,8),l=u[2],h=u[3],d=u[4],m=u[5],p=u[6],f=u[7];return new Date("".concat(l,"-").concat(h,"-").concat(d," ").concat(m,":").concat(p,":").concat(f))}if(t=e.match(/(^|[^0-9])([21]\d\d\d)(\d\d)(\d\d)[^0-9]/),t){var v=t,g=Object(o["a"])(v,5),b=g[2],y=g[3],w=g[4];return new Date("".concat(b,"-").concat(y,"-").concat(w," 15:00:00"))}return null}function l(e){var t=Math.log10(e);return t<3?e+" B":t<6?(e/1024).toFixed(1)+" kB":t<9?(e/Math.pow(1024,2)).toFixed(2)+" MB":t<12?(e/Math.pow(1024,3)).toFixed(2)+" GB":t<15?(e/Math.pow(1024,4)).toFixed(2)+" TB":"very bige bytes"}function h(e){if(isNaN(e)||void 0===e)return"0:00";e=Math.round(e);var t=Math.floor(e/3600),n=Math.floor(e%3600/60),o=e%60,r=t.toString(),i=n.toString(),a=o.toString();return"0"!==r&&(i=i.padStart(2,"0"),a=a.padStart(2,"0")),a=a.padStart(2,"0"),"0"===r?"".concat(i,":").concat(a):"".concat(r,":").concat(i,":").concat(a)}},"1a43":function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return a})),n.d(t,"c",(function(){return s}));var o=n("1889"),r=null===localStorage.getItem("api")?"https://api.ruurd.dev":localStorage.api,i=["January","February","March","April","May","June","July","August","September","October","November","December"],a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s=Object(o["d"])()},"1bbf":function(e,t,n){"use strict";n("9579")},2252:function(e,t,n){e.exports=n.p+"img/transparent-color-icon-256.7963b11c.png"},4786:function(e,t,n){"use strict";n("d522")},"4e45":function(e,t,n){},5024:function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"photo-grid roboto"},e._l(e.photoRows,(function(t){return n("v-lazy",{key:t.id,staticClass:"photo-row",class:t.layoutBlocks.flatMap((function(e){return e.layoutMedias.map((function(e){return"p"+e.media.id}))})),style:{marginTop:t.hasDate?0:e.grid.mediaMargin+"px"},attrs:{height:t.height,transition:"none"}},[n("div",e._l(t.layoutBlocks,(function(t){return n("div",{staticClass:"photo-block",style:{marginRight:e.grid.blockMarginRight+"px"}},[t.showDate?n("div",{staticClass:"block-date",style:{maxWidth:Math.floor(t.width)+"px"},attrs:{title:t.dateString}},[n("router-link",{staticClass:"no-style",attrs:{to:"/?date="+e.formatDate(t.date,"yyyy-MM-dd")}},[e._v(" "+e._s(t.dateString)+" ")])],1):e._e(),e._l(t.layoutMedias,(function(t){return n("grid-photo",{key:t.media.id,staticClass:"grid-photo",style:{marginRight:e.grid.mediaMargin+"px"},attrs:{"layout-media":t},on:{selectItem:e.selectItem}})}))],2)})),0)])})),1)},r=[],i=n("2909"),a=n("b85c"),s=n("3835"),c=n("1da1"),u=(n("96cf"),n("a9e3"),n("4e827"),n("d81d"),n("4de4"),n("c740"),n("fb6a"),n("d3b7"),n("25f0"),n("5db7"),n("73d9"),n("8a79"),n("1a43")),l=n("2b0e"),h=n("b166"),d=n("1556"),m=n("a2e1"),p=new Date,f=l["default"].extend({name:"PhotoGrid",components:{GridPhoto:m["a"]},props:{usableWidth:{type:Number,required:!0},photos:{type:Array,required:!0}},data:function(){return{api:u["a"],photoRows:[],calculateTimeout:-1,shiftDown:!1}},beforeDestroy:function(){document.removeEventListener("keydown",this.keyDown),document.removeEventListener("keyup",this.keyUp)},mounted:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:document.addEventListener("keydown",e.keyDown,!1),document.addEventListener("keyup",e.keyUp,!1),e.calculateLayout(),e.$emit("ready",e.height);case 4:case"end":return t.stop()}}),t)})))()},methods:{selectItem:function(e,t){var n,o,r,i=null;(t&&null!==this.lastSelectedPhoto&&(i=this.getBatch(e,this.lastSelectedPhoto)),null!==i)?this.$store.getters.isSelected(e.id)?(this.$store.commit("removeBatchFromPhotoSelection",i),this.lastSelectedPhoto=null!==(n=this.$store.getters.selectedMedias[this.$store.getters.selectedMedias.length-1])&&void 0!==n?n:null):this.$store.commit("addBatchToPhotoSelection",i):this.$store.getters.isSelected(e.id)?(this.$store.commit("removeFromPhotoSelection",e),(null===(o=this.lastSelectedPhoto)||void 0===o?void 0:o.id)===e.id&&(this.lastSelectedPhoto=null!==(r=this.$store.getters.selectedMedias[this.$store.getters.selectedMedias.length-1])&&void 0!==r?r:null)):(this.lastSelectedPhoto=e,this.$store.commit("addToPhotoSelection",e))},getBatch:function(e,t){var n,o=[e,t].sort((function(e,t){return e.createDate.getTime()-t.createDate.getTime()})),r=Object(s["a"])(o,2),c=r[0],u=r[1],l=12*c.createDate.getFullYear()+c.createDate.getMonth(),h=12*u.createDate.getFullYear()+u.createDate.getMonth(),d=this.$store.state.photosPerMonth,m=d.filter((function(e){var t=12*e.year+(e.month-1);return t>=l&&t<=h})).map((function(e){return e.id})),p=this.$store.state.cachedPhotos,f=[],v=Object(a["a"])(m);try{for(v.s();!(n=v.n()).done;){var g=n.value;if(!p.hasOwnProperty(g))return null;f.push.apply(f,Object(i["a"])(p[g]))}}catch(k){v.e(k)}finally{v.f()}var b=f.findIndex((function(e){return e.id===c.id})),y=f.findIndex((function(e){return e.id===u.id})),w=[b,y].sort((function(e,t){return t-e})),x=Object(s["a"])(w,2);return b=x[0],y=x[1],-1===b||-1===y?null:f.slice(y,b+1)},keyDown:function(e){"Shift"===e.key&&(this.shiftDown=!0)},keyUp:function(e){"Shift"===e.key&&(this.shiftDown=!1)},formatDate:function(e,t){return"number"===typeof e&&(e=new Date(e)),Object(h["a"])(e,t)},dateToString:function(e){if(p.getTime()-e.getTime()<432e6)return Object(d["a"])(e,p,{addSuffix:!0});var t="E, d MMM";return e.getFullYear()!==p.getFullYear()&&(t+=" y"),Object(h["a"])(e,t)},calculateLayout:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=this.photos.map((function(e){return{visualWidth:0,visualHeight:0,media:e}})),r=[],i=null,s=Object(a["a"])(o);try{for(s.s();!(e=s.n()).done;){var c=e.value,u=c.media,l=this.grid.blockHeight*u.width/u.height;c.visualHeight=this.grid.blockHeight,c.visualWidth=l;var h=u.createDate,d=this.dateToString(h);if(null!==i&&i.dateString===d)i.layoutMedia.push(c),i.guessedWidth+=l+=this.grid.mediaMargin;else{var m={layoutMedia:[c],date:h,dateString:d,guessedWidth:l};r.push(m),i=m}}}catch(N){s.e(N)}finally{s.f()}for(var p=[],f=null,v=null,g=this.usableWidth,b=0,y=r;b<y.length;b++){var w,x=y[b],k=Object(a["a"])(x.layoutMedia);try{for(k.s();!(w=k.n()).done;){var S=w.value,M="";null!==v&&(M=v.dateString);var P=M===x.dateString,T=g+this.grid.speling<S.visualWidth||!P&&x.layoutMedia.length>3;if(null===v||null===f||T){var $=null===v;v={layoutMedias:[S],date:x.date,dateString:x.dateString,showDate:!P||$,width:S.visualWidth,height:this.grid.blockHeight},f={height:v.height,width:v.width,layoutBlocks:[v],hasDate:v.showDate,id:Math.random().toString()},g=this.usableWidth-S.visualWidth,p.push(f)}else P?(v.width+=S.visualWidth,f.width+=S.visualWidth,v.layoutMedias.push(S),g-=S.visualWidth):(v={layoutMedias:[S],date:x.date,dateString:x.dateString,showDate:!0,width:S.visualWidth,height:this.grid.blockHeight},g-=S.visualWidth,f.layoutBlocks.push(v),f.width+=v.width,f.hasDate=!0)}}catch(N){k.e(N)}finally{k.f()}}for(var D=0,C=p;D<C.length;D++){var R=C[D],_=this.grid.mediaMargin*R.layoutBlocks.flatMap((function(e){return e.layoutMedias.length-1})).reduce((function(e,t){return e+t}),0),O=this.grid.blockMarginRight*(R.layoutBlocks.length-1),I=(this.usableWidth-_-O)/R.width;I>this.grid.maxScale&&(I=1),R.height*=I;var j,E=0,V=Object(a["a"])(R.layoutBlocks);try{for(V.s();!(j=V.n()).done;){var L,q=j.value,H=0,F=Object(a["a"])(q.layoutMedias);try{for(F.s();!(L=F.n()).done;){var A=L.value;A.visualWidth*=I,A.visualHeight=R.height,H+=A.visualWidth}}catch(N){F.e(N)}finally{F.f()}q.height=R.height+(R.hasDate?this.grid.blockDateHeight:0),q.width=H+(q.layoutMedias.length-1)*this.grid.mediaMargin,E+=q.width}}catch(N){V.e(N)}finally{V.f()}R.hasDate&&(R.height+=this.grid.blockDateHeight),R.width=E+(R.layoutBlocks.length-1)*this.grid.blockMarginRight}this.photoRows=p,n&&this.$nextTick((function(){return t.$emit("resizeReady",t.height)}))},scrollMediaIntoView:function(e){if(null!==e){var t=document.querySelector(".p".concat(e.id));null!==t&&t.scrollIntoView({block:"center"})}},scrollDateIntoView:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=1/0,r=null,i=n?e.getDate():e.getTime(),s=Object(a["a"])(this.photoRows);try{e:for(s.s();!(t=s.n()).done;){var c,u=t.value,l=Object(a["a"])(u.layoutBlocks);try{for(l.s();!(c=l.n()).done;){var h,d=c.value,m=n?d.date.getDate():d.date.getTime(),p=Math.abs(i-m);if(!(p<=o))break e;if(o=p,r=null===(h=d.layoutMedias[0])||void 0===h?void 0:h.media,0===p)break e}}catch(f){l.e(f)}finally{l.f()}}}catch(f){s.e(f)}finally{s.f()}null!==r&&this.scrollMediaIntoView(r)}},computed:{lastSelectedPhoto:{get:function(){return this.$store.state.lastSelectedPhoto},set:function(e){this.$store.commit("lastSelectedPhoto",e)}},isSelecting:function(){return this.$store.getters.isSelecting},grid:function(){return this.$vuetify.breakpoint.mobile?{blockMarginRight:10,blockDateHeight:40,mediaMargin:3,blockHeight:180,speling:80,maxScale:2}:{blockMarginRight:25,blockDateHeight:40,mediaMargin:5,blockHeight:180,speling:50,maxScale:1.5}},height:function(){return this.photoRows.map((function(e){return e.height})).reduce((function(e,t){return e+t}),0)+this.photoRows.length*this.grid.mediaMargin},currentPath:function(){var e=this.$route.path;return e.endsWith("/")?e.substr(0,e.length-1):e},photoSelection:function(){return this.$store.state.photoSelection}},watch:{usableWidth:function(){var e=this;clearTimeout(this.calculateTimeout),this.calculateTimeout=setTimeout((function(){requestAnimationFrame((function(){return e.calculateLayout(!0)}))}),50)},photos:function(){var e=this;requestAnimationFrame((function(){return e.calculateLayout(!0)}))},grid:function(){var e=this;requestAnimationFrame((function(){return e.calculateLayout(!0)}))}}}),v=f,g=(n("e216"),n("2877")),b=n("6544"),y=n.n(b),w=n("b687"),x=Object(g["a"])(v,o,r,!1,null,"55926bcb",null);t["a"]=x.exports;y()(x,{VLazy:w["a"]})},5776:function(e,t,n){"use strict";n("bde1")},"5d0a":function(e,t,n){"use strict";n("9788")},"81fc":function(e,t,n){},"85ec":function(e,t,n){},9453:function(e,t,n){},9579:function(e,t,n){},9788:function(e,t,n){},a2e1:function(e,t,n){"use strict";var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("router-link",{staticClass:"photo",style:{height:e.layoutMedia.visualHeight+"px",width:e.layoutMedia.visualWidth+"px",backgroundColor:e.selectionColor},attrs:{to:e.currentPath+"/photo/"+e.media.id}},["photo"===e.media.type?n("div",{staticClass:"image-container"},[n("div",{staticClass:"image-background",style:{backgroundImage:"url("+e.getThumbUrl(e.media.id,e.layoutMedia.visualHeight)+")",clipPath:e.selected?"polygon(15px 15px, calc(100% - 15px) 15px, calc(100% - 15px) calc(100% - 15px), 15px calc(100% - 15px))":"polygon(0 0, 100% 0, 100% 100%, 0 100%)"}}),n("div",{staticClass:"image-overlay"},[n("div",{staticClass:"image-info"},[e.isSelecting?n("v-btn",{staticClass:"zoom-button",attrs:{if:"isSelecting",color:"white",small:"",icon:"",to:e.currentPath+"/photo/"+e.media.id}},[n("v-icon",{staticClass:"icon"},[e._v(" mdi-magnify-plus-outline ")])],1):e._e(),"vr"===e.media.subType?n("v-icon",{staticClass:"icon",attrs:{color:"white"}},[e._v(" mdi-rotate-3d-variant ")]):"portrait"===e.media.subType?n("v-icon",{staticClass:"icon",attrs:{color:"white"}},[e._v(" mdi-blur ")]):e._e()],1),n("div",{staticClass:"item-select",style:{top:e.selected?"-3px":"0",left:e.selected?"-3px":"0",width:e.delayedIsSelecting?"100%":null,height:e.delayedIsSelecting?"100%":null,opacity:e.isSelecting?"1 !important":null},on:{mousedown:function(t){return e.selectItem(t)},click:function(t){return t.preventDefault(),e.updateIsSelecting.apply(null,arguments)}}},[e.isSelecting?e.selected?n("v-icon",{staticClass:"icon selected-icon",attrs:{"x-large":"",color:"primary"}},[e._v(" mdi-check-circle ")]):n("v-icon",{staticClass:"icon",attrs:{large:"",color:"white"}},[e._v(" mdi-circle-outline ")]):n("v-icon",{staticClass:"icon",attrs:{large:"",color:"white"}},[e._v(" mdi-check-circle ")])],1)])]):n("div",{staticClass:"video-container",on:{touchstart:e.playVideo,touchend:e.pauseVideo,mouseleave:function(t){return e.pauseVideo()},mouseenter:function(t){return e.playVideo()}}},[n("video",{ref:"video",style:{clipPath:e.selected?"polygon(15px 15px, calc(100% - 15px) 15px, calc(100% - 15px) calc(100% - 15px), 15px calc(100% - 15px))":"polygon(0 0, 100% 0, 100% 100%, 0 100%)"},attrs:{poster:""+e.getThumbUrl(e.media.id,e.layoutMedia.visualHeight),muted:"",loop:"",src:e.api+"/photo/webm/"+e.media.id+".webm"},domProps:{muted:!0}}),n("div",{staticClass:"video-overlay"},[n("div",{staticClass:"video-info"},[n("span",{staticClass:"video-duration"},[e._v(e._s(e.toHms(e.media.duration/1e3)))]),"none"===e.media.subType?n("v-icon",{staticClass:"icon",attrs:{color:"white"}},[e._v(" mdi-play-circle-outline ")]):"slomo"===e.media.subType?n("v-icon",{staticClass:"icon",attrs:{color:"white"}},[e._v(" mdi-play-speed ")]):e._e()],1),n("div",{staticClass:"item-select",style:{top:e.selected?"-3px":"0",left:e.selected?"-3px":"0",width:e.delayedIsSelecting?"100%":null,height:e.delayedIsSelecting?"100%":null,opacity:e.isSelecting?"1 !important":null},on:{mousedown:function(t){return e.selectItem(t)},click:function(t){return t.preventDefault(),e.updateIsSelecting.apply(null,arguments)}}},[e.isSelecting?e.selected?n("v-icon",{staticClass:"icon selected-icon",attrs:{"x-large":"",color:"primary"}},[e._v(" mdi-check-circle ")]):n("v-icon",{staticClass:"icon",attrs:{large:"",color:"white"}},[e._v(" mdi-circle-outline ")]):n("v-icon",{staticClass:"icon",attrs:{large:"",color:"white"}},[e._v(" mdi-check-circle ")])],1)])])])},r=[],i=(n("99af"),n("8a79"),n("2b0e")),a=n("1a43"),s=n("1889"),c=n("b166"),u=i["default"].extend({name:"GridPhoto",props:{layoutMedia:{type:Object,required:!0}},data:function(){return{api:a["a"]}},methods:{updateIsSelecting:function(){this.delayedIsSelecting=this.$store.getters.isSelecting},selectItem:function(e){this.$emit("selectItem",this.media,e.shiftKey)},playVideo:function(){var e,t=this.$refs.video;null===t||void 0===t||null===(e=t.play)||void 0===e||e.call(t)},pauseVideo:function(){var e,t=this.$refs.video;null===t||void 0===t||null===(e=t.pause)||void 0===e||e.call(t)},formatDate:function(e,t){return"number"===typeof e&&(e=new Date(e)),Object(c["a"])(e,t)},getThumbUrl:function(e,t){var n="tiny";return t>260&&(n="small"),t>500&&(n="big"),"".concat(a["a"],"/photo/").concat(n,"/").concat(e,".webp")},toHms:function(e){return Object(s["f"])(e)}},computed:{selectionColor:function(){return this.themeColors.selectionColor},delayedIsSelecting:{get:function(){return this.$store.state.delayedIsSelecting},set:function(e){this.$store.commit("delayedIsSelecting",e)}},isSelecting:function(){return this.$store.getters.isSelecting},selected:function(){return this.$store.getters.isSelected(this.media.id)},themeColors:function(){var e=this.$vuetify.theme.dark;return this.$vuetify.theme.themes[e?"dark":"light"]},media:function(){return this.layoutMedia.media},currentPath:function(){var e=this.$route.path;return e.endsWith("/")?e.substr(0,e.length-1):e}},watch:{}}),l=u,h=(n("a36b"),n("2877")),d=n("6544"),m=n.n(d),p=n("8336"),f=n("132d"),v=Object(h["a"])(l,o,r,!1,null,"fb2c3696",null);t["a"]=v.exports;m()(v,{VBtn:p["a"],VIcon:f["a"]})},a36b:function(e,t,n){"use strict";n("4e45")},a738:function(e,t,n){"use strict";n("aaf8")},aaf8:function(e,t,n){},b0d1:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n("b85c"),r=n("d4ec"),i=n("bee2"),a=(n("d81d"),n("07ac"),n("caad"),function(){function e(t,n,o,i,a,s,c){var u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,m=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};Object(r["a"])(this,e),this.id=t,this.filename=n,this.createDate=o,this.width=i,this.height=a,this.type=s,this.duration=u,this.subType=c,this.classifications=l,this.location=h,this.size=d,this.exif=m}return Object(i["a"])(e,[{key:"ratio",get:function(){return 0===this.height?1:this.width/this.height}}],[{key:"fromObject",value:function(t){var n,r,i=t.id,a=void 0===i?"":i,s=t.filename,c=void 0===s?"":s,u=t.createDateString,l=void 0===u?"":u,h=t.width,d=void 0===h?0:h,m=t.height,p=void 0===m?0:m,f=t.type,v=void 0===f?"":f,g=t.subType,b=void 0===g?"":g,y=t.durationMs,w=void 0===y?null:y,x=t.MediaClassifications,k=void 0===x?null:x,S=t.MediaLocation,M=void 0===S?null:S,P=t.bytes,T=void 0===P?"-1":P,$=t.exif,D=void 0===$?{}:$;b=b.toLowerCase(),v=v.toLowerCase();var C=M?{latitude:M.latitude,longitude:M.longitude,altitude:M.altitude,places:null===(n=M.MediaPlaces)||void 0===n||null===(r=n.map)||void 0===r?void 0:r.call(n,(function(e){return{type:e.type,name:e.text}}))}:null,R=k?k.map((function(e){var t,n={},r=Object(o["a"])(e.MediaGlossaries);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=i.level,s=i.text;n[a]={glossary:s,level:a}}}catch(m){r.e(m)}finally{r.f()}var c,u=Object(o["a"])(e.MediaLabels);try{for(u.s();!(c=u.n()).done;){var l=c.value,h=l.level,d=l.text;n[h].labels||(n[h].labels=[]),n[h].labels.push(d)}}catch(m){u.e(m)}finally{u.f()}return{confidence:e.confidence,levels:Object.values(n)}})):null;return new e(a,c,new Date(l),d,p,"image"===v?"photo":"video",["portrait","vr","slomo"].includes(b)?b:"none",w,R,C,isFinite(+T)?+T:null,D)}}]),e}())},bde1:function(e,t,n){},cd49:function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",{staticClass:"app"},[n("app-bar"),e.$vuetify.breakpoint.mobile?e._e():n("v-navigation-drawer",{attrs:{"expand-on-hover":e.$vuetify.breakpoint.width<1600,width:180,permanent:"",app:"",clipped:"","hide-overlay":""}},[n("v-list",{attrs:{dense:"",nav:"",rounded:""}},e._l(e.pages,(function(t){return n("v-list-item",{key:t.to,attrs:{exact:"",to:t.to},on:{mousedown:e.scrollToTop}},[n("v-list-item-icon",[n("v-icon",[e._v(e._s(t.icon))])],1),n("v-list-item-content",[n("v-list-item-title",[e._v(e._s(t.name))])],1)],1)})),1)],1),n("v-main",[n("router-view")],1),e._l(e.$store.state.snackbars,(function(t){return n("v-snackbar",{key:t.id,attrs:{app:"",timeout:t.timeout,color:"secondary"},scopedSlots:e._u([{key:"action",fn:function(o){var r=o.attrs;return[null!==t.to?n("v-btn",e._b({attrs:{text:"",to:t.to}},"v-btn",r,!1),[e._v(" "+e._s(t.toText)+" ")]):e._e(),n("v-btn",e._b({attrs:{text:""},on:{click:function(e){t.open=!1}}},"v-btn",r,!1),[e._v(" Dismiss ")])]}}],null,!0),model:{value:t.open,callback:function(n){e.$set(t,"open",n)},expression:"snack.open"}},[e._v(" "+e._s(t.text)+" ")])})),n("custom-dialog"),e.$vuetify.breakpoint.mobile?n("v-bottom-navigation",{attrs:{app:"",shift:""}},e._l(e.pages,(function(t){return n("v-btn",{key:t.to,style:{height:"inherit !important"},attrs:{to:t.to},on:{click:e.scrollToTop}},[n("span",[e._v(e._s(t.name))]),n("v-icon",[e._v(e._s(t.icon))])],1)})),1):e._e(),n("selection-info")],2)},i=[],a=n("1da1"),s=(n("96cf"),n("b0c0"),n("c740"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-dialog",{attrs:{width:"500"},model:{value:e.prompt.show,callback:function(t){e.$set(e.prompt,"show",t)},expression:"prompt.show"}},[n("v-card",[n("v-card-title",{domProps:{innerHTML:e._s(e.prompt.title)}}),n("v-card-text",{domProps:{innerHTML:e._s(e.prompt.subtitle)}}),n("v-divider"),n("v-card-actions",[n("v-spacer"),n("v-btn",{attrs:{text:""},on:{click:e.dialogCancel}},[e._v(" "+e._s(e.prompt.cancelText)+" ")]),n("v-btn",{attrs:{color:"primary",text:""},on:{click:e.dialogConfirm}},[e._v(" "+e._s(e.prompt.confirmText)+" ")])],1)],1)],1)}),c=[],u={name:"CustomDialog",methods:{dialogCancel:function(){this.$store.commit("hidePrompt")},dialogConfirm:function(){this.$store.commit("hidePrompt"),this.prompt.onConfirm()}},watch:{"prompt.show":function(){this.prompt.show||this.prompt.onCancel()}},computed:{prompt:function(){return this.$store.state.prompt}}},l=u,h=n("2877"),d=n("6544"),m=n.n(d),p=n("8336"),f=n("b0af"),v=n("99d9"),g=n("169a"),b=n("ce7e"),y=n("2fa4"),w=Object(h["a"])(l,s,c,!1,null,"c70abdd6",null),x=w.exports;m()(w,{VBtn:p["a"],VCard:f["a"],VCardActions:v["a"],VCardText:v["c"],VCardTitle:v["d"],VDialog:g["a"],VDivider:b["a"],VSpacer:y["a"]});var k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.isSelecting?n("v-card",{staticClass:"selection-info",style:{bottom:e.$vuetify.application.bottom+10+"px"}},[n("v-card-title",[e._v("Selected "+e._s(e.selectionCount)+" item"+e._s(1===e.selectionCount?"":"s"))]),e.firstDate!==e.lastDate?n("v-card-subtitle",[e._v("From "),n("span",{staticClass:"font-weight-bold"},[e._v(e._s(e.firstDate))]),e._v(" to "),n("span",{staticClass:"font-weight-bold"},[e._v(e._s(e.lastDate))])]):n("v-card-subtitle",{staticClass:"font-weight-bold"},[e._v(e._s(e.firstDate))]),n("v-card-actions",[n("v-btn",{attrs:{text:"",plain:"",small:""},on:{click:e.clearSelection}},[e._v("Clear selection")]),n("v-spacer"),n("v-btn",{attrs:{plain:"",small:"",icon:"",title:"Delete",loading:e.loading.delete},on:{click:e.deleteItems}},[n("v-icon",[e._v("mdi-delete-outline")])],1),n("v-btn",{attrs:{plain:"",small:"",icon:"",title:"Reprocess",loading:e.loading.reprocess},on:{click:e.reprocess}},[n("v-icon",[e._v("mdi-auto-fix")])],1),n("v-btn",{attrs:{plain:"",small:"",icon:"",title:"Fix date from filename",loading:e.loading.fixDate},on:{click:e.fixDate}},[n("v-icon",[e._v("mdi-calendar-range")])],1),n("v-btn",{attrs:{plain:"",small:"",icon:"",title:"Download",loading:e.loading.download},on:{click:e.downloadItems}},[n("v-icon",[e._v("mdi-download-outline")])],1)],1)],1):e._e()},S=[],M=n("3835"),P=n("b85c"),T=(n("d3b7"),n("3ca3"),n("ddb0"),n("d81d"),n("99af"),n("4e827"),n("07ac"),n("b64b"),n("b166")),$=n("1889"),D=n("1a43"),C=o["default"].extend({name:"SelectionInfo",data:function(){return{loading:{delete:!1,reprocess:!1,fixDate:!1,download:!1}}},methods:{downloadItems:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,o,r,i,a,s,c,u,l,h,d,m,p,f;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.loading.download=!0,!(e.selectedMedias.length<5)){t.next=12;break}return t.next=4,Promise.all(e.selectedMedias.map((function(t){return e.$store.dispatch("apiRequest",{url:"photos/".concat(t.id)})})));case 4:n=t.sent,o=[],r=Object(P["a"])(n);try{for(r.s();!(i=r.n()).done;)a=i.value,console.log(a),o.push(Object($["b"])("".concat(D["a"],"/photos/full/").concat(a.id),a.filename))}catch(v){r.e(v)}finally{r.f()}return t.next=10,Promise.all(o);case 10:t.next=36;break;case 12:return t.prev=12,t.next=15,e.$store.dispatch("apiRequest",{url:"photos/batchDownload",body:{ids:e.selectedMedias.map((function(e){return e.id}))}});case 15:return s=t.sent,c=s.zipId,console.log("zip id",c),u=e.selectedMedias[0].createDate,l=e.selectedMedias[e.selectedMedias.length-1].createDate,h=[u,l].sort((function(e,t){return e.getTime()-t.getTime()})),d=Object(M["a"])(h,2),u=d[0],l=d[1],m=Object(T["a"])(u,"yyyy-MM-dd"),p=Object(T["a"])(l,"yyyy-MM-dd"),f=m!==p?"photos_".concat(m,"_").concat(p):m,t.next=29,Object($["b"])("".concat(D["a"],"/photos/zip/").concat(c),"".concat(f,".zip"));case 29:t.next=36;break;case 31:return t.prev=31,t.t0=t["catch"](12),t.next=35,e.$store.dispatch("addSnack",{text:"Couldn't download files, ".concat(t.t0.message)});case 35:console.warn("cant download",t.t0);case 36:e.clearSelection(),e.loading.download=!1;case 38:case"end":return t.stop()}}),t,null,[[12,31]])})))()},batchAction:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var o,r,i,s,c,u,l,h,d,m,p,f,v,g,b,y,w,x,k,S,M;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=e.name,r=void 0===o?"delete":o,i=e.subTitleInfix,s=void 0===i?"delete":i,c=e.endpoint,u=void 0===c?"batchDelete":c,l=e.someFailText,h=void 0===l?"Some items failed to delete":l,d=e.failText,m=void 0===d?"Deleting items failed":d,p=e.successText,f=void 0===p?"Successfully deleted items!":p,v=e.confirmText,g=void 0===v?"Delete":v,b=e.reloadItems,y=void 0!==b&&b,w=e.clearSelection,x=void 0!==w&&w,t.loading[r]=!0,k=!0,S=!1,M=null,n.next=7,Object(a["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("showPrompt",{title:"Are you sure?",subtitle:"This will ".concat(s," ").concat(t.selectedMedias.length," item").concat(1===t.selectedMedias.length?"":"s","!"),confirmText:g});case 2:if(n=e.sent,n){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,t.$store.dispatch("apiRequest",{url:"photos/".concat(u),body:{ids:t.selectedMedias.map((function(e){return e.id}))}});case 7:if(M=e.sent,Array.isArray(M.results)&&(k=M.results.every((function(e){return!1===e.success})),S=M.results.every((function(e){return!0===e.success}))),console.log("result",{allFailed:k,allSuccess:S},M),!k){e.next=14;break}return e.abrupt("return",t.$store.dispatch("addSnack",{text:m}).then());case 14:if(!S){e.next=18;break}return e.abrupt("return",t.$store.dispatch("addSnack",{text:f}).then());case 18:return e.abrupt("return",t.$store.dispatch("addSnack",{text:h}).then());case 19:case"end":return e.stop()}}),e)})))();case 7:return y&&!k&&t.$store.commit("reloadPhotos",!0),x&&!k&&t.clearSelection(),t.loading[r]=!1,n.abrupt("return",M);case 11:case"end":return n.stop()}}),n)})))()},deleteItems:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.batchAction({name:"delete",subTitleInfix:"delete",endpoint:"batchDelete",someFailText:"Some items failed to delete",failText:"Deleting items failed",successText:"Successfully deleted items!",confirmText:"Delete",reloadItems:!0,clearSelection:!0});case 2:case"end":return t.stop()}}),t)})))()},reprocess:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.batchAction({name:"reprocess",subTitleInfix:"reprocess",endpoint:"batchReprocess",someFailText:"Some items failed to reprocess",failText:"Reprocessing items failed",successText:"Successfully reprocessed items!",confirmText:"Reprocess",reloadItems:!0,clearSelection:!0});case 2:case"end":return t.stop()}}),t)})))()},fixDate:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.batchAction({name:"fixDate",subTitleInfix:"attempt to fix the date of",endpoint:"batchFixDate",someFailText:"Fixed some of the dates",failText:"Fixing dates of items failed",successText:"Successfully fixed dates of items!",confirmText:"Fix dates",reloadItems:!0,clearSelection:!0});case 2:case"end":return t.stop()}}),t)})))()},clearSelection:function(){this.$store.commit("lastSelectedPhoto",null),this.$store.commit("clearPhotoSelection"),this.$store.commit("delayedIsSelecting",!1)}},computed:{firstDate:function(){return Object(T["a"])(this.selectedMedias[0].createDate,"yyyy-MM-dd")},lastDate:function(){return Object(T["a"])(this.selectedMedias[this.selectedMedias.length-1].createDate,"yyyy-MM-dd")},selectedMedias:function(){var e=Object.values(this.$store.state.photoSelection);return e.sort((function(e,t){return e.createDate.getTime()-t.createDate.getTime()}))},isSelecting:function(){return this.$store.getters.isSelecting},selectionCount:function(){return Object.keys(this.$store.state.photoSelection).length}}}),R=C,_=(n("0a18"),n("132d")),O=Object(h["a"])(R,k,S,!1,null,"4f6fe910",null),I=O.exports;m()(O,{VBtn:p["a"],VCard:f["a"],VCardActions:v["a"],VCardSubtitle:v["b"],VCardTitle:v["d"],VIcon:_["a"],VSpacer:y["a"]});var j=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-app-bar",{attrs:{elevation:"0",app:"","clipped-left":""}},[o("router-link",{staticClass:"home-link no-style",attrs:{to:"/"}},[o("img",{staticClass:"logo-icon",attrs:{src:n("2252"),alt:"icon"}}),e.$vuetify.breakpoint.width>500?o("v-app-bar-title",{staticClass:"logo-text"},[e._v("Photos ")]):e._e()],1),o("v-spacer"),o("v-autocomplete",{ref:"search",attrs:{solo:"",dense:"","hide-details":"",label:""===e.searchTip?"Search...":'Search "'+e.searchTip+'"',"prepend-inner-icon":"mdi-magnify","append-icon":"","hide-no-data":"",loading:e.loadingSuggestions,items:e.items,clearable:"","return-object":"","search-input":e.query},on:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.enterPressed.apply(null,arguments)},"update:searchInput":function(t){e.query=t},"update:search-input":function(t){e.query=t}},model:{value:e.querySelect,callback:function(t){e.querySelect=t},expression:"querySelect"}}),o("v-spacer"),e.$vuetify.breakpoint.mobile?e._e():o("v-btn",{staticClass:"mr-3",attrs:{plain:"",small:"",loading:e.uploadLoading},on:{click:e.promptUpload}},[o("v-icon",{staticClass:"mr-2"},[e._v("mdi-upload-outline")]),e._v(" Upload ")],1),o("v-menu",{attrs:{"close-on-content-click":!1},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on,r=t.attrs;return[o("v-btn",e._g(e._b({attrs:{icon:""}},"v-btn",r,!1),n),[o("v-icon",[e._v("mdi-cog-outline")])],1)]}}]),model:{value:e.showMenu,callback:function(t){e.showMenu=t},expression:"showMenu"}},[o("v-list",{attrs:{dense:""}},[o("v-list-item",{attrs:{to:"/settings"}},[o("v-list-item-icon",[o("v-icon",[e._v("mdi-cog")])],1),o("v-list-item-content",[o("v-list-item-title",[e._v("Settings")])],1)],1),o("v-list-item",{attrs:{color:"primary"}},[o("v-list-item-icon",[o("v-icon",[e._v("mdi-brightness-6")])],1),o("v-list-item-content",[o("v-list-item-title",{staticClass:"theme-switch"},[o("span",[e._v("Dark theme")])])],1),o("v-list-item-action",[o("v-switch",{attrs:{dense:"",inset:""},model:{value:e.$vuetify.theme.dark,callback:function(t){e.$set(e.$vuetify.theme,"dark",t)},expression:"$vuetify.theme.dark"}})],1)],1),o("v-list-item",{attrs:{to:"/trash"}},[o("v-list-item-icon",[o("v-icon",[e._v("mdi-trash-can-outline")])],1),o("v-list-item-content",[o("v-list-item-title",[e._v("Trash")])],1)],1),e.$vuetify.breakpoint.mobile?o("v-list-item",{on:{click:e.promptUpload}},[o("v-list-item-icon",[e.uploadLoading?o("v-progress-circular",{attrs:{size:25,width:2,indeterminate:""}}):o("v-icon",[e._v("mdi-upload-outline")])],1),o("v-list-item-content",[o("v-list-item-title",[e._v("Upload")])],1)],1):e._e(),o("v-list-item",{on:{click:e.logout}},[o("v-list-item-icon",[o("v-icon",[e._v("mdi-face")])],1),o("v-list-item-content",[o("v-list-item-title",[e._v("Log out")])],1)],1)],1)],1)],1)},E=[],V=n("2909"),L=(n("ac1f"),n("841c"),n("caad"),n("2532"),n("4de4"),n("1276"),n("2ca0"),o["default"].extend({name:"AppBar",data:function(){return{searchTip:"",query:"",querySelect:null,loadingSuggestions:!1,items:[],showMenu:!1,uploadLoading:!1}},mounted:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$route.params.query&&(e.query=e.$route.params.query,e.items=[e.query],e.querySelect=e.query),e.$store.dispatch("apiRequest",{url:"photos/searchTip"}).then((function(t){var n;return e.searchTip=null!==(n=null===t||void 0===t?void 0:t.text)&&void 0!==n?n:""}));case 2:case"end":return t.stop()}}),t)})))()},methods:{promptUpload:function(){var e=this,t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("multiple",""),t.setAttribute("accept","image/*"),t.style.display="none",document.body.appendChild(t),t.click(),t.addEventListener("change",Object(a["a"])(regeneratorRuntime.mark((function n(){var o,r,i,a,s,c,u;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.uploadLoading=!0,t.remove(),r=null!==(o=t.files)&&void 0!==o?o:[],0!==r.length){n.next=5;break}return n.abrupt("return");case 5:for(i=new FormData,i.append("email",e.$store.state.email),i.append("password",e.$store.state.password),a=0;a<r.length;a++)s=r[a],console.log("appending file",s),i.append("media",s,s.name);return n.next=11,fetch("".concat(D["a"],"/photos/upload"),{method:"POST",body:i}).then((function(e){return e.text()}));case 11:if(c=n.sent,n.prev=12,u=JSON.parse(c),console.log("uplaod result",u),!u.success){n.next=23;break}if(e.$store.commit("uploadResults",u.results.map((function(e,t){return{file:r[t].name,result:e}}))),e.$store.commit("clearCachedPhotos"),"Upload"===e.$route.name){n.next=21;break}return n.next=21,e.$router.push("/upload");case 21:n.next=25;break;case 23:return n.next=25,e.$store.dispatch("addSnack",{text:"Upload failed!"});case 25:n.next=32;break;case 27:return n.prev=27,n.t0=n["catch"](12),n.next=31,e.$store.dispatch("addSnack",{text:"Upload failed! ".concat(c)});case 31:console.warn("result error",n.t0,c);case 32:return n.prev=32,e.showMenu=!1,e.uploadLoading=!1,n.finish(32);case 36:case"end":return n.stop()}}),n,null,[[12,27,32,36]])}))),{once:!0})},logout:function(){localStorage.clear(),location.reload()},enterPressed:function(){this.querySelect=this.query;var e=this.$refs.search;e.isMenuActive=!1},loadSuggestions:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,o,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loadingSuggestions=!0,e.items=[e.query],e.loadingSuggestions=!1,n=e.query,t.next=6,e.$store.dispatch("apiRequest",{url:"photos/suggestions?q=".concat(n)});case 6:o=t.sent,r=o.map((function(e){return e.text})),r.includes(n)||r.unshift(n),e.items=r;case 10:case"end":return t.stop()}}),t)})))()},isDate:function(e){var t=e.toLowerCase(),n=[].concat(Object(V["a"])(D["b"]),Object(V["a"])(D["d"])).map((function(e){return e.toLowerCase()}));if(n.includes(t))return{type:"month",month:n.indexOf(t)%12+1};var o=t.split(/[- _\/]/).filter((function(e){return 0!==e.length}));if(2!==o.length)return{type:"none"};var r=n.includes(o[0]),i=n.includes(o[1]),a=+o[1]>12&&+o[0]<=12;return r&&+o[1]<=31&&+o[1]>=0?{type:"dayMonth",month:n.indexOf(o[0])%12+1,day:+o[1]}:i&&+o[0]<=31&&+o[0]>=0?{type:"dayMonth",month:n.indexOf(o[1])%12+1,day:+o[0]}:a&&+o[0]<=12&&+o[0]>=0&&+o[1]<=31&&+o[1]>=0?{type:"dayMonth",month:+o[0],day:+o[1]}:+o[0]<=31&&+o[0]>=0&&+o[1]<=12&&+o[1]>=0?{type:"dayMonth",month:+o[1],day:+o[0]}:{type:"none"}},isScrubDate:function(e){var t=!isNaN(+e[0]);if(!t){var n,o=!1,r=Object(P["a"])(D["d"]);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(e.startsWith(i)){o=!0;break}}}catch(s){r.e(s)}finally{r.f()}if(!o)return{isDate:!1,date:new Date}}var a=new Date(e);return{isDate:!isNaN(a.getDate()),date:a}},startSearch:function(){if(""!==this.querySelect&&void 0!==this.querySelect&&null!==this.querySelect){var e=null,t=this.isDate(this.querySelect),n=t.type,o=t.month,r=t.day;if("month"===n)e="/date/".concat(D["b"][(null!==o&&void 0!==o?o:1)-1]);else if("dayMonth"===n)e="/date/".concat(r,"/").concat(D["b"][(null!==o&&void 0!==o?o:1)-1]);else{var i=this.isScrubDate(this.querySelect),a=i.isDate,s=i.date;e=a?"/?date=".concat(s.getFullYear(),"-").concat(s.getMonth()+1,"-").concat(s.getDate()):(this.$route.name,"/search/".concat(this.querySelect))}this.$route.path!==e&&null!==e&&this.$router.push(e)}}},watch:{querySelect:function(e){null!==e&&this.startSearch()},query:function(e){e&&e!==this.querySelect&&this.loadSuggestions()},"$route.params.query":function(){this.query=this.$route.params.query,this.querySelect=this.query}}})),q=L,H=(n("5d0a"),n("40dc")),F=n("bb78"),A=n("c6a6"),N=n("8860"),B=n("da13"),W=n("1800"),z=n("5d23"),U=n("34c3"),Y=n("e449"),G=n("490a"),J=n("b73d"),Q=Object(h["a"])(q,j,E,!1,null,"c8565cf8",null),K=Q.exports;m()(Q,{VAppBar:H["a"],VAppBarTitle:F["a"],VAutocomplete:A["a"],VBtn:p["a"],VIcon:_["a"],VList:N["a"],VListItem:B["a"],VListItemAction:W["a"],VListItemContent:z["a"],VListItemIcon:U["a"],VListItemTitle:z["c"],VMenu:Y["a"],VProgressCircular:G["a"],VSpacer:y["a"],VSwitch:J["a"]});var X=o["default"].extend({name:"App",components:{AppBar:K,SelectionInfo:I,CustomDialog:x},data:function(){return{pages:[{name:"Home",icon:"mdi-home-outline",to:"/"},{name:"Explore",icon:"mdi-magnify",to:"/explore"},{name:"Photo map",icon:"mdi-earth",to:"/map"}]}},mounted:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.$store.getters.isLoggedIn||"Login"===e.$route.name){t.next=3;break}return t.next=3,e.$router.push("/login");case 3:console.log(e.$store);case 4:case"end":return t.stop()}}),t)})))()},methods:{scrollToTop:function(){"Home"===this.$route.name&&this.$store.commit("scrollToTop",!0)},page:function(){var e=this;return this.pages.findIndex((function(t){return t.to===e.$route.path}))}},watch:{"$vuetify.theme.dark":function(){localStorage.darkTheme=this.$vuetify.theme.dark}}}),Z=X,ee=(n("034f"),n("7496")),te=n("b81c"),ne=n("f6c4"),oe=n("f774"),re=n("2db4"),ie=Object(h["a"])(Z,r,i,!1,null,null,null),ae=ie.exports;m()(ie,{VApp:ee["a"],VBottomNavigation:te["a"],VBtn:p["a"],VIcon:_["a"],VList:N["a"],VListItem:B["a"],VListItemContent:z["a"],VListItemIcon:U["a"],VListItemTitle:z["c"],VMain:ne["a"],VNavigationDrawer:oe["a"],VSnackbar:re["a"]});var se=n("9483");Object(se["a"])("".concat("/photos/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});n("7db0"),n("fb6a"),n("a15b"),n("a630");var ce=n("8c4f"),ue=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"home",staticClass:"home",style:{maxHeight:"calc(100vh - "+(e.$vuetify.application.top+e.$vuetify.application.bottom)+"px)",padding:e.pagePadding+"px"},attrs:{id:"home-element"}},[e.loaded||e.errored?!e.loaded&&e.errored?n("div",{staticClass:"error-container"},[n("v-icon",{staticClass:"error-icon"},[e._v("mdi-alert-circle-outline")]),n("p",{staticClass:"caption mt-3"},[e._v("Can't load "+e._s(e.api)+", change API url in "),n("router-link",{attrs:{to:"/settings"}},[e._v("settings")]),e._v(".")],1)],1):[n("router-view"),n("div",{staticClass:"photos",style:{width:"calc(100% - "+e.scrubberWidth+"px)"}},e._l(e.photosPerMonth,(function(t,o){return n("div",{directives:[{name:"intersect",rawName:"v-intersect",value:function(){var t=[],n=arguments.length;while(n--)t[n]=arguments[n];return e.applyLazy.apply(void 0,[o].concat(t))},expression:"(...args) => applyLazy(i, ...args)"}],key:t.id,staticClass:"lazy-month",style:{height:e.photosPerMonth[o].ready?"auto":e.photosPerMonth[o].height+"px",backgroundImage:e.photosPerMonth[o].ready?"none":"url(img/grid.png)"}},[t.loaded?n("month-grid",{ref:"monthGrid"+o,refInFor:!0,staticClass:"month",class:"month"+o,attrs:{index:o,year:t.year,month:t.month,"usable-width":e.usableWidth},on:{resizeReady:function(t){return e.monthResize(o,t)},ready:function(t,n){return e.monthReady(o,t,n)}}}):e._e()],1)})),0),e.$vuetify.breakpoint.mobile&&e.photosPerMonth.length>0?n("mobile-scrub",{staticClass:"scrubber",attrs:{"home-id":"home-element","index-in-view":e.indexInView,"photos-per-month":e.photosPerMonth}}):e.photosPerMonth.length>0?n("desktop-scrub",{staticClass:"scrubber",attrs:{"home-id":"home-element","index-in-view":e.indexInView,"photos-per-month":e.photosPerMonth}}):e._e()]:n("div",{staticClass:"error-container"},[n("v-progress-circular",{attrs:{color:"primary",width:5,size:200,indeterminate:""}}),n("p",{staticClass:"caption mt-3"},[e._v("Loading "+e._s(e.api))])],1)],2)},le=[],he=(n("25f0"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.loadedPhotos?n("photo-grid",{ref:"photoGrid",staticClass:"month-grid",attrs:{"usable-width":e.usableWidth,photos:e.photos},on:{ready:function(t){return e.$emit("ready",t,e.photos)},resizeReady:function(t){return e.$emit("resizeReady",t)}}}):e._e()}),de=[],me=(n("a9e3"),n("a2e1")),pe=n("5024"),fe=(new Date,o["default"].extend({name:"MonthGrid",components:{PhotoGrid:pe["a"],GridPhoto:me["a"]},props:{usableWidth:{type:Number,required:!0},year:{type:Number,required:!0},month:{type:Number,required:!0},index:{type:Number,required:!0}},data:function(){return{photoGrid:null,photos:[],loadedPhotos:!1}},mounted:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("getCachedPhotos",{year:e.year,month:e.month});case 2:e.photos=t.sent,e.loadedPhotos=!0;case 4:case"end":return t.stop()}}),t)})))()},methods:{scrollDateIntoView:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.$refs.photoGrid;n.scrollDateIntoView(e,t)},scrollMediaIntoView:function(e){var t=this.$refs.photoGrid;t.scrollMediaIntoView(e)}}})),ve=fe,ge=(n("5776"),Object(h["a"])(ve,he,de,!1,null,"c7c389e4",null)),be=ge.exports,ye=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"scrubber"},[n("canvas",{ref:"scrubber",staticClass:"inner-scrub scrubber-canvas",style:{height:e.canvasHeight+"px"},attrs:{width:100,height:e.canvasHeight}}),n("div",{staticClass:"inner-scrub scrubber-events",style:{height:e.canvasHeight+"px"},on:{mouseenter:function(t){e.overScrub=!0},mouseleave:function(t){e.overScrub=!1},touchstart:e.touchScrubStart,mousedown:e.scrubStart}})])},we=[],xe=(n("cb29"),new Date),ke=o["default"].extend({name:"DesktopScrub",props:{homeId:{type:String,required:!0},photosPerMonth:{type:Array,required:!0},indexInView:{type:Number,required:!0}},data:function(){return{homeElement:{},canvas:{},context:{},yearTextSize:13,renderAnimationFrame:-1,scrollTimeout:-1,scrolling:!1,scrubbing:!1,overScrub:!1,scrubData:{percent:0,year:xe.getFullYear(),month:xe.getMonth()+1}}},beforeDestroy:function(){cancelAnimationFrame(this.renderAnimationFrame),document.removeEventListener("mousemove",this.scrubMove),document.removeEventListener("mouseup",this.scrubEnd),document.removeEventListener("touchmove",this.touchScrubMove),document.removeEventListener("touchend",this.scrubEnd),this.homeElement.removeEventListener("scroll",this.homeScroll)},mounted:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.homeElement=document.querySelector("#".concat(e.homeId)),document.addEventListener("mousemove",e.scrubMove,!1),document.addEventListener("mouseup",e.scrubEnd,!1),document.addEventListener("touchmove",e.touchScrubMove,!1),document.addEventListener("touchend",e.scrubEnd,!1),e.homeElement.addEventListener("scroll",e.homeScroll,!1),e.canvas=e.$refs.scrubber,e.context=e.canvas.getContext("2d"),e.render();case 9:case"end":return t.stop()}}),t)})))()},methods:{homeScroll:function(){var e=this;this.scrolling=!0,clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout((function(){return e.scrolling=!1}),1e3)},yToMonthPhotos:function(e){for(var t=e*this.homeElement.scrollHeight,n=0;n<this.photosPerMonth.length;n++)if(t-=this.photosPerMonth[n].height,t<=0)return this.photosPerMonth[n];return this.photosPerMonth[this.photosPerMonth.length-1]},dateFromScrubEvent:function(e){var t=(e-this.$vuetify.application.top)/this.canvas.height;return t=Math.max(0,Math.min(1,1.01*t)),t},render:function(){this.renderAnimationFrame=requestAnimationFrame(this.render),this.context.font="".concat(this.yearTextSize,"px Roboto"),this.context.clearRect(0,0,this.canvas.width,this.canvas.height);var e=!this.scrubbing&&!this.overScrub;this.drawYears(e),(this.overScrub||this.scrubbing)&&this.drawScrollThumb(this.scrubData.percent*this.canvas.height,this.scrubData.year,this.scrubData.month,!1,!0);var t=this.photosPerMonth[this.indexInView];if(this.scrolling&&!this.scrubbing){var n,o,r=this.homeElement.scrollTop/this.homeElement.scrollHeight*this.canvas.height;this.drawScrollThumb(r,null!==(n=t.year)&&void 0!==n?n:0,null!==(o=t.month)&&void 0!==o?o:0,!0,!0)}else if(!this.scrubbing){var i,a,s=this.homeElement.scrollTop/this.homeElement.scrollHeight*this.canvas.height;this.drawScrollThumb(s,null!==(i=t.year)&&void 0!==i?i:0,null!==(a=t.month)&&void 0!==a?a:0,!0,!1)}},drawLoadedRegion:function(){this.context.fillStyle="rgba(50,255,100,0.16)";for(var e=50,t=0,n=this.homeElement.scrollHeight,o=0;o<this.photosPerMonth.length;o++){var r=this.photosPerMonth[o];r.loaded&&this.context.fillRect(this.canvas.width-e,t/n*this.canvas.height,e,r.height/n*this.canvas.height),t+=r.height}},drawScrollThumb:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=15,a=i+10+3,s=e;s<a&&r&&(s=a);var c=this.$vuetify.theme.dark;if(r){this.context.fillStyle=c?"rgba(0,0,0,0.7)":"rgba(255,255,255,0.7)";var u="".concat(D["d"][n-1]," ").concat(t),l=this.context.measureText(u),h=l.width;this.context.fillRect(this.canvas.width-h-10,s-i-10,h+10,i+10),this.context.fillStyle=c?"#e2e2e2":"#171717",this.context.fillText(u,this.canvas.width-h-5,s-i+5)}this.context.fillStyle=this.$vuetify.theme.themes[c?"dark":"light"].primary;var d=o?35:50;this.context.fillRect(this.canvas.width-d,e,d,o?2:3)},drawYears:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.$vuetify.theme.dark,n=0,o=-1,r=[],i=this.homeElement.scrollHeight,a=this.photosPerMonth.length-1;a>=0;a--){e||(this.context.beginPath(),this.context.fillStyle=t?"rgba(255,255,255,0.2)":"rgba(0,0,0,0.2)",this.context.arc(this.canvas.width-7,this.canvas.height-n,2,0,2*Math.PI),this.context.fill());var s=this.photosPerMonth[a];if(s.year!==o){o=s.year;var c=o.toString(),u=this.context.measureText(c),l=u.width,h=n,d=function(e){var t,n=Object(P["a"])(r);try{for(n.s();!(t=n.n()).done;){var o=Object(M["a"])(t.value,2),i=o[0],a=o[1];if(e>=i&&e<=a)return!1}}catch(s){n.e(s)}finally{n.f()}return!0};while(!d(h))h+=this.yearTextSize;r.push([h,h+this.yearTextSize]),this.context.fillStyle=t?e?"rgba(255,255,255,0.5)":"white":e?"rgba(0,0,0,0.5)":"black",this.context.fillText(c,this.canvas.width-l-15,this.canvas.height-h)}n+=this.photosPerMonth[a].height/i*this.canvas.height}},touchScrubStart:function(e){this.scrubbing=!0;var t=this.dateFromScrubEvent(e.touches[0].pageY);this.homeElement.scrollTo({top:this.homeElement.scrollHeight*t})},touchScrubMove:function(e){if(this.scrubbing){var t=this.dateFromScrubEvent(e.touches[0].pageY);this.homeElement.scrollTo({top:this.homeElement.scrollHeight*t})}},scrubStart:function(e){this.scrubbing=!0;var t=this.dateFromScrubEvent(e.pageY);this.homeElement.scrollTo({top:this.homeElement.scrollHeight*t})},scrubMove:function(e){if(this.scrubbing){var t=this.dateFromScrubEvent(e.pageY);this.homeElement.scrollTo({top:this.homeElement.scrollHeight*t})}if(this.overScrub||this.scrubbing){var n=e.pageY-this.$vuetify.application.top,o=this.yToMonthPhotos(n/this.canvas.height);this.scrubData={percent:n/this.canvas.height,year:o.year,month:o.month}}},scrubEnd:function(){this.scrubbing&&(this.scrubbing=!1)}},computed:{canvasHeight:function(){return this.$vuetify.breakpoint.height-this.$vuetify.application.top-this.$vuetify.application.bottom}},watch:{}}),Se=ke,Me=(n("1bbf"),Object(h["a"])(Se,ye,we,!1,null,"38e3a264",null)),Pe=Me.exports,Te=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mobile-scrub",style:{opacity:e.scrolling?1:0,pointerEvents:e.scrolling?"all":"none",height:e.tabSize+"px",top:e.topCss}},[n("div",{staticClass:"scrub-container"},[n("v-sheet",{staticClass:"scrub-date",attrs:{rounded:""}},[e._v(e._s(e.formattedDate))]),n("v-sheet",{staticClass:"scrub-tab",style:{width:e.tabSize+"px",height:e.tabSize+"px"},attrs:{elevation:"7"},on:{touchstart:e.touchScrubStart,mousedown:e.scrubStart}},[n("v-icon",[e._v("mdi-unfold-more-horizontal")])],1)],1)])},$e=[],De=o["default"].extend({name:"MobileScrub",props:{homeId:{type:String,required:!0},photosPerMonth:{type:Array,required:!0},indexInView:{type:Number,required:!0}},data:function(){return{tabSize:50,homeElement:{},scrollTimeout:-1,scrolling:!0,scrubbing:!1,overScrub:!1,scrollTop:0,scrollHeight:100}},beforeDestroy:function(){document.removeEventListener("mousemove",this.scrubMove),document.removeEventListener("mouseup",this.scrubEnd),document.removeEventListener("touchmove",this.touchScrubMove),document.removeEventListener("touchend",this.scrubEnd),this.homeElement.removeEventListener("scroll",this.homeScroll)},mounted:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.homeElement=document.querySelector("#".concat(e.homeId)),document.addEventListener("mousemove",e.scrubMove,!1),document.addEventListener("mouseup",e.scrubEnd,!1),document.addEventListener("touchmove",e.touchScrubMove,!1),document.addEventListener("touchend",e.scrubEnd,!1),e.homeElement.addEventListener("scroll",e.homeScroll,!1),e.scrollTimeout=setTimeout((function(){return e.scrolling=!1}),3e3);case 7:case"end":return t.stop()}}),t)})))()},methods:{updateScrollData:function(){this.scrollTop=this.homeElement.scrollTop,this.scrollHeight=this.homeElement.scrollHeight},homeScroll:function(){var e=this;this.scrolling=!0,clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout((function(){return e.scrolling=!1}),3e3),this.updateScrollData()},yToMonthPhotos:function(e){for(var t=e*this.scrollHeight,n=0;n<this.photosPerMonth.length;n++)if(t-=this.photosPerMonth[n].height,t<=0)return this.photosPerMonth[n];return this.photosPerMonth[this.photosPerMonth.length-1]},dateFromScrubEvent:function(e){var t=(e-this.$vuetify.application.top-this.tabSize/2)/(this.canvasHeight-this.tabSize);return t=Math.max(0,Math.min(1,1.01*t)),t},touchScrubStart:function(e){this.scrubbing=!0;var t=this.dateFromScrubEvent(e.touches[0].pageY);this.homeElement.scrollTo({top:this.scrollHeight*t})},touchScrubMove:function(e){if(this.scrubbing){var t=this.dateFromScrubEvent(e.touches[0].pageY);this.homeElement.scrollTo({top:this.scrollHeight*t})}},scrubStart:function(e){this.scrubbing=!0;var t=this.dateFromScrubEvent(e.pageY);this.homeElement.scrollTo({top:this.scrollHeight*t})},scrubMove:function(e){if(this.scrubbing){var t=this.dateFromScrubEvent(e.pageY);this.homeElement.scrollTo({top:this.scrollHeight*t})}},scrubEnd:function(){this.scrubbing&&(this.scrubbing=!1)}},computed:{scrubData:function(){var e=this.scrollTop/this.scrollHeight,t=this.yToMonthPhotos(e);return{percent:e,year:t.year,month:t.month}},topCss:function(){var e=Math.round((this.canvasHeight-this.tabSize)*this.scrubData.percent);return"".concat(e,"px")},formattedDate:function(){return Object(T["a"])(new Date(this.scrubData.year,this.scrubData.month-1,15),"MMM yyyy")},canvasHeight:function(){return this.$vuetify.breakpoint.height-this.$vuetify.application.top-this.$vuetify.application.bottom}},watch:{}}),Ce=De,Re=(n("a738"),n("8dd9")),_e=Object(h["a"])(Ce,Te,$e,!1,null,"4bafc9f6",null),Oe=_e.exports;m()(_e,{VIcon:_["a"],VSheet:Re["a"]});var Ie=o["default"].extend({name:"Home",components:{MobileScrub:Oe,DesktopScrub:Pe,MonthGrid:be},data:function(){return{api:D["a"],loaded:!1,errored:!1,gridHeight:190,waitPpm:null,homeElement:{},indexInView:0,ignoreDateChange:!1}},mounted:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,o,r,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.homeElement=e.$refs.home,n="HomePhoto"===e.$route.name,t.prev=2,t.next=5,e.updatePhotosPerMonth(!n&&null===e.hasDate,[0]);case 5:e.loaded=!0,t.next=12;break;case 8:t.prev=8,t.t0=t["catch"](2),e.errored=!0,console.error(t.t0);case 12:if(n||null!==e.hasDate||setTimeout((function(){var t=e.photosPerMonth[1];t&&(t.loaded=!0)}),500),null===e.hasDate||n||e.updateFromDateQuery(),n){o=Object(P["a"])(e.photosPerMonth);try{for(o.s();!(r=o.n()).done;)i=r.value,i.loaded=i.viewed}catch(a){o.e(a)}finally{o.f()}}case 15:case"end":return t.stop()}}),t,null,[[2,8]])})))()},methods:{updatePhotosPerMonth:function(e,t){var n=this;return Object(a["a"])(regeneratorRuntime.mark((function o(){var r,i,a,s;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return r=5,i=4/3,a=n.usableWidth/(n.gridHeight*i),n.waitPpm=n.$store.dispatch("apiRequest",{url:"photos/months"}),o.next=6,n.waitPpm;case 6:s=o.sent,n.photosPerMonth=s.map((function(o,i){var s=o.year,c=void 0===s?0:s,u=o.month,l=void 0===u?0:u,h=o.count,d=void 0===h?0:h;return{year:c,month:l,count:d,viewed:t.includes(i),loaded:e&&t.includes(i),ready:!1,height:Math.ceil(d/a)*(n.gridHeight+r),photos:[],id:c.toString()+l}}));case 8:case"end":return o.stop()}}),o)})))()},monthResize:function(e,t){console.log("Month resize",e),o["default"].set(this.photosPerMonth[e],"height",t)},monthReady:function(e,t,n){console.log("Month ready",e),o["default"].set(this.photosPerMonth[e],"photos",n),o["default"].set(this.photosPerMonth[e],"height",t),o["default"].set(this.photosPerMonth[e],"ready",!0),this.$emit("monthReady",e),this.$emit("monthReady"+e)},applyLazy:function(e,t,n,o){var r=this;if(this.photosPerMonth[e].viewed!==o){this.photosPerMonth[e].viewed=o,o?this.indexInView=e:this.indexInView===e&&(this.indexInView=this.photosPerMonth.findIndex((function(e){return e.viewed}))),setTimeout((function(){var t=r.photosPerMonth[e].viewed;t&&(e>0&&(r.photosPerMonth[e-1].loaded=!0),r.photosPerMonth[e].loaded=!0,e+1<r.photosPerMonth.length&&(r.photosPerMonth[e+1].loaded=!0),console.log("loading",e))}),0===e?0:400);var i=function(e){var t=r.photosPerMonth[e].loaded,n=r.photosPerMonth[e].viewed;e>0&&(n||(n=r.photosPerMonth[e-1].viewed)),e+1<r.photosPerMonth.length&&(n||(n=r.photosPerMonth[e+1].viewed)),!n&&t&&(r.photosPerMonth[e].loaded=!1,r.photosPerMonth[e].ready=!1,console.log("unloading",e))};setTimeout((function(){i(e),e+1<r.photosPerMonth.length&&i(e+1),e>0&&i(e-1)}),500)}},dateToIndex:function(e){if(null===e)return-1;var t=e.getFullYear(),n=e.getMonth()+1;return this.photosPerMonth.findIndex((function(e){return e.year===t&&e.month==n}))},getClosestPhotoMonthIndex:function(e){for(var t=1/0,n=-1,o=e.getTime(),r=0;r<this.photosPerMonth.length;r++){var i=this.photosPerMonth[r],a=Math.abs(new Date(i.year,i.month-1,15).getTime()-o);if(!(a<t))break;t=a,n=r}return n},scrollMediaIntoView:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var o,r,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(null!==e){n.next=2;break}return n.abrupt("return");case 2:if(o=t.dateToIndex(e.createDate),r=t.photosPerMonth[o],!r.ready){n.next=9;break}i=t.$refs["monthGrid"+o],i&&i.length>0&&i[0].scrollMediaIntoView(e),n.next=15;break;case 9:if(t.scrollDateIntoView(e.createDate,!1),r.ready){n.next=13;break}return n.next=13,new Promise((function(e){return t.$once("monthReady"+o,e)}));case 13:return n.next=15,t.scrollMediaIntoView(e);case 15:case"end":return n.stop()}}),n)})))()},scrollDateIntoView:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(null!==e){var o=this.dateToIndex(e);-1===o&&(o=this.getClosestPhotoMonthIndex(e));for(var r=0,i=0;i<o;i++)r+=this.photosPerMonth[i].height;var a=function(){var r=t.$refs["monthGrid"+o];r&&r.length>0&&r[0].scrollDateIntoView(e,n)};this.photosPerMonth[o].ready?a():(this.$nextTick((function(){t.homeElement.scrollTop=r})),this.$once("monthReady"+o,(function(){return t.$nextTick((function(){return a()}))})))}},updateFromDateQuery:function(){null!==this.hasDate&&this.scrollDateIntoView(this.hasDate)},reloadPhotos:function(){var e=arguments,t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var o,r,i,a,s,c,u,l,h;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:for(o=e.length>0&&void 0!==e[0]?e[0]:null,r=[],i=0;i<t.photosPerMonth.length;i++)t.photosPerMonth[i].viewed&&r.push(i);return n.next=5,t.updatePhotosPerMonth(!0,r);case 5:t.$store.commit("clearCachedPhotos"),a=Object(P["a"])(t.photosPerMonth);try{for(a.s();!(s=a.n()).done;)c=s.value,c.loaded=!1,c.ready=!1}catch(d){a.e(d)}finally{a.f()}return n.next=10,t.$nextTick();case 10:u=Object(P["a"])(t.photosPerMonth);try{for(u.s();!(l=u.n()).done;)h=l.value,h.viewed&&(h.loaded=!0)}catch(d){u.e(d)}finally{u.f()}if(null!==o){n.next=14;break}return n.abrupt("return");case 14:return n.next=16,t.scrollMediaIntoView(o);case 16:case"end":return n.stop()}}),n)})))()}},computed:{photosPerMonth:{get:function(){return this.$store.state.photosPerMonth},set:function(e){this.$store.commit("photosPerMonth",e)}},hasDate:function(){if(void 0===this.$route.query.date||null===this.$route.query.date)return null;var e=new Date(this.$route.query.date);return isNaN(e.getDate())?null:e},pagePadding:function(){return this.$vuetify.breakpoint.mobile?0:10},scrubberWidth:function(){return this.$vuetify.breakpoint.mobile?0:50},usableWidth:function(){return this.$vuetify.breakpoint.width-this.$vuetify.application.left-this.$vuetify.application.right-2*this.pagePadding-this.scrubberWidth},totalPhotos:function(){var e,t=0,n=Object(P["a"])(this.photosPerMonth);try{for(n.s();!(e=n.n()).done;){var o=e.value;t+=o.count}}catch(r){n.e(r)}finally{n.f()}return t},photosQueue:function(){var e,t=[],n=Object(P["a"])(this.photosPerMonth);try{for(n.s();!(e=n.n()).done;){var o=e.value;t.push.apply(t,Object(V["a"])(o.photos))}}catch(r){n.e(r)}finally{n.f()}return t}},watch:{"$store.state.reloadPhotos":function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.$store.state.reloadPhotos,!1!==n){t.next=3;break}return t.abrupt("return");case 3:return e.$store.commit("reloadPhotos",!1),t.next=6,e.reloadPhotos(!0===n?null:n);case 6:case"end":return t.stop()}}),t)})))()},"$store.state.scrollToTop":function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.$store.state.scrollToTop){t.next=2;break}return t.abrupt("return");case 2:return e.$store.commit("scrollToTop",!1),t.next=5,e.waitPpm;case 5:return e.homeElement.scrollTo({top:0,behavior:"smooth"}),t.next=8,e.reloadPhotos();case 8:case"end":return t.stop()}}),t)})))()},"$store.state.keepInView":function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.$store.state.keepInView){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.waitPpm;case 4:return n=e.$store.state.keepInView,t.next=7,e.scrollMediaIntoView(n);case 7:case"end":return t.stop()}}),t)})))()},"$route.query.date":function(){this.ignoreDateChange?this.ignoreDateChange=!1:null!==this.hasDate&&this.scrollDateIntoView(this.hasDate)},"$route.name":function(){"HomePhoto"===this.$route.name&&(this.ignoreDateChange=!0)},photosQueue:function(){this.$store.commit("viewerQueue",this.photosQueue)}}}),je=Ie,Ee=(n("4786"),n("269a")),Ve=n.n(Ee),Le=n("90a2"),qe=Object(h["a"])(je,ue,le,!1,null,"763aec38",null),He=qe.exports;m()(qe,{VIcon:_["a"],VProgressCircular:G["a"]}),Ve()(qe,{Intersect:Le["a"]}),o["default"].use(ce["a"]);var Fe=[{path:"/",name:"Home",component:He,meta:{title:"Photos - Ruurd Photos"},children:[{meta:{title:"Photo - Ruurd Photos"},path:"/photo/:id",name:"HomePhoto",component:function(){return Promise.all([n.e("chunk-742b9690"),n.e("chunk-1d9a72b3"),n.e("chunk-71a0882b")]).then(n.bind(null,"6ec5"))}}]},{path:"/search/:query",name:"Search",meta:{title:":query - Ruurd Photos"},component:function(){return Promise.all([n.e("chunk-742b9690"),n.e("chunk-d936b74e")]).then(n.bind(null,"2d3b"))},children:[{meta:{title:"Photo - Ruurd Photos"},path:"/search/:query/photo/:id",name:"SearchPhoto",component:function(){return Promise.all([n.e("chunk-742b9690"),n.e("chunk-1d9a72b3"),n.e("chunk-71a0882b")]).then(n.bind(null,"6ec5"))}}]},{path:"/date/:month",name:"DateMonth",meta:{title:":month - Ruurd Photos"},component:function(){return n.e("chunk-4aa48bc8").then(n.bind(null,"9659"))},children:[{meta:{title:"Photo - Ruurd Photos"},path:"/date/:month/photo/:id",name:"DateMonthPhoto",component:function(){return Promise.all([n.e("chunk-742b9690"),n.e("chunk-1d9a72b3"),n.e("chunk-71a0882b")]).then(n.bind(null,"6ec5"))}}]},{path:"/date/:day/:month",name:"DateDay",meta:{title:":day :month - Ruurd Photos"},component:function(){return n.e("chunk-4aa48bc8").then(n.bind(null,"9659"))},children:[{meta:{title:"Photo - Ruurd Photos"},path:"/date/:day/:month/photo/:id",name:"DateDayPhoto",component:function(){return Promise.all([n.e("chunk-742b9690"),n.e("chunk-1d9a72b3"),n.e("chunk-71a0882b")]).then(n.bind(null,"6ec5"))}}]},{path:"/explore",name:"Explore",meta:{title:"Explore - Ruurd Photos"},component:function(){return n.e("chunk-f6deb52a").then(n.bind(null,"7797"))}},{path:"/map",name:"Map",meta:{title:"Map - Ruurd Photos"},component:function(){return Promise.all([n.e("chunk-742b9690"),n.e("chunk-1d9a72b3"),n.e("chunk-46b666e5")]).then(n.bind(null,"4bb4"))}},{path:"/settings",name:"Settings",meta:{title:"Settings - Ruurd Photos"},component:function(){return n.e("chunk-6b60678c").then(n.bind(null,"26d3"))}},{path:"/trash",name:"Trash",meta:{title:"Trash - Ruurd Photos"},component:function(){return n.e("chunk-46845a4e").then(n.bind(null,"27c8"))}},{path:"/upload",name:"Upload",meta:{title:"Upload results - Ruurd Photos"},component:function(){return n.e("chunk-a1fd35c4").then(n.bind(null,"f264"))}},{path:"/login",name:"Login",meta:{title:"Login - Ruurd Photos"},component:function(){return n.e("chunk-4ba78246").then(n.bind(null,"a55b"))}}],Ae=new ce["a"]({routes:Fe});Ae.beforeEach((function(e,t,n){var o=e.matched.slice().reverse().find((function(e){return e.meta&&e.meta.title})),r=t.matched.slice().reverse().find((function(e){return e.meta&&e.meta.metaTags})),i=null;if(o?i=o.meta.title:r&&(i=r.meta.title),null!==i){for(var a=i.split(" "),s=0;s<a.length;s++)if(a[s].startsWith(":")){var c=a[s].substr(1);c.length>0&&e.params.hasOwnProperty(c)&&(a[s]=e.params[c])}document.title=a.join(" ")}Array.from(document.querySelectorAll("[data-vue-router-controlled]")).map((function(e){var t;return null===(t=e.parentNode)||void 0===t?void 0:t.removeChild(e)})),n()}));var Ne=Ae,Be=n("5530"),We=(n("159b"),n("a434"),n("2f62")),ze=n("bfa9"),Ue=n("b0d1"),Ye=new ze["a"]({reducer:function(e){return{email:e.email,password:e.password,verifiedLogin:e.verifiedLogin,showInfo:e.showInfo,mapboxKey:e.mapboxKey}},storage:window.localStorage});o["default"].use(We["a"]);var Ge=new We["a"].Store({state:{api:D["a"],snackbars:[],reloadPhotos:!1,scrollToTop:!1,searchResults:{low:[],high:[],searchType:null,glossary:"",placeName:""},dateResults:[],email:"",password:"",viewerQueue:[],keepInView:null,showInfo:!1,mapboxKey:"",cachedPhotos:{},prompt:{show:!1,title:"",subtitle:"",cancelText:"",confirmText:"",onConfirm:function(){return 0},onCancel:function(){return 0}},photosPerMonth:[],photoSelection:{},lastSelectedPhoto:null,delayedIsSelecting:!1,uploadResults:[]},mutations:{uploadResults:function(e,t){return e.uploadResults=t},delayedIsSelecting:function(e,t){return e.delayedIsSelecting=t},lastSelectedPhoto:function(e,t){return e.lastSelectedPhoto=t},clearPhotoSelection:function(e){return e.photoSelection={}},removeBatchFromPhotoSelection:function(e,t){return t.forEach((function(t){return o["default"].delete(e.photoSelection,t.id)}))},addBatchToPhotoSelection:function(e,t){return t.forEach((function(t){return o["default"].set(e.photoSelection,t.id,t)}))},addToPhotoSelection:function(e,t){return o["default"].set(e.photoSelection,t.id,t)},removeFromPhotoSelection:function(e,t){return o["default"].delete(e.photoSelection,t.id)},addSnackObject:function(e,t){return e.snackbars.push(t)},removeSnack:function(e,t){return e.snackbars.splice(e.snackbars.indexOf(t),1)},searchResultsHigh:function(e,t){return e.searchResults.high=t},searchResultsLow:function(e,t){return e.searchResults.low=t},searchType:function(e,t){return e.searchResults.searchType=t},glossary:function(e,t){return e.searchResults.glossary=t},placeName:function(e,t){return e.searchResults.placeName=t},mapboxKey:function(e,t){return e.mapboxKey=t},photosPerMonth:function(e,t){return e.photosPerMonth=t},showInfo:function(e,t){return e.showInfo=t},reloadPhotos:function(e,t){return e.reloadPhotos=t},scrollToTop:function(e,t){return e.scrollToTop=t},keepInView:function(e,t){return e.keepInView=t},viewerQueue:function(e,t){return e.viewerQueue=t},dateResults:function(e,t){return e.dateResults=t},clearCachedPhotos:function(e){return e.cachedPhotos={}},cachedPhotos:function(e,t){return o["default"].set(e.cachedPhotos,t.key,t.media)},login:function(e,t){var n=t.email,o=t.password;e.email=n,e.password=o},hidePrompt:function(e){return e.prompt.show=!1},showPrompt:function(e,t){var n=t.title,o=void 0===n?"Are you sure?":n,r=t.subtitle,i=void 0===r?"There may be unsaved changes":r,a=t.cancelText,s=void 0===a?"Cancel":a,c=t.confirmText,u=void 0===c?"Confirm":c,l=t.onConfirm,h=void 0===l?function(){return 0}:l,d=t.onCancel,m=void 0===d?function(){return 0}:d;e.prompt.show=!0,e.prompt.title=o,e.prompt.subtitle=i,e.prompt.cancelText=s,e.prompt.confirmText=u,e.prompt.onConfirm=h,e.prompt.onCancel=m}},getters:{selectedMedias:function(e){var t=Object.values(e.photoSelection);return t.sort((function(e,t){return e.createDate.getTime()-t.createDate.getTime()}))},isLoggedIn:function(e){return""!==e.email&&""!==e.password},isSelected:function(e){return function(t){return e.photoSelection.hasOwnProperty(t)}},isSelecting:function(e){return Object.keys(e.photoSelection).length>0}},actions:{addSnack:function(e,t){e.state;var n=e.commit,o=t.text,r=t.toText,i=void 0===r?"Go":r,a=t.to,s=void 0===a?null:a,c=t.timeout,u=void 0===c?4e3:c,l={text:o,toText:i,to:s,open:!0,timeout:u,id:Math.random()};n("addSnackObject",l),setTimeout((function(){n("removeSnack",l)}),u+500)},showPrompt:function(e,t){return Object(a["a"])(regeneratorRuntime.mark((function n(){var o,r,i,a,s,c,u,l,h;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=e.commit,r=t.title,i=void 0===r?"Are you sure?":r,a=t.subtitle,s=void 0===a?"This will discard all unsaved changes":a,c=t.cancelText,u=void 0===c?"Cancel":c,l=t.confirmText,h=void 0===l?"Confirm":l,n.abrupt("return",new Promise((function(e){o("showPrompt",{title:i,subtitle:s,cancelText:u,confirmText:h,onConfirm:function(){return e(!0)},onCancel:function(){return e(!1)}})})));case 3:case"end":return n.stop()}}),n)})))()},getCachedPhotos:function(e,t){return Object(a["a"])(regeneratorRuntime.mark((function n(){var o,r,i,a,s,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.state,r=e.dispatch,i=e.commit,a=t.year.toString()+t.month,!o.cachedPhotos.hasOwnProperty(a)){n.next=4;break}return n.abrupt("return",o.cachedPhotos[a]);case 4:return n.next=6,r("apiRequest",{url:"photos/month-photos",body:{month:[t.year,t.month]}});case 6:return s=n.sent,c=s.map(Ue["a"].fromObject),i("cachedPhotos",{key:a,media:c}),n.abrupt("return",c);case 10:case"end":return n.stop()}}),n)})))()},apiRequest:function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t,n){var o,r,i,a,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(o=t.state,r=t.getters,i=n.url,a=n.body,s=void 0===a?{}:a,r.isLoggedIn){e.next=4;break}return e.abrupt("return",{loggedIn:!1,result:null});case 4:return e.next=6,fetch("".concat(o.api,"/").concat(i),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object(Be["a"])({auth:{email:o.email,password:o.password}},s))}).then((function(e){return e.text()}));case 6:return c=e.sent,e.prev=7,e.abrupt("return",JSON.parse(c));case 11:return e.prev=11,e.t0=e["catch"](7),console.warn("Can't parse",{url:i,txt:c}),e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,null,[[7,11]])})));function t(t,n){return e.apply(this,arguments)}return t}(),checkLogin:function(e,t){return Object(a["a"])(regeneratorRuntime.mark((function n(){var o,r,i,a,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=e.state,r=e.commit,i=t.email,a=t.password,n.next=4,fetch("".concat(o.api,"/auth"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth:{email:i,password:a}})}).then((function(e){return e.json()}));case 4:return s=n.sent,r("login",{email:i,password:a}),n.abrupt("return",s);case 7:case"end":return n.stop()}}),n)})))()},dateSearch:function(e,t){return Object(a["a"])(regeneratorRuntime.mark((function n(){var o,r,i,a,s,c,u,l;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=e.dispatch,r=e.commit,e.state,i=t.day,a=void 0===i?null:i,s=t.month,c=void 0===s?null:s,n.next=4,o("apiRequest",{url:"photos/dateSearch?m=".concat(c,"&d=").concat(a)});case 4:u=n.sent,l=u.map(Ue["a"].fromObject),r("dateResults",l);case 7:case"end":return n.stop()}}),n)})))()},search:function(e,t){return Object(a["a"])(regeneratorRuntime.mark((function n(){var o,r,i,a,s,c,u,l,h,d;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=e.dispatch,r=e.commit,e.state,n.next=3,o("apiRequest",{url:"photos/search?q=".concat(t)});case 3:i=n.sent,a=i.results,s=i.info,c=i.type,r("searchType",c),"label"===c?r("glossary",s):"place"===c&&r("placeName",s),u=a.map((function(e){return e.rank})).reduce((function(e,t){return e+t}),0)/a.length,l=Math.min(u,1.2),h=a.filter((function(e){return e.rank<l})).map(Ue["a"].fromObject),d=a.filter((function(e){return e.rank>=l})).map(Ue["a"].fromObject),r("searchResultsLow",h),r("searchResultsHigh",d);case 15:case"end":return n.stop()}}),n)})))()}},modules:{},plugins:[Ye.plugin]}),Je=n("f309");o["default"].use(Je["a"]);var Qe=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;null!==localStorage.getItem("darkTheme")&&(Qe="true"===localStorage.darkTheme);var Ke=new Je["a"]({breakpoint:{mobileBreakpoint:"sm"},theme:{dark:Qe,themes:{dark:{primary:"#5996d1",secondary:"#c95313",selectionColor:"#252b32"},light:{primary:"#318bd5",secondary:"#d05524",selectionColor:"#dae5f3"}}}}),Xe=n("a4a1"),Ze=n.n(Xe),et=(n("f6b9"),n("8f0d"));n("6cc5");o["default"].config.productionTip=!1,o["default"].use(Ze.a),o["default"].use(et["a"]),new o["default"]({router:Ne,store:Ge,vuetify:Ke,render:function(e){return e(ae)}}).$mount("#app")},d522:function(e,t,n){},e216:function(e,t,n){"use strict";n("81fc")}});
//# sourceMappingURL=app.e419d7cb.js.map