(function(t){function e(e){for(var r,o,s=e[0],c=e[1],u=e[2],l=0,h=[];l<s.length;l++)o=s[l],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&h.push(a[o][0]),a[o]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(t[r]=c[r]);d&&d(e);while(h.length)h.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],r=!0,o=1;o<n.length;o++){var s=n[o];0!==a[s]&&(r=!1)}r&&(i.splice(e--,1),t=c(c.s=n[0]))}return t}var r={},o={app:0},a={app:0},i=[];function s(t){return c.p+"js/"+({}[t]||t)+"."+{"chunk-32b10c6e":"f3ac2cc4","chunk-5b589200":"26309516","chunk-5e08b530":"d585da9c","chunk-6a0d8bb6":"1f1dcd80","chunk-d05f20e6":"87233b67"}[t]+".js"}function c(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.e=function(t){var e=[],n={"chunk-32b10c6e":1,"chunk-5b589200":1,"chunk-5e08b530":1,"chunk-6a0d8bb6":1,"chunk-d05f20e6":1};o[t]?e.push(o[t]):0!==o[t]&&n[t]&&e.push(o[t]=new Promise((function(e,n){for(var r="css/"+({}[t]||t)+"."+{"chunk-32b10c6e":"f792aa6f","chunk-5b589200":"497e47e6","chunk-5e08b530":"2efca91c","chunk-6a0d8bb6":"dfd9d476","chunk-d05f20e6":"dd4dbf28"}[t]+".css",a=c.p+r,i=document.getElementsByTagName("link"),s=0;s<i.length;s++){var u=i[s],l=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(l===r||l===a))return e()}var h=document.getElementsByTagName("style");for(s=0;s<h.length;s++){u=h[s],l=u.getAttribute("data-href");if(l===r||l===a)return e()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=e,d.onerror=function(e){var r=e&&e.target&&e.target.src||a,i=new Error("Loading CSS chunk "+t+" failed.\n("+r+")");i.code="CSS_CHUNK_LOAD_FAILED",i.request=r,delete o[t],d.parentNode.removeChild(d),n(i)},d.href=a;var p=document.getElementsByTagName("head")[0];p.appendChild(d)})).then((function(){o[t]=0})));var r=a[t];if(0!==r)if(r)e.push(r[2]);else{var i=new Promise((function(e,n){r=a[t]=[e,n]}));e.push(r[2]=i);var u,l=document.createElement("script");l.charset="utf-8",l.timeout=120,c.nc&&l.setAttribute("nonce",c.nc),l.src=s(t);var h=new Error;u=function(e){l.onerror=l.onload=null,clearTimeout(d);var n=a[t];if(0!==n){if(n){var r=e&&("load"===e.type?"missing":e.type),o=e&&e.target&&e.target.src;h.message="Loading chunk "+t+" failed.\n("+r+": "+o+")",h.name="ChunkLoadError",h.type=r,h.request=o,n[1](h)}a[t]=void 0}};var d=setTimeout((function(){u({type:"timeout",target:l})}),12e4);l.onerror=l.onload=u,document.head.appendChild(l)}return Promise.all(e)},c.m=t,c.c=r,c.d=function(t,e,n){c.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)c.d(n,r,function(e){return t[e]}.bind(null,r));return n},c.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(e,"a",e),e},c.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},c.p="/photos/",c.oe=function(t){throw console.error(t),t};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=e,u=u.slice();for(var h=0;h<u.length;h++)e(u[h]);var d=l;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("cd49")},"034f":function(t,e,n){"use strict";n("85ec")},1889:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"d",(function(){return o})),n.d(e,"a",(function(){return a})),n.d(e,"c",(function(){return i}));n("6b93"),n("b680"),n("d3b7"),n("25f0"),n("4d90"),n("99af");var r=["January","February","March","April","May","June","July","August","September","October","November","December"],o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function a(t){var e=Math.log10(t);return e<3?t+" B":e<6?(t/1024).toFixed(1)+" kB":e<9?(t/Math.pow(1024,2)).toFixed(2)+" MB":e<12?(t/Math.pow(1024,3)).toFixed(2)+" GB":e<15?(t/Math.pow(1024,4)).toFixed(2)+" TB":"very bige bytes"}function i(t){if(isNaN(t)||void 0===t)return"0:00";t=Math.round(t);var e=Math.floor(t/3600),n=Math.floor(t%3600/60),r=t%60,o=e.toString(),a=n.toString(),i=r.toString();return"0"!==o&&(a=a.padStart(2,"0"),i=i.padStart(2,"0")),i=i.padStart(2,"0"),"0"===o?"".concat(a,":").concat(i):"".concat(o,":").concat(a,":").concat(i)}},"1a43":function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var r="https://api.ruurd.dev"},2252:function(t,e,n){t.exports=n.p+"img/transparent-color-icon-256.7963b11c.png"},4814:function(t,e,n){"use strict";n("6612")},5024:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"frame",staticClass:"photo-grid roboto"},t._l(t.photoRows,(function(e){return n("div",{ref:"rows",refInFor:!0,staticClass:"block-row"},t._l(e,(function(e){var r;return n("div",{ref:"blocks",refInFor:!0,staticClass:"photo-block"},[n("div",{staticClass:"block-day",class:(r={"hide-date":e.hideDate},r[t.dateToClass(e.date)]=!0,r),style:{maxWidth:Math.floor(e.width)+"px"},attrs:{title:e.day}},[n("router-link",{staticClass:"no-style",attrs:{to:"/?date="+t.formatDate(e.date,"yyyy-MM-dd")}},[t._v(" "+t._s(e.day)+" ")])],1),n("div",{staticClass:"photos"},t._l(e.layoutMedias,(function(r){var o=r.media,a=r.visualWidth,i=r.visualHeight;return n("router-link",{key:o.id,staticClass:"photo",class:"p"+o.id,style:{height:i+"px",width:a+"px"},attrs:{to:t.currentPath+"/photo/"+o.id}},["photo"===o.type?n("div",{staticClass:"image-container"},[n("div",{staticClass:"image-background",style:{backgroundImage:"url("+t.getThumbUrl(o.id,e.height)+")"}}),n("div",{staticClass:"image-overlay"},[n("div",{staticClass:"image-info"},["vr"===o.subType?n("v-icon",{staticClass:"icon",attrs:{color:"white"}},[t._v(" mdi-rotate-3d-variant ")]):"portrait"===o.subType?n("v-icon",{staticClass:"icon",attrs:{color:"white"}},[t._v(" mdi-blur ")]):t._e()],1)])]):n("div",{staticClass:"video-container",on:{mouseleave:function(e){return t.pauseVideo(o.id)},mouseenter:function(e){return t.playVideo(o.id)}}},[n("video",{ref:"video"+o.id,refInFor:!0,attrs:{poster:""+t.getThumbUrl(o.id,e.height),muted:"",loop:"",src:t.api+"/photos/webm/"+o.id+".webm"},domProps:{muted:!0}}),n("div",{staticClass:"video-overlay"},[n("div",{staticClass:"video-info"},[n("span",{staticClass:"video-duration"},[t._v(t._s(t.toHms(o.duration/1e3)))]),"none"===o.subType?n("v-icon",{staticClass:"icon",attrs:{color:"white"}},[t._v(" mdi-play-circle-outline ")]):"slomo"===o.subType?n("v-icon",{staticClass:"icon",attrs:{color:"white"}},[t._v(" mdi-play-speed ")]):t._e()],1)])])])})),1)])})),0)})),0)},o=[],a=n("b85c"),i=n("3835"),s=n("1da1"),c=(n("99af"),n("d81d"),n("ac1f"),n("5319"),n("fb6a"),n("8a79"),n("96cf"),n("2b0e")),u=n("1a43"),l=n("1889"),h=n("b166"),d=c["a"].extend({name:"PhotoGrid",props:{photos:{type:Array,required:!0},timeline:{type:Boolean,default:!1}},data:function(){return{photoRows:[],frameWidth:window.innerWidth-256,api:u["a"]}},beforeDestroy:function(){window.removeEventListener("resize",this.onResize)},mounted:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.updateFrameWidth(),e.next=3,t.calculateLayout();case 3:window.addEventListener("resize",t.onResize,!1);case 4:case"end":return e.stop()}}),e)})))()},methods:{formatDate:function(t,e){return t instanceof Date&&(t=new Date(t)),Object(h["a"])(t,e)},getThumbUrl:function(t,e){var n="tiny";return e>260&&(n="small"),e>500&&(n="big"),"".concat(u["a"],"/photos/").concat(n,"/").concat(t,".webp")},calculateLayout:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var n,r,o,s,c,u,l,h,d,p,f,m,v,g,b,y,w,x,k,S,M,P,R,D,O,T,j,$,L,q,C,E,_,F,I,V,H,N,A,B,W,U,J,Y,G,z,K,Q,X,Z,tt,et,nt,rt,ot,at,it,st,ct,ut,lt,ht;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.photos.map((function(t){return{media:t,visualWidth:0,visualHeight:0}})),0!==n.length){e.next=4;break}return t.photoRows=[],e.abrupt("return");case 4:t.updateFrameWidth(),r=(new Date).getFullYear(),o=(new Date).toDateString(),s=new Date((new Date).getTime()-864e5).toDateString(),c=function(t){var e=t.toDateString(),n=t.getMonth()+1,a=t.getTime();return e===o?["Today",n,a]:e===s?["Yesterday",n,a]:t.getFullYear()===r?[e.substr(0,e.length-5),n,a]:[e,n,a]},u=c(n[0].media.createDate),l=Object(i["a"])(u,3),h=l[0],d=l[1],p=l[2],f={day:h,month:d,date:p,layoutMedias:[]},m=[],v=Object(a["a"])(n);try{for(v.s();!(g=v.n()).done;)b=g.value,y=c(b.media.createDate),w=Object(i["a"])(y,3),x=w[0],k=w[1],S=w[2],f.day!==x&&(m.push(f),f={day:x,month:k,layoutMedias:[],date:S}),f.layoutMedias.push(b)}catch(dt){v.e(dt)}finally{v.f()}for(m.push(f),M=t.frameWidth-2,P=150+Math.min(window.innerWidth/30,64),R=[],D=[],O={layoutMedias:[],day:h,month:d,date:p,width:0,height:0,hideDate:!1},T=0,j=0,$=0,L=m;$<L.length;$++){q=L[$],C=q.day,E=q.month,_=Object(a["a"])(q.layoutMedias);try{for(_.s();!(F=_.n()).done;)I=F.value,V=P*I.media.ratio,H=T+V,N=M-T,A=q.layoutMedias.length,B=E!==O.month,W=C!==O.day,U=H>M||W&&N-V<100||W&&A>3||W&&j>3||t.timeline&&B,(U||W)&&(O.layoutMedias.length>0&&D.push(O),O={layoutMedias:[],day:C,width:0,height:0,hideDate:U&&!W,month:E,date:q.date},U&&(D.length>0&&R.push(D),D=[],T=0)),T+=V,O.layoutMedias.push(I)}catch(dt){_.e(dt)}finally{_.f()}j=q.layoutMedias.length}for(D.push(O),R.push(D),J=5,Y=40,G=0,z=R;G<z.length;G++){K=z[G],Q=[],X=Object(a["a"])(K);try{for(X.s();!(Z=X.n()).done;)tt=Z.value,tt.width=tt.layoutMedias.map((function(t){return t.media.ratio*P})).reduce((function(t,e){return t+e})),Q.push(tt.width)}catch(dt){X.e(dt)}finally{X.f()}et=Q.reduce((function(t,e){return t+e})),nt=K.map((function(t){return(t.layoutMedias.length-1)*J})),rt=(K.length-1)*Y,ot=nt.reduce((function(t,e){return t+e}))+rt,at=(M-ot)/et,at>2.1&&(at=1),it=Object(a["a"])(K);try{for(it.s();!(st=it.n()).done;){ct=st.value,ct.height=P*at,ut=Object(a["a"])(ct.layoutMedias);try{for(ut.s();!(lt=ut.n()).done;)ht=lt.value,ht.visualHeight=P*at,ht.visualWidth=Math.floor(P*ht.media.ratio*at)}catch(dt){ut.e(dt)}finally{ut.f()}}}catch(dt){it.e(dt)}finally{it.f()}}console.log("setting photoRows",R),t.photoRows=R,console.log("emitting photoRowsUpdate"),t.$emit("photoRowsUpdate");case 32:case"end":return e.stop()}}),e)})))()},onResize:function(){this.$vuetify.breakpoint.width===window.innerWidth&&this.$vuetify.breakpoint.height===window.innerHeight||requestAnimationFrame(this.calculateLayout)},updateFrameWidth:function(){var t,e;this.frameWidth=null!==(t=null===(e=this.$refs.frame)||void 0===e?void 0:e.clientWidth)&&void 0!==t?t:window.innerWidth-this.$vuetify.application.left},playVideo:function(t){var e,n,r=null===(e=this.$refs["video"+t])||void 0===e?void 0:e[0];null===r||void 0===r||null===(n=r.play)||void 0===n||n.call(r)},pauseVideo:function(t){var e,n,r=null===(e=this.$refs["video"+t])||void 0===e?void 0:e[0];null===r||void 0===r||null===(n=r.pause)||void 0===n||n.call(r)},dateToClass:function(t){"number"===typeof t&&(t=new Date(t));var e=t.toDateString();return"d".concat(e.replace(/ /g,"_"))},scrollMediaIntoView:function(t){return Object(s["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=document.querySelector(".p".concat(t.id)),console.log("scrolling into view",t.id,{mediaElement:n}),null!==n){e.next=4;break}return e.abrupt("return");case 4:n.scrollIntoView({block:"center"});case 5:case"end":return e.stop()}}),e)})))()},scrollDateIntoView:function(t,e,n){var r=this;return Object(s["a"])(regeneratorRuntime.mark((function o(){var i,s,c,u,l,h,d,p,f,m,v,g,b,y,w,x,k;return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(i=new Date,i.setFullYear(n),i.setMonth(e-1),i.setDate(t),s=r.dateToClass(i),c=document.querySelector(".".concat(s)),console.log("scrolling into view",{dateClass:s,dateElement:c}),null!==c){o.next=63;break}u=Object(a["a"])(r.photoRows),o.prev=9,u.s();case 11:if((l=u.n()).done){o.next=53;break}l.value,h=i.getTime(),d=r.photoRows;case 15:if(p=Math.floor(d.length/2),f=d[p][0].date,d=h<f?d.slice(p):d.slice(0,p),1!==d.length){o.next=21;break}return o.abrupt("break",23);case 21:o.next=15;break;case 23:m=r.photoRows.indexOf(d[0]),v=m;case 25:if(!(v>=0)){o.next=49;break}g=r.photoRows[v],b=Object(a["a"])(g),o.prev=28,b.s();case 30:if((y=b.n()).done){o.next=38;break}if(w=y.value.date,x=new Date(w),x.getDate()===t&&x.getMonth()+1===e&&x.getFullYear()===n){o.next=36;break}return m=v+1,o.abrupt("break",49);case 36:o.next=30;break;case 38:o.next=43;break;case 40:o.prev=40,o.t0=o["catch"](28),b.e(o.t0);case 43:return o.prev=43,b.f(),o.finish(43);case 46:v--,o.next=25;break;case 49:k=r.$refs.rows,k[m].scrollIntoView({block:"center"});case 51:o.next=11;break;case 53:o.next=58;break;case 55:o.prev=55,o.t1=o["catch"](9),u.e(o.t1);case 58:return o.prev=58,u.f(),o.finish(58);case 61:o.next=64;break;case 63:c.scrollIntoView({block:"start"});case 64:case"end":return o.stop()}}),o,null,[[9,55,58,61],[28,40,43,46]])})))()},toHms:function(t){return Object(l["c"])(t)}},computed:{currentPath:function(){var t=this.$route.path;return t.endsWith("/")?t.substr(0,t.length-1):t}},watch:{photos:function(){requestAnimationFrame(this.calculateLayout)}}}),p=d,f=(n("ed8b"),n("2877")),m=n("6544"),v=n.n(m),g=n("132d"),b=Object(f["a"])(p,r,o,!1,null,"4c0043be",null);e["a"]=b.exports;v()(b,{VIcon:g["a"]})},6612:function(t,e,n){},"85ec":function(t,e,n){},"96a9":function(t,e,n){},b0d1:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n("b85c"),o=n("d4ec"),a=n("bee2"),i=(n("d81d"),n("07ac"),n("caad"),function(){function t(e,n,r,a,i,s,c){var u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,p=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};Object(o["a"])(this,t),this.id=e,this.filename=n,this.createDate=r,this.width=a,this.height=i,this.type=s,this.duration=u,this.subType=c,this.classifications=l,this.location=h,this.size=d,this.exif=p}return Object(a["a"])(t,[{key:"ratio",get:function(){return 0===this.height?1:this.width/this.height}}],[{key:"fromObject",value:function(e){var n,o,a=e.id,i=void 0===a?"":a,s=e.filename,c=void 0===s?"":s,u=e.createDate,l=void 0===u?"":u,h=e.width,d=void 0===h?0:h,p=e.height,f=void 0===p?0:p,m=e.type,v=void 0===m?"":m,g=e.subType,b=void 0===g?"":g,y=e.durationMs,w=void 0===y?null:y,x=e.MediaClassifications,k=void 0===x?null:x,S=e.MediaLocation,M=void 0===S?null:S,P=e.bytes,R=void 0===P?"-1":P,D=e.exif,O=void 0===D?{}:D;b=b.toLowerCase(),v=v.toLowerCase();var T=M?{latitude:M.latitude,longitude:M.longitude,altitude:M.altitude,places:null===(n=M.MediaPlaces)||void 0===n||null===(o=n.map)||void 0===o?void 0:o.call(n,(function(t){return{type:t.type,name:t.text}}))}:null,j=k?k.map((function(t){var e,n={},o=Object(r["a"])(t.MediaGlossaries);try{for(o.s();!(e=o.n()).done;){var a=e.value,i=a.level,s=a.text;n[i]={glossary:s,level:i}}}catch(p){o.e(p)}finally{o.f()}var c,u=Object(r["a"])(t.MediaLabels);try{for(u.s();!(c=u.n()).done;){var l=c.value,h=l.level,d=l.text;n[h].labels||(n[h].labels=[]),n[h].labels.push(d)}}catch(p){u.e(p)}finally{u.f()}return{confidence:t.confidence,levels:Object.values(n)}})):null;return new t(i,c,new Date(l),d,f,"image"===v?"photo":"video",["portrait","vr","slomo"].includes(b)?b:"none",w,j,T,isFinite(+R)?+R:null,O)}}]),t}())},cd49:function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),o=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-app",{staticClass:"app"},[r("v-app-bar",{attrs:{elevation:"0",app:"","clipped-left":""}},[r("img",{staticClass:"logo-icon",attrs:{src:n("2252"),alt:"icon"}}),r("v-app-bar-title",{staticClass:"logo-text"},[t._v("Photos")]),r("v-spacer"),r("v-autocomplete",{ref:"search",attrs:{dense:"",solo:"","hide-details":"",label:"Search...","prepend-icon":"mdi-magnify","hide-no-data":"",loading:t.loadingSuggestions,items:t.items,clearable:"","return-object":"","search-input":t.query},on:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.enterPressed(e)},"update:searchInput":function(e){t.query=e},"update:search-input":function(e){t.query=e}},model:{value:t.querySelect,callback:function(e){t.querySelect=e},expression:"querySelect"}}),r("v-spacer"),r("v-menu",{attrs:{"close-on-content-click":!1},scopedSlots:t._u([{key:"activator",fn:function(e){var n=e.on,o=e.attrs;return[r("v-btn",{attrs:{icon:""}},[r("v-icon",t._g(t._b({},"v-icon",o,!1),n),[t._v("mdi-cog-outline")])],1)]}}])},[r("v-list",{attrs:{dense:""}},[r("v-list-item",{attrs:{to:"/settings"}},[r("v-list-item-icon",[r("v-icon",[t._v("mdi-cog")])],1),r("v-list-item-content",[r("v-list-item-title",[t._v("Settings")])],1)],1),r("v-list-item",{attrs:{color:"primary"}},[r("v-list-item-icon",[r("v-icon",[t._v("mdi-brightness-6")])],1),r("v-list-item-content",[r("v-list-item-title",{staticClass:"theme-switch"},[r("span",[t._v("Dark theme")])])],1),r("v-list-item-action",[r("v-switch",{attrs:{dense:"",inset:""},model:{value:t.$vuetify.theme.dark,callback:function(e){t.$set(t.$vuetify.theme,"dark",e)},expression:"$vuetify.theme.dark"}})],1)],1)],1)],1)],1),t.$vuetify.breakpoint.mobile?t._e():r("v-navigation-drawer",{attrs:{"expand-on-hover":!0,permanent:"",app:"",floating:"",clipped:"","hide-overlay":""}},[r("v-list",{attrs:{dense:"",nav:""}},t._l(t.pages,(function(e){return r("v-list-item",{key:e.to,attrs:{exact:"",to:e.to},on:{click:t.scrollToTop}},[r("v-list-item-icon",[r("v-icon",[t._v(t._s(e.icon))])],1),r("v-list-item-content",[r("v-list-item-title",[t._v(t._s(e.name))])],1)],1)})),1)],1),r("v-main",[r("router-view")],1),t.$vuetify.breakpoint.mobile?r("v-bottom-navigation",{attrs:{app:"",shift:""}},t._l(t.pages,(function(e){return r("v-btn",{key:e.to,attrs:{to:e.to},on:{click:t.scrollToTop}},[r("span",[t._v(t._s(e.name))]),r("v-icon",[t._v(t._s(e.icon))])],1)})),1):t._e()],1)},a=[],i=n("b85c"),s=n("2909"),c=n("1da1"),u=(n("96cf"),n("b0c0"),n("ac1f"),n("841c"),n("d81d"),n("caad"),n("2532"),n("99af"),n("4de4"),n("1276"),n("2ca0"),n("c740"),n("1889")),l=r["a"].extend({name:"App",data:function(){return{query:"",querySelect:null,loadingSuggestions:!1,items:[],pages:[{name:"Home",icon:"mdi-home-outline",to:"/"},{name:"Explore",icon:"mdi-magnify",to:"/explore"},{name:"Photo map",icon:"mdi-earth",to:"/map"}]}},mounted:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.$store.getters.isLoggedIn||"Login"===t.$route.name){e.next=3;break}return e.next=3,t.$router.push("/login");case 3:t.$route.params.query&&(t.query=t.$route.params.query,t.items=[t.query],t.querySelect=t.query),console.log(t.$store);case 5:case"end":return e.stop()}}),e)})))()},methods:{scrollToTop:function(){"Home"===this.$route.name&&(console.log('scrollint to top"'),this.$store.commit("scrollToTop",!0))},enterPressed:function(){this.querySelect=this.query;var t=this.$refs.search;t.isMenuActive=!1,this.startSearch()},loadSuggestions:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var n,r,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loadingSuggestions=!0,t.items=[t.query],t.loadingSuggestions=!1,n=t.query,e.next=6,t.$store.dispatch("apiRequest",{url:"photos/suggestions?q=".concat(n)});case 6:r=e.sent,o=r.map((function(t){return t.text})),o.includes(n)||o.unshift(n),t.items=o,console.log(r);case 11:case"end":return e.stop()}}),e)})))()},isDate:function(t){var e=t.toLowerCase(),n=[].concat(Object(s["a"])(u["b"]),Object(s["a"])(u["d"])).map((function(t){return t.toLowerCase()}));if(n.includes(e))return{type:"month",month:n.indexOf(e)%12+1};var r=e.split(/[- _\/]/).filter((function(t){return 0!==t.length}));if(2!==r.length)return{type:"none"};var o=n.includes(r[0]),a=n.includes(r[1]),i=+r[1]>12&&+r[0]<=12;return o&&+r[1]<=31&&+r[1]>=0?{type:"dayMonth",month:n.indexOf(r[0])%12+1,day:+r[1]}:a&&+r[0]<=31&&+r[0]>=0?{type:"dayMonth",month:n.indexOf(r[1])%12+1,day:+r[0]}:i&&+r[0]<=12&&+r[0]>=0&&+r[1]<=31&&+r[1]>=0?{type:"dayMonth",month:+r[0],day:+r[1]}:+r[0]<=31&&+r[0]>=0&&+r[1]<=12&&+r[1]>=0?{type:"dayMonth",month:+r[1],day:+r[0]}:{type:"none"}},isScrubDate:function(t){var e=!isNaN(+t[0]);if(!e){var n,r=!1,o=Object(i["a"])(u["d"]);try{for(o.s();!(n=o.n()).done;){var a=n.value;if(t.startsWith(a)){r=!0;break}}}catch(c){o.e(c)}finally{o.f()}if(!r)return{isDate:!1,date:new Date}}var s=new Date(t);return{isDate:!isNaN(s.getDate()),date:s}},startSearch:function(){if(""!==this.querySelect&&void 0!==this.querySelect&&null!==this.querySelect){var t=null,e=this.isDate(this.querySelect),n=e.type,r=e.month,o=e.day;if(console.log({type:n,month:r,day:o}),"month"===n)t="/date/".concat(u["b"][(null!==r&&void 0!==r?r:1)-1]);else if("dayMonth"===n)t="/date/".concat(o,"/").concat(u["b"][(null!==r&&void 0!==r?r:1)-1]);else{var a=this.isScrubDate(this.querySelect),i=a.isDate,s=a.date;i?t="/?date=".concat(s.getFullYear(),"-").concat(s.getMonth()+1,"-").concat(s.getDate()):this.$route.params.query===this.querySelect?this.$store.dispatch("search",this.querySelect):t=(this.$route.name,"/search/".concat(this.querySelect))}this.$route.path!==t&&null!==t&&this.$router.push(t)}},page:function(){var t=this;return this.pages.findIndex((function(e){return e.to===t.$route.path}))}},watch:{querySelect:function(t){null!==t&&(console.log("Search!",t),console.log(this.querySelect),this.startSearch())},query:function(t){t&&t!==this.querySelect&&this.loadSuggestions()},"$route.params.query":function(){this.query=this.$route.params.query,this.querySelect=this.query}}}),h=l,d=(n("034f"),n("2877")),p=n("6544"),f=n.n(p),m=n("7496"),v=n("40dc"),g=n("bb78"),b=n("c6a6"),y=n("b81c"),w=n("8336"),x=n("132d"),k=n("8860"),S=n("da13"),M=n("1800"),P=n("5d23"),R=n("34c3"),D=n("f6c4"),O=n("e449"),T=n("f774"),j=n("2fa4"),$=n("b73d"),L=Object(d["a"])(h,o,a,!1,null,null,null),q=L.exports;f()(L,{VApp:m["a"],VAppBar:v["a"],VAppBarTitle:g["a"],VAutocomplete:b["a"],VBottomNavigation:y["a"],VBtn:w["a"],VIcon:x["a"],VList:k["a"],VListItem:S["a"],VListItemAction:M["a"],VListItemContent:P["a"],VListItemIcon:R["a"],VListItemTitle:P["c"],VMain:D["a"],VMenu:O["a"],VNavigationDrawer:T["a"],VSpacer:j["a"],VSwitch:$["a"]});var C=n("9483");Object(C["a"])("".concat("/photos/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(t){console.error("Error during service worker registration:",t)}});n("d3b7"),n("3ca3"),n("ddb0"),n("7db0"),n("fb6a"),n("a15b"),n("a630");var E=n("8c4f"),_=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{ref:"home",staticClass:"home",style:{maxHeight:"calc(100vh - "+(t.$vuetify.application.top+t.$vuetify.application.bottom)+"px)"},on:{scroll:t.homeScroll}},[n("router-view"),t.initialLoading?n("div",{staticClass:"progress-center"},[n("v-progress-circular",{attrs:{color:"primary",size:t.$vuetify.breakpoint.width/4,indeterminate:""}})],1):0===t.flatPhotos.length?n("div",{staticClass:"no-results"},[n("div",{staticClass:"no-results-center"},[n("v-icon",{staticClass:"icon",attrs:{"x-large":""}},[t._v("mdi-image")])],1)]):t._e(),n("div",{staticClass:"grid"},[t.topLoaded||t.initialLoading?t._e():n("div",{staticClass:"loading-top"},[n("v-progress-linear",{attrs:{indeterminate:""}})],1),n("photo-grid",{key:t.updatePhotosKey,ref:"photoGrid",attrs:{timeline:"",photos:t.flatPhotos},on:{photoRowsUpdate:t.photoRowsUpdate}}),t.bottomLoaded||t.initialLoading?t._e():n("div",{staticClass:"loading-bottom"},[n("v-progress-linear",{attrs:{indeterminate:""}})],1)],1),n("canvas",{ref:"scrubber",staticClass:"scrubber scrubber-canvas",style:{height:t.canvasHeight+"px"},attrs:{width:100,height:t.canvasHeight}}),n("div",{staticClass:"scrubber scrubber-events",style:{height:t.canvasHeight+"px"},on:{mouseenter:function(e){t.overScrub=!0},mouseleave:function(e){t.overScrub=!1},mousedown:t.scrubStart}})],1)},F=[],I=n("3835"),V=(n("25f0"),n("b680"),n("a434"),n("0481"),n("b0d1")),H=n("5024"),N=n("1a43"),A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],B=new Date,W=r["a"].extend({name:"Home",components:{PhotoGrid:H["a"]},data:function(){return{api:N["a"],photosPerMonth:[],photos:[],homeElement:{},canvas:{},context:{},photoGrid:null,scrollMonthStart:0,scrollLoadPromise:null,scrolling:!1,scrollData:{y:0,year:B.getFullYear(),month:B.getMonth()+1,day:B.getDate()},scrollTimeout:-1,prevScroll:-2e3,scrollThreshold:4e3,gettingPhotos:!1,scrubbing:!1,scrubTimeout:-1,lastScrubTimestamp:-1,overScrub:!1,scrubData:{y:0,year:B.getFullYear(),month:B.getMonth()+1},maxPhotos:800,initialLoading:!0,waitPpm:null,updatePhotosKey:0}},beforeDestroy:function(){document.removeEventListener("mousemove",this.scrubMove),document.removeEventListener("mouseup",this.scrubEnd)},mounted:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var n,r,o,a,i,s,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return document.addEventListener("mousemove",t.scrubMove,!1),document.addEventListener("mouseup",t.scrubEnd,!1),t.canvas=t.$refs.scrubber,t.context=t.canvas.getContext("2d"),t.homeElement=t.$refs.home,n=t.hasDate,null!==n&&null!==localStorage.getItem("initialLoad")&&(r=JSON.parse(localStorage.initialLoad),o=r.ppm,a=r.photos,t.photosPerMonth=o.map((function(t){var e=t.year,n=void 0===e?0:e,r=t.month,o=void 0===r?0:r,a=t.count,i=void 0===a?0:a;return{year:n,month:o,count:i,loaded:!1}})),t.photos=a.map((function(t){return t.map((function(t){return new V["a"](t.id,t.filename,new Date(t.createDate),t.width,t.height,t.type,t.subType,t.duration,t.classifications,t.location,t.size,t.exif)}))})),console.warn("localStorage",t.flatPhotos),t.initialLoading=!1),t.photoGrid=t.$refs.photoGrid,t.waitPpm=t.$store.dispatch("apiRequest",{url:"photos/months"}),e.next=11,t.waitPpm;case 11:if(i=e.sent,t.photosPerMonth=i.map((function(t){var e=t.year,n=void 0===e?0:e,r=t.month,o=void 0===r?0:r,a=t.count,i=void 0===a?0:a;return{year:n,month:o,count:i,loaded:!1}})),s=!1,"HomePhoto"===t.$route.name?s=!0:"Home"===t.$route.name&&null!==n&&(s=!0,t.updateFromDateQuery()),s){e.next=25;break}return e.next=18,t.getPhotos({monthOffset:0});case 18:c=e.sent,t.photos=c,console.warn("mounted requested",t.flatPhotos),0===t.scrollMonthStart&&(localStorage.initialLoad=JSON.stringify({ppm:i,photos:c}),t.updatePhotosKey++),t.photoGrid.$once("photoRowsUpdate",(function(){return t.$nextTick((function(){t.scrollData=t.getScrollData()}))})),e.next=26;break;case 25:t.scrollData=t.getScrollData();case 26:t.initialLoading=!1,t.render();case 28:case"end":return e.stop()}}),e)})))()},methods:{render:function(){requestAnimationFrame(this.render),this.context.clearRect(0,0,this.canvas.width,this.canvas.height);var t=!this.scrubbing&&!this.overScrub;this.drawYears(t),(this.overScrub||this.scrubbing)&&this.drawScrollThumb(this.scrubData.y,this.scrubData.year,this.scrubData.month),this.scrolling&&!this.scrubbing?this.drawScrollThumb(this.scrollData.y,this.scrollData.year,this.scrollData.month,!0):this.scrubbing||this.drawScrollThumb(this.scrollData.y,this.scrollData.year,this.scrollData.month,!0,!1)},drawLoadedRegion:function(){for(var t=0,e=0,n=0;n<this.scrollMonthStart;n++){var r=this.photosPerMonth[n];t+=r.count/this.totalPhotos}for(var o=this.scrollMonthStart;o<this.scrollMonthStart+this.scrollMonthLength;o++){var a=this.photosPerMonth[o];e+=a.count/this.totalPhotos}this.context.fillStyle="rgba(50,255,100,0.3)";var i=50;this.context.fillRect(this.canvas.width-i,t*this.canvas.height,i,e*this.canvas.height)},drawScrollThumb:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=15,i=a+10+3;t<i&&o&&(t=i);var s=this.$vuetify.theme.dark;this.context.fillStyle=this.$vuetify.theme.themes[s?"dark":"light"].primary;var c=r?35:50;if(this.context.fillRect(this.canvas.width-c,t,c,r?2:3),this.context.fillStyle="rgba(255,255,255,0.8)",o){var u="".concat(A[n-1]," ").concat(e),l=this.context.measureText(u),h=l.width;this.context.fillRect(this.canvas.width-h-10,t-a-10,h+10,a+10),this.context.fillStyle="black",this.context.fillText(u,this.canvas.width-h-5,t-a+5)}},drawYears:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.context.fillStyle=t?"rgba(0,0,0,0.5)":"black";var e=0,n=-1,r=12;this.context.font="".concat(r,"px Roboto");for(var o=[],a=this.photosPerMonth.length-1;a>=0;a--){var s=this.photosPerMonth[a];if(s.year!==n){n=s.year;var c=n.toString(),u=this.context.measureText(c),l=u.width,h=this.canvas.height-e,d=function(t){var e,n=Object(i["a"])(o);try{for(n.s();!(e=n.n()).done;){var r=Object(I["a"])(e.value,2),a=r[0],s=r[1];if(t>=a&&t<=s)return!1}}catch(c){n.e(c)}finally{n.f()}return!0};while(!d(h))h+=r;o.push([h,h+r]),this.context.fillText(c,this.canvas.width-l-5,h)}e+=Math.round(s.count/this.totalPhotos*(this.canvas.height-r))}},photoRowsUpdate:function(){this.scrollData=this.getScrollData(),console.log("received event: photoRowsUpdate from photogrid, tranmitting now on Home.vue"),this.$emit("photoRowsUpdate")},scrubStart:function(t){this.scrubbing=!0,this.scrubByEvent(t)},scrubMove:function(t){var e=0,n=0,r=0,o=0;if(this.overScrub||this.scrubbing){var a=this.dateFromScrubEvent(t),i=Object(I["a"])(a,4);e=i[0],n=i[1],r=i[2],o=i[3]}if(this.scrubbing&&this.scrub(e,n,r,o),this.overScrub||this.scrubbing){var s=t.pageY-this.$vuetify.application.top;this.scrubData={y:s,year:o,month:r}}},scrubEnd:function(t){if(this.scrubbing){this.scrubbing=!1,clearTimeout(this.scrubTimeout);var e=this.dateFromScrubEvent(t),n=Object(I["a"])(e,4),r=n[0],o=n[1],a=n[2],i=n[3];this.scrub(r,o,a,i)}},dateFromScrubEvent:function(t){var e=(t.pageY-this.$vuetify.application.top)/(this.$vuetify.breakpoint.height-this.$vuetify.application.top);e=Math.max(0,Math.min(1,1.01*e));var n=this.totalPhotos,r=n*e,o=0,a=0,i=0,s=0,c=0;for(a=0;a<this.photosPerMonth.length;a++){var u=this.photosPerMonth[a];if(o+u.count>=r){s=u.month,c=u.year;var l=new Date(c,s+1,0).getDate(),h=1-(r-o)/u.count;i=Math.floor(l*h);break}o+=u.count}return[a,i,s,c]},scrubByEvent:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,s,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.dateFromScrubEvent(t),o=Object(I["a"])(r,4),a=o[0],i=o[1],s=o[2],c=o[3],n.next=3,e.scrub(a,i,s,c);case 3:case"end":return n.stop()}}),n)})))()},scrub:function(t,e,n,r){var o=arguments,a=this;return Object(c["a"])(regeneratorRuntime.mark((function i(){var s,u,l;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(s=o.length>4&&void 0!==o[4]?o[4]:300,u=!(o.length>5&&void 0!==o[5])||o[5],!(t>=a.scrollMonthStart&&t<a.scrollMonthStart+a.scrollMonthLength)){i.next=8;break}if(console.log("scroll to :",[e,n,r]),!u){i.next=7;break}return i.next=7,a.photoGrid.scrollDateIntoView(e,n,r);case 7:return i.abrupt("return");case 8:if(l=performance.now(),a.lastScrubTimestamp=l,0!==s){i.next=15;break}return i.next=13,a.loadScrubData(t,e,n,r,u);case 13:i.next=16;break;case 15:return i.abrupt("return",new Promise((function(o){a.scrubTimeout=setTimeout(Object(c["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(l!==a.lastScrubTimestamp){i.next=3;break}return i.next=3,a.loadScrubData(t,e,n,r,u);case 3:o();case 4:case"end":return i.stop()}}),i)}))),s)})));case 16:case"end":return i.stop()}}),i)})))()},loadScrubData:function(t,e,n,r){var o=arguments,a=this;return Object(c["a"])(regeneratorRuntime.mark((function i(){var s,c;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return s=!(o.length>4&&void 0!==o[4])||o[4],console.log("scrub to :",[e,n,r]),t=Math.max(0,t-1),i.next=5,a.getPhotos({monthOffset:t,minimumMonths:3});case 5:return c=i.sent,a.scrollMonthStart=t,console.log("start",a.scrollMonthStart,"length",a.scrollMonthLength),a.photos=c,console.warn("scrub",a.flatPhotos),i.abrupt("return",new Promise((function(t){console.log("waiting for photorowsupdate",s,a.photoGrid),a.$once("photoRowsUpdate",(function(){return a.$nextTick((function(){console.log("getting scrolldata and scrolling date into view",e,n,r),a.scrollLoadPromise=a.waitSleep(200),a.scrollData=a.getScrollData(),a.photoGrid.scrollDateIntoView(e,n,r)}))}))})));case 11:case"end":return i.stop()}}),i)})))()},getScrollData:function(){var t=B.getFullYear(),e=B.getMonth()+1,n=B.getDate(),r=this.homeElement.scrollTop+100,o=this.photoGrid.photoRows;if(0===o.length)return{y:0,year:t,month:e,day:n};var a,s=null,c=4,u=Object(i["a"])(o);try{for(u.s();!(a=u.n()).done;){var l,h=a.value,d=h[0].height+c,p=Object(i["a"])(h);try{for(p.s();!(l=p.n()).done;){var f=l.value;if(!f.hideDate){d+=22;break}}}catch(k){p.e(k)}finally{p.f()}if(r-=d,r<=0){s=h;break}}}catch(k){u.e(k)}finally{u.f()}null===s&&(s=o[o.length-1]);var m=new Date(s[0].date);e=m.getMonth()+1,t=m.getFullYear(),n=m.getDate();for(var v=0,g=0;g<this.scrollMonthStart;g++){var b=this.photosPerMonth[g];v+=b.count/this.totalPhotos}r=this.homeElement.scrollTop;var y=this.flatPhotos.length/this.totalPhotos,w=(r+this.homeElement.clientHeight)/this.homeElement.scrollHeight,x=(v+y*w)*this.canvas.height;return{y:x,year:t,month:e,day:n}},homeScroll:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var n,r,o,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.scrolling=!0,clearTimeout(t.scrollTimeout),t.scrollTimeout=setTimeout((function(){return t.scrolling=!1}),1e3),t.scrollData=t.getScrollData(),n=t.homeElement.scrollTop,!(Math.abs(t.prevScroll-n)<180)){e.next=7;break}return e.abrupt("return");case 7:if(t.prevScroll=n,r=t.homeElement.scrollHeight-n-t.homeElement.clientHeight,!(n<3e3||r<3e3)){e.next=15;break}return e.next=12,Promise.race([null===(o=t.scrollLoadPromise)||void 0===o||null===(a=o.then)||void 0===a?void 0:a.call(o,(function(){return!1})),t.waitSleep(10).then((function(){return!0}))]);case 12:i=e.sent,console.log("HOME SCROLL",{scrollTop:n,scrollBottom:r,loading:i}),i||(t.scrollLoadPromise=t.loadScrollData(r,n));case 15:case"end":return e.stop()}}),e)})))()},unloadMonths:function(){var t=this;if(this.flatPhotos.length>this.maxPhotos){var e=this.flatPhotos.length-Math.round(this.maxPhotos/2),n=(this.homeElement.scrollTop+this.homeElement.clientHeight/2)/this.homeElement.scrollHeight,r=this.homeElement.scrollTop,o=this.homeElement.scrollHeight-r-this.homeElement.clientHeight;if(console.log("too many photos! scrollPercent: ".concat(n.toFixed(2),", scrollTop: ").concat(r,", scrollBottom: ").concat(o)),n<.5&&o>this.scrollThreshold){for(var a=0,i=this.scrollMonthStart+this.scrollMonthLength-1;i>=this.scrollMonthStart;i--){if(e-=this.photosPerMonth[i].count,e<=0)break;a++}console.log({removeNMonths:a}),this.photos.splice(this.photos.length-a,a)}else if(n>=.5&&r>this.scrollThreshold){for(var s=0,c=this.scrollMonthStart;c<this.scrollMonthStart+this.photos.length;c++){if(e-=this.photosPerMonth[c].count,e<=0)break;s++}console.log({removeNMonths:s}),this.scrollMonthStart+=s,this.updatePhotosKeepScroll((function(){return t.photos.splice(0,s)}))}}},loadScrollData:function(t,e){var n=this;return Object(c["a"])(regeneratorRuntime.mark((function r(){var o,a,i,c,u;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(!(e<n.scrollThreshold)||n.gettingPhotos){r.next=11;break}if(o=0===n.scrollMonthStart,!o){r.next=4;break}return r.abrupt("return");case 4:return r.next=6,n.getPhotos({monthOffset:n.scrollMonthStart-1,up:!0});case 6:return a=r.sent,n.scrollMonthStart-=a.length,r.next=10,n.updatePhotosKeepScroll((function(){var t;return(t=n.photos).unshift.apply(t,Object(s["a"])(a))}));case 10:n.unloadMonths();case 11:if(!(t<n.scrollThreshold)||n.gettingPhotos){r.next=22;break}if(c=n.scrollMonthStart+n.scrollMonthLength===n.photosPerMonth.length,!c){r.next=15;break}return r.abrupt("return");case 15:return r.next=17,n.getPhotos({monthOffset:n.scrollMonthStart+n.scrollMonthLength});case 17:return u=r.sent,(i=n.photos).push.apply(i,Object(s["a"])(u)),r.next=21,n.waitForLayoutUpdate();case 21:n.unloadMonths();case 22:case"end":return r.stop()}}),r)})))()},updatePhotosKeepScroll:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,s,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=null!==(r=e.homeElement.scrollHeight)&&void 0!==r?r:0,a=e.homeElement.scrollTop+e.homeElement.clientHeight,t(),n.next=5,e.waitForLayoutUpdate();case 5:i=0,s=e.homeElement.scrollHeight,a>s&&(i=a-e.homeElement.scrollTop),c=s-o,e.homeElement.scrollBy({top:c+i,left:0});case 10:case"end":return n.stop()}}),n)})))()},waitForLayoutUpdate:function(){var t=this;return new Promise((function(e){t.$once("photoRowsUpdate",(function(){return t.$nextTick((function(){e()}))}))}))},getPhotos:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,s,c,u,l,h,d,p,f;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=t.requestMinimum,o=void 0===r?50:r,a=t.monthOffset,i=void 0===a?0:a,s=t.minimumMonths,c=void 0===s?0:s,u=t.up,l=void 0!==u&&u,e.gettingPhotos=!0,h=[],d=i;case 4:if(!(l?d>=0:d<e.photosPerMonth.length)){n.next=13;break}if(p=e.photosPerMonth[d],h.push(p),o-=p.count,!(o<0&&h.length>=c)){n.next=10;break}return n.abrupt("break",13);case 10:d+=l?-1:1,n.next=4;break;case 13:return console.log("Requesting months",h.map((function(t){return[t.year,t.month].join(", ")}))),n.next=16,e.$store.dispatch("apiRequest",{url:"photos/month-photos",body:{months:h.map((function(t){return[t.year,t.month]}))}});case 16:return f=n.sent,l&&(f=f.reverse()),e.gettingPhotos=!1,n.abrupt("return",f.map((function(t){return t.map(V["a"].fromObject)})));case 20:case"end":return n.stop()}}),n)})))()},scrubIntoView:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(null!==t){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,e.waitPpm;case 4:return n.next=6,e.scrubToDate(t.createDate);case 6:return n.next=8,e.photoGrid.scrollMediaIntoView(t);case 8:return n.next=10,e.homeScroll();case 10:case"end":return n.stop()}}),n)})))()},scrubToDate:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,s,c,u,l,h,d;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.waitPpm;case 2:r=t.getDate(),o=t.getMonth()+1,a=t.getFullYear(),i=12*a+(o-1),s=1/0,c=-1,u=0;case 9:if(!(u<e.photosPerMonth.length)){n.next=25;break}if(l=e.photosPerMonth[u],l.month!==o||l.year!==a){n.next=14;break}return c=u,n.abrupt("break",25);case 14:if(h=12*l.year+(l.month-1),d=Math.abs(h-i),!(d<s)){n.next=21;break}s=d,c=u,n.next=22;break;case 21:return n.abrupt("break",25);case 22:u++,n.next=9;break;case 25:if(-1!==c){n.next=27;break}return n.abrupt("return",console.warn("cant keep in view, date",t,"not in photosPerMonth",e.photosPerMonth));case 27:return console.log("scrub to date",c,r,o,a,e.photosPerMonth[c]),n.next=30,e.scrub(c,r,o,a,0);case 30:case"end":return n.stop()}}),n)})))()},updateFromDateQuery:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.hasDate,null!==n){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,t.scrubToDate(n);case 5:return e.abrupt("return",!0);case 6:case"end":return e.stop()}}),e)})))()},reloadPhotos:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("apiRequest",{url:"photos/months"});case 2:return n=e.sent,t.photosPerMonth=n.map((function(t){var e=t.year,n=void 0===e?0:e,r=t.month,o=void 0===r?0:r,a=t.count,i=void 0===a?0:a;return{year:n,month:o,count:i,loaded:!1}})),e.next=6,t.getPhotos({monthOffset:t.scrollMonthStart,minimumMonths:t.scrollMonthLength});case 6:t.photos=e.sent,console.warn("reloadPhotos",t.flatPhotos);case 8:case"end":return e.stop()}}),e)})))()},waitSleep:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return new Promise((function(e){return setTimeout(e,t)}))}},computed:{hasDate:function(){if(void 0===this.$route.query.date||null===this.$route.query.date)return null;console.log("date string",this.$route.query.date);var t=new Date(this.$route.query.date);return isNaN(t.getDate())?null:(console.log("home date changed",t),t)},topLoaded:function(){return 0===this.scrollMonthStart},bottomLoaded:function(){return this.scrollMonthStart+this.scrollMonthLength===this.photosPerMonth.length},scrollMonthLength:function(){return this.photos.length},flatPhotos:function(){return this.photos.flat()},canvasHeight:function(){return this.$vuetify.breakpoint.height-this.$vuetify.application.top-this.$vuetify.application.bottom},totalPhotos:function(){var t,e=0,n=Object(i["a"])(this.photosPerMonth);try{for(n.s();!(t=n.n()).done;){var r=t.value;e+=r.count}}catch(o){n.e(o)}finally{n.f()}return e}},watch:{"$store.state.reloadPhotos":function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.$store.state.reloadPhotos){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.reloadPhotos();case 4:t.$store.commit("reloadPhotos",!1);case 5:case"end":return e.stop()}}),e)})))()},"$route.query.date":function(){this.updateFromDateQuery()},"$store.state.keepInView":function(){this.scrubIntoView(this.$store.state.keepInView)},"$store.state.scrollToTop":function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.$store.state.scrollToTop){e.next=2;break}return e.abrupt("return");case 2:if(t.$store.commit("scrollToTop",!1),console.log("trying to scroll to top"),0!==t.photosPerMonth.length){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,t.scrubToDate(new Date);case 8:return e.next=10,t.reloadPhotos();case 10:case"end":return e.stop()}}),e)})))()},flatPhotos:function(){this.$store.commit("viewerQueue",this.flatPhotos)}}}),U=W,J=(n("4814"),n("490a")),Y=n("8e36"),G=Object(d["a"])(U,_,F,!1,null,"38da7ede",null),z=G.exports;f()(G,{VIcon:x["a"],VProgressCircular:J["a"],VProgressLinear:Y["a"]}),r["a"].use(E["a"]);var K=[{path:"/",name:"Home",component:z,meta:{title:"Photos - Ruurd Photos"},children:[{meta:{title:"Photo - Ruurd Photos"},path:"/photo/:id",name:"HomePhoto",component:function(){return n.e("chunk-32b10c6e").then(n.bind(null,"6ec5"))}}]},{path:"/search/:query",name:"Search",meta:{title:":query - Ruurd Photos"},component:function(){return n.e("chunk-5b589200").then(n.bind(null,"2d3b"))},children:[{meta:{title:"Photo - Ruurd Photos"},path:"/search/:query/photo/:id",name:"SearchPhoto",component:function(){return n.e("chunk-32b10c6e").then(n.bind(null,"6ec5"))}}]},{path:"/date/:month",name:"DateMonth",meta:{title:":month - Ruurd Photos"},component:function(){return n.e("chunk-6a0d8bb6").then(n.bind(null,"3a43"))},children:[{meta:{title:"Photo - Ruurd Photos"},path:"/date/:month/photo/:id",name:"DateMonthPhoto",component:function(){return n.e("chunk-32b10c6e").then(n.bind(null,"6ec5"))}}]},{path:"/date/:day/:month",name:"DateDay",meta:{title:":day :month - Ruurd Photos"},component:function(){return n.e("chunk-6a0d8bb6").then(n.bind(null,"3a43"))},children:[{meta:{title:"Photo - Ruurd Photos"},path:"/date/:day/:month/photo/:id",name:"DateDayPhoto",component:function(){return n.e("chunk-32b10c6e").then(n.bind(null,"6ec5"))}}]},{path:"/explore",name:"Explore",meta:{title:"Explore - Ruurd Photos"},component:function(){return n.e("chunk-d05f20e6").then(n.bind(null,"7797"))}},{path:"/login",name:"Login",meta:{title:"Login - Ruurd Photos"},component:function(){return n.e("chunk-5e08b530").then(n.bind(null,"a55b"))}}],Q=new E["a"]({routes:K});Q.beforeEach((function(t,e,n){console.log({to:t,from:e,next:n});var r=t.matched.slice().reverse().find((function(t){return t.meta&&t.meta.title})),o=e.matched.slice().reverse().find((function(t){return t.meta&&t.meta.metaTags})),a=null;if(r?a=r.meta.title:o&&(a=o.meta.title),null!==a){for(var i=a.split(" "),s=0;s<i.length;s++)if(i[s].startsWith(":")){var c=i[s].substr(1);c.length>0&&t.params.hasOwnProperty(c)&&(i[s]=t.params[c])}document.title=i.join(" ")}Array.from(document.querySelectorAll("[data-vue-router-controlled]")).map((function(t){var e;return null===(e=t.parentNode)||void 0===e?void 0:e.removeChild(t)})),n()}));var X=Q,Z=n("5530"),tt=n("2f62"),et=n("bfa9"),nt=new et["a"]({reducer:function(t){return{email:t.email,password:t.password,verifiedLogin:t.verifiedLogin,showInfo:t.showInfo}},storage:window.localStorage});r["a"].use(tt["a"]);var rt=new tt["a"].Store({state:{api:N["a"],reloadPhotos:!1,scrollToTop:!1,searchResultsHigh:[],searchResultsLow:[],dateResults:[],email:"",password:"",viewerQueue:[],keepInView:null,showInfo:!0},getters:{isLoggedIn:function(t){return""!==t.email&&""!==t.password}},mutations:{showInfo:function(t,e){return t.showInfo=e},reloadPhotos:function(t,e){return t.reloadPhotos=e},scrollToTop:function(t,e){return t.scrollToTop=e},keepInView:function(t,e){return t.keepInView=e},viewerQueue:function(t,e){return t.viewerQueue=e},dateResults:function(t,e){return t.dateResults=e},searchResultsHigh:function(t,e){return t.searchResultsHigh=e},searchResultsLow:function(t,e){return t.searchResultsLow=e},login:function(t,e){var n=e.email,r=e.password;t.email=n,t.password=r}},actions:{apiRequest:function(){var t=Object(c["a"])(regeneratorRuntime.mark((function t(e,n){var r,o,a,i,s,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.state,o=e.getters,a=n.url,i=n.body,s=void 0===i?{}:i,o.isLoggedIn){t.next=4;break}return t.abrupt("return",{loggedIn:!1,result:null});case 4:return t.next=6,fetch("".concat(r.api,"/").concat(a),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object(Z["a"])({auth:{email:r.email,password:r.password}},s))}).then((function(t){return t.text()}));case 6:return c=t.sent,t.prev=7,t.abrupt("return",JSON.parse(c));case 11:return t.prev=11,t.t0=t["catch"](7),console.warn("Can't parse",{url:a,txt:c}),t.abrupt("return",null);case 15:case"end":return t.stop()}}),t,null,[[7,11]])})));function e(e,n){return t.apply(this,arguments)}return e}(),checkLogin:function(t,e){return Object(c["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.state,o=t.commit,a=e.email,i=e.password,n.next=4,fetch("".concat(r.api,"/auth"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth:{email:a,password:i}})}).then((function(t){return t.json()}));case 4:return s=n.sent,o("login",{email:a,password:i}),n.abrupt("return",s);case 7:case"end":return n.stop()}}),n)})))()},dateSearch:function(t,e){return Object(c["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,s,c,u,l;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.dispatch,o=t.commit,t.state,a=e.day,i=void 0===a?null:a,s=e.month,c=void 0===s?null:s,n.next=4,r("apiRequest",{url:"photos/dateSearch?m=".concat(c,"&d=").concat(i)});case 4:u=n.sent,l=u.map(V["a"].fromObject),o("dateResults",l);case 7:case"end":return n.stop()}}),n)})))()},search:function(t,e){return Object(c["a"])(regeneratorRuntime.mark((function n(){var r,o,a,i,s,c,u;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=t.dispatch,o=t.commit,t.state,n.next=3,r("apiRequest",{url:"photos/search?q=".concat(e)});case 3:a=n.sent,console.log("search result",a.map((function(t){return t.rank}))),i=a.map((function(t){return t.rank})).reduce((function(t,e){return t+e}),0)/a.length,console.log(i),s=Math.min(i,1.2),c=a.filter((function(t){return t.rank<s})).map(V["a"].fromObject),u=a.filter((function(t){return t.rank>=s})).map(V["a"].fromObject),o("searchResultsLow",c),o("searchResultsHigh",u);case 12:case"end":return n.stop()}}),n)})))()}},modules:{},plugins:[nt.plugin]}),ot=n("f309");r["a"].use(ot["a"]);var at=new ot["a"]({theme:{themes:{dark:{primary:"#5996d1"},light:{primary:"#318bd5"}}}}),it=n("a4a1"),st=n.n(it);n("f6b9");r["a"].config.productionTip=!1,r["a"].use(st.a),new r["a"]({router:X,store:rt,vuetify:at,render:function(t){return t(q)}}).$mount("#app")},ed8b:function(t,e,n){"use strict";n("96a9")}});
//# sourceMappingURL=app.c85dbef5.js.map