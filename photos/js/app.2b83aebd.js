(function(t){function e(e){for(var n,o,s=e[0],c=e[1],u=e[2],l=0,h=[];l<s.length;l++)o=s[l],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&h.push(a[o][0]),a[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);p&&p(e);while(h.length)h.shift()();return i.push.apply(i,u||[]),r()}function r(){for(var t,e=0;e<i.length;e++){for(var r=i[e],n=!0,o=1;o<r.length;o++){var s=r[o];0!==a[s]&&(n=!1)}n&&(i.splice(e--,1),t=c(c.s=r[0]))}return t}var n={},o={app:0},a={app:0},i=[];function s(t){return c.p+"js/"+({}[t]||t)+"."+{"chunk-704590ec":"8276b1d6","chunk-a519ce8c":"a2ce60b3"}[t]+".js"}function c(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,c),r.l=!0,r.exports}c.e=function(t){var e=[],r={"chunk-704590ec":1,"chunk-a519ce8c":1};o[t]?e.push(o[t]):0!==o[t]&&r[t]&&e.push(o[t]=new Promise((function(e,r){for(var n="css/"+({}[t]||t)+"."+{"chunk-704590ec":"2efca91c","chunk-a519ce8c":"0e539c7e"}[t]+".css",a=c.p+n,i=document.getElementsByTagName("link"),s=0;s<i.length;s++){var u=i[s],l=u.getAttribute("data-href")||u.getAttribute("href");if("stylesheet"===u.rel&&(l===n||l===a))return e()}var h=document.getElementsByTagName("style");for(s=0;s<h.length;s++){u=h[s],l=u.getAttribute("data-href");if(l===n||l===a)return e()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=e,p.onerror=function(e){var n=e&&e.target&&e.target.src||a,i=new Error("Loading CSS chunk "+t+" failed.\n("+n+")");i.code="CSS_CHUNK_LOAD_FAILED",i.request=n,delete o[t],p.parentNode.removeChild(p),r(i)},p.href=a;var d=document.getElementsByTagName("head")[0];d.appendChild(p)})).then((function(){o[t]=0})));var n=a[t];if(0!==n)if(n)e.push(n[2]);else{var i=new Promise((function(e,r){n=a[t]=[e,r]}));e.push(n[2]=i);var u,l=document.createElement("script");l.charset="utf-8",l.timeout=120,c.nc&&l.setAttribute("nonce",c.nc),l.src=s(t);var h=new Error;u=function(e){l.onerror=l.onload=null,clearTimeout(p);var r=a[t];if(0!==r){if(r){var n=e&&("load"===e.type?"missing":e.type),o=e&&e.target&&e.target.src;h.message="Loading chunk "+t+" failed.\n("+n+": "+o+")",h.name="ChunkLoadError",h.type=n,h.request=o,r[1](h)}a[t]=void 0}};var p=setTimeout((function(){u({type:"timeout",target:l})}),12e4);l.onerror=l.onload=u,document.head.appendChild(l)}return Promise.all(e)},c.m=t,c.c=n,c.d=function(t,e,r){c.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(c.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)c.d(r,n,function(e){return t[e]}.bind(null,n));return r},c.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(e,"a",e),e},c.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},c.p="/photos/",c.oe=function(t){throw console.error(t),t};var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=e,u=u.slice();for(var h=0;h<u.length;h++)e(u[h]);var p=l;i.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("cd49")},"034f":function(t,e,r){"use strict";r("85ec")},"0360":function(t,e,r){"use strict";r("5a92")},"1a43":function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var n="http://localhost:3000"},"230c":function(t,e,r){"use strict";r("f1ae")},5024:function(t,e,r){"use strict";var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{ref:"frame",staticClass:"photo-grid"},t._l(t.photoRows,(function(e){return r("div",{ref:"rows",refInFor:!0,staticClass:"block-row"},t._l(e,(function(e){return r("div",{staticClass:"photo-block"},[r("div",{staticClass:"block-day",class:{"hide-date":e.hideDate},style:{maxWidth:Math.floor(e.width)+"px"},attrs:{title:e.day}},[t._v(" "+t._s(e.day)+" ")]),r("div",{staticClass:"photos"},t._l(e.photos,(function(e){return r("div",{staticClass:"photo",style:{height:e.visualHeight+"px",width:e.visualWidth+"px"}},["image"===e.type?r("div",{style:{backgroundImage:"url("+t.api+"/photo/small/"+e.id+".webp)"},attrs:{src:t.api+"/photo/small/"+e.id+".webp",alt:e.filename}}):r("video",{ref:"video"+e.id,refInFor:!0,attrs:{poster:t.api+"/photo/small/"+e.id+".webp",muted:"",loop:"",src:t.api+"/photo/webm/"+e.id+".webm"},domProps:{muted:!0},on:{mouseleave:function(r){return t.pauseVideo(e.id)},mouseenter:function(r){return t.playVideo(e.id)}}})])})),0)])})),0)})),0)},o=[],a=r("b85c"),i=r("3835"),s=r("1da1"),c=(r("d81d"),r("fb6a"),r("96cf"),r("2b0e")),u=r("1a43"),l=c["a"].extend({name:"PhotoGrid",props:{photos:{type:Array,required:!0},directPhotosUpdate:{type:Boolean,default:!1},timeline:{type:Boolean,default:!1}},data:function(){return{photoRows:[],frameWidth:window.innerWidth-256,api:u["a"]}},beforeDestroy:function(){window.removeEventListener("resize",this.onResize)},mounted:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.updateFrameWidth(),e.next=3,t.calculateLayout();case 3:window.addEventListener("resize",t.onResize,!1);case 4:case"end":return e.stop()}}),e)})))()},methods:{calculateLayout:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var r,n,o,s,c,u,l,h,p,d,f,m,v,g,b,w,y,x,S,k,O,M,j,P,R,D,T,$,L,E,C,_,q,F,V,A,I,H,N,W,B,G,U,Y,J,z,K,Q,X,Z,tt,et,rt,nt,ot,at,it,st,ct,ut,lt,ht;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=t.photos,0!==r.length){e.next=4;break}return t.photoRows=[],e.abrupt("return");case 4:t.updateFrameWidth(),n=(new Date).getFullYear(),o=(new Date).toDateString(),s=new Date((new Date).getTime()-864e5).toDateString(),c=function(t){var e=new Date(t),r=e.toDateString(),a=e.getMonth()+1,i=e.getTime();return r===o?["Today",a,i]:r===s?["Yesterday",a,i]:e.getFullYear()===n?[r.substr(0,r.length-5),a,i]:[r,a,i]},u=c(r[0].createDate),l=Object(i["a"])(u,3),h=l[0],p=l[1],d=l[2],f=[],m={day:h,month:p,date:d,photos:[]},v=Object(a["a"])(r);try{for(v.s();!(g=v.n()).done;)b=g.value,w=c(b.createDate),y=Object(i["a"])(w,3),x=y[0],S=y[1],k=y[2],m.day!==x&&(f.push(m),m={day:x,month:S,photos:[],date:k}),m.photos.push(b)}catch(pt){v.e(pt)}finally{v.f()}for(f.push(m),O=t.frameWidth,M=150+Math.min(window.innerWidth/30,64),j=[],P=[],R={photos:[],day:h,month:p,date:d,width:0,height:0,hideDate:!1},D=0,T=0,$=0,L=f;$<L.length;$++){E=L[$],C=E.day,_=E.month,q=Object(a["a"])(E.photos);try{for(q.s();!(F=q.n()).done;)V=F.value,V.ratio=V.width/V.height,A=M*V.ratio,I=D+A,H=O-D,N=E.photos.length,W=_!==R.month,B=C!==R.day,G=I>O||B&&H-A<100||B&&N>3||B&&T>3||t.timeline&&W,(G||B)&&(R.photos.length>0&&P.push(R),R={photos:[],day:C,width:0,height:0,hideDate:G&&!B,month:_,date:E.date},G&&(P.length>0&&j.push(P),P=[],D=0)),D+=A,R.photos.push(V)}catch(pt){q.e(pt)}finally{q.f()}T=E.photos.length}for(P.push(R),j.push(P),U=5,Y=40,J=0,z=j;J<z.length;J++){K=z[J],Q=[],X=Object(a["a"])(K);try{for(X.s();!(Z=X.n()).done;)tt=Z.value,tt.width=tt.photos.map((function(t){return t.ratio*M})).reduce((function(t,e){return t+e})),Q.push(tt.width)}catch(pt){X.e(pt)}finally{X.f()}et=Q.reduce((function(t,e){return t+e})),rt=K.map((function(t){return(t.photos.length-1)*U})),nt=(K.length-1)*Y,ot=rt.reduce((function(t,e){return t+e}))+nt,at=(O-ot)/et,at>2.1&&(at=1),it=Object(a["a"])(K);try{for(it.s();!(st=it.n()).done;){ct=st.value,ct.height=M*at,ut=Object(a["a"])(ct.photos);try{for(ut.s();!(lt=ut.n()).done;)ht=lt.value,ht.visualHeight=M*at,ht.visualWidth=M*ht.ratio*at}catch(pt){ut.e(pt)}finally{ut.f()}}}catch(pt){it.e(pt)}finally{it.f()}}t.photoRows=j;case 29:case"end":return e.stop()}}),e)})))()},onResize:function(){requestAnimationFrame(this.calculateLayout)},updateFrameWidth:function(){var t,e;this.frameWidth=null!==(t=null===(e=this.$refs.frame)||void 0===e?void 0:e.clientWidth)&&void 0!==t?t:window.innerWidth-this.$vuetify.application.left},playVideo:function(t){var e,r,n=null===(e=this.$refs["video"+t])||void 0===e?void 0:e[0];null===n||void 0===n||null===(r=n.play)||void 0===r||r.call(n)},pauseVideo:function(t){var e,r,n=null===(e=this.$refs["video"+t])||void 0===e?void 0:e[0];null===n||void 0===n||null===(r=n.pause)||void 0===r||r.call(n)},scrollIntoView:function(t,e,r){var n=new Date;n.setFullYear(r),n.setMonth(e-1),n.setDate(t);var o=n.getTime(),a=this.photoRows;while(1){var i=Math.floor(a.length/2),s=a[i][0].date;if(a=o<s?a.slice(i):a.slice(0,i),1===a.length)break}var c=this.$refs.rows;console.log("Scrolling into view",t,e,r),c[this.photoRows.indexOf(a[0])].scrollIntoView()}},computed:{},watch:{photos:function(){this.directPhotosUpdate?this.calculateLayout():requestAnimationFrame(this.calculateLayout),this.$emit("photosUpdate")}}}),h=l,p=(r("230c"),r("2877")),d=Object(p["a"])(h,n,o,!1,null,"66802d02",null);e["a"]=d.exports},"5a92":function(t,e,r){},"73b2":function(t,e,r){t.exports=r.p+"img/transparent-icon-512.e6e999bf.png"},"85ec":function(t,e,r){},cd49:function(t,e,r){"use strict";r.r(e);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("2b0e"),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",{staticClass:"app"},[n("v-app-bar",{attrs:{elevation:"0",app:"","clipped-left":""}},[n("img",{staticClass:"logo-icon",attrs:{src:r("73b2"),alt:"icon"}}),n("v-app-bar-title",{staticClass:"logo-text"},[t._v("Photos")]),n("v-spacer"),n("v-text-field",{attrs:{dense:"",solo:"","hide-details":"",label:"Search...","append-icon":"mdi-magnify"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.startSearch(e)}},model:{value:t.$route.query.q,callback:function(e){t.$set(t.$route.query,"q",e)},expression:"$route.query.q"}}),n("v-spacer"),n("v-btn",{attrs:{icon:""}},[n("v-icon",[t._v("mdi-cog")])],1)],1),n("v-navigation-drawer",{attrs:{"expand-on-hover":!0,permanent:"",app:"",floating:"",clipped:"","hide-overlay":""}},[n("v-list",{attrs:{dense:"",nav:""}},[n("v-list-item",{attrs:{to:"/",exact:""}},[n("v-list-item-icon",[n("v-icon",[t._v("mdi-home-outline")])],1),n("v-list-item-content",[n("v-list-item-title",[t._v("Photos")])],1)],1),n("v-list-item",{attrs:{to:"/explore",exact:""}},[n("v-list-item-icon",[n("v-icon",[t._v("mdi-earth")])],1),n("v-list-item-content",[n("v-list-item-title",[t._v("Explore")])],1)],1),n("v-list-item",{attrs:{to:"/map",exact:""}},[n("v-list-item-icon",[n("v-icon",[t._v("mdi-map-marker-circle")])],1),n("v-list-item-content",[n("v-list-item-title",[t._v("Photo map")])],1)],1)],1)],1),n("v-main",[n("router-view")],1)],1)},a=[],i=r("1da1"),s=(r("96cf"),r("b0c0"),n["a"].extend({name:"App",data:function(){return{}},mounted:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.$store.getters.isLoggedIn||"Login"===t.$route.name){e.next=3;break}return e.next=3,t.$router.push("/login");case 3:console.log(t.$store);case 4:case"end":return e.stop()}}),e)})))()},methods:{startSearch:function(){console.log(this.$route.query.q),"Search"===this.$route.name?this.$store.dispatch("search",this.$route.query.q):this.$router.push({query:{q:this.$route.query.q},path:"/search"})}}})),c=s,u=(r("034f"),r("2877")),l=r("6544"),h=r.n(l),p=r("7496"),d=r("40dc"),f=r("bb78"),m=r("8336"),v=r("132d"),g=r("8860"),b=r("da13"),w=r("5d23"),y=r("34c3"),x=r("f6c4"),S=r("f774"),k=r("2fa4"),O=r("8654"),M=Object(u["a"])(c,o,a,!1,null,null,null),j=M.exports;h()(M,{VApp:p["a"],VAppBar:d["a"],VAppBarTitle:f["a"],VBtn:m["a"],VIcon:v["a"],VList:g["a"],VListItem:b["a"],VListItemContent:w["a"],VListItemIcon:y["a"],VListItemTitle:w["b"],VMain:x["a"],VNavigationDrawer:S["a"],VSpacer:k["a"],VTextField:O["a"]});var P=r("9483");Object(P["a"])("".concat("/photos/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(t){console.error("Error during service worker registration:",t)}});r("d3b7"),r("3ca3"),r("ddb0");var R=r("8c4f"),D=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{ref:"home",staticClass:"home",on:{scroll:t.homeScroll}},[r("photo-grid",{ref:"photoGrid",staticClass:"grid",attrs:{timeline:"","direct-photos-update":t.directUpdate,photos:t.photos}}),r("canvas",{ref:"scrubber",staticClass:"scrubber",attrs:{width:100,height:t.canvasHeight}}),r("div",{staticClass:"scrubber scrubber-events",on:{mouseenter:function(e){t.overScrub=!0},mouseleave:function(e){t.overScrub=!1},mousedown:t.scrubStart}})],1)},T=[],$=r("2909"),L=r("b85c"),E=r("3835"),C=(r("99af"),r("25f0"),r("d81d"),r("a15b"),r("0481"),r("5024")),_=r("1a43"),q=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],F=new Date,V=n["a"].extend({name:"Home",components:{PhotoGrid:C["a"]},data:function(){return{directUpdate:!1,photosPerMonth:[],photos:[],api:_["a"],homeElement:{},photoGrid:null,scrollMonthStart:0,scrollMonthLength:0,gettingPhotos:!1,scrollLoadPromise:null,scrubbing:!1,canvas:{},context:{},scrubTimeout:-1,lastScrubTimestamp:-1,overScrub:!1,scrubData:{y:0,year:F.getFullYear(),month:F.getMonth()+1},scrolling:!1,scrollData:{y:0,year:F.getFullYear(),month:F.getMonth()+1},scrollTimeout:-1,prevScroll:-2e3}},beforeDestroy:function(){document.removeEventListener("mousemove",this.scrubMove),document.removeEventListener("mouseup",this.scrubEnd)},mounted:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var r,n,o,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return document.addEventListener("mousemove",t.scrubMove,!1),document.addEventListener("mouseup",t.scrubEnd,!1),t.canvas=t.$refs.scrubber,t.context=t.canvas.getContext("2d"),e.next=6,t.$store.dispatch("apiRequest",{url:"photos/months"});case 6:return t.photosPerMonth=e.sent,e.next=9,t.getPhotos({monthOffset:0});case 9:r=e.sent,n=Object(E["a"])(r,2),o=n[0],a=n[1],t.photos=o,t.scrollMonthLength=a,t.homeElement=t.$refs.home,t.photoGrid=t.$refs.photoGrid,t.render(),t.photoGrid.$once("photosUpdate",(function(){return t.$nextTick((function(){t.scrollData=t.getScrollData()}))}));case 19:case"end":return e.stop()}}),e)})))()},methods:{render:function(){requestAnimationFrame(this.render);var t=!this.scrubbing&&!this.overScrub;this.resetCanvas(t),this.overScrub||this.scrubbing?this.drawScrollThumb(this.scrubData.y,this.scrubData.year,this.scrubData.month):this.scrolling?this.drawScrollThumb(this.scrollData.y,this.scrollData.year,this.scrollData.month,!0):this.drawScrollThumb(this.scrollData.y,this.scrollData.year,this.scrollData.month,!0,!1)},drawScrollThumb:function(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=15,i=a+10+3;t<i&&(t=i);var s=this.$vuetify.theme.dark;this.context.fillStyle=this.$vuetify.theme.themes[s?"dark":"light"].primary;var c=n?35:50;if(this.context.fillRect(this.canvas.width-c,t,c,n?2:3),this.context.fillStyle="rgba(255,255,255,0.8)",o){var u="".concat(q[r-1]," ").concat(e),l=this.context.measureText(u),h=l.width;this.context.fillRect(this.canvas.width-h-10,t-a-10,h+10,a+10),this.context.fillStyle="black",this.context.fillText(u,this.canvas.width-h-5,t-a+5)}},resetCanvas:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];console.log({greyedYears:t}),this.context.fillStyle=t?"rgba(0,0,0,0.5)":"black",this.context.clearRect(0,0,this.canvas.width,this.canvas.height);var e=0,r=-1,n=12;this.context.font="".concat(n,"px Roboto");var o,a=Object(L["a"])(this.photosPerMonth);try{for(a.s();!(o=a.n()).done;){var i=o.value;if(i.year!==r){r=i.year;var s=r.toString(),c=this.context.measureText(s),u=c.width;this.context.fillText(s,this.canvas.width-u-5,e+n)}e+=Math.round(i.count/this.totalPhotos*(this.canvas.height-n))}}catch(l){a.e(l)}finally{a.f()}},scrubStart:function(t){this.scrubbing=!0,this.scrubByEvent(t)},scrubMove:function(t){var e=0,r=0,n=0,o=0;if(this.overScrub||this.scrubbing){var a=this.dateFromScrubEvent(t),i=Object(E["a"])(a,4);e=i[0],r=i[1],n=i[2],o=i[3]}if(this.scrubbing&&this.scrub(e,r,n,o),this.overScrub||this.scrubbing){var s=t.pageY-this.$vuetify.application.top;this.scrubData={y:s,year:o,month:n}}},scrubEnd:function(t){if(this.scrubbing){this.scrubbing=!1,clearTimeout(this.scrubTimeout);var e=this.dateFromScrubEvent(t),r=Object(E["a"])(e,4),n=r[0],o=r[1],a=r[2],i=r[3];this.loadScrubData(n,o,a,i)}},dateFromScrubEvent:function(t){var e=(t.pageY-this.$vuetify.application.top)/(this.$vuetify.breakpoint.height-this.$vuetify.application.top);e=Math.max(0,Math.min(1,1.01*e));var r=this.totalPhotos,n=r*e,o=0,a=0,i=0,s=0,c=0;for(a=0;a<this.photosPerMonth.length;a++){var u=this.photosPerMonth[a];if(o+u.count>=n){s=u.month,c=u.year;var l=new Date(c,s+1,0).getDate(),h=1-(n-o)/u.count;i=Math.floor(l*h);break}o+=u.count}return[a,i,s,c]},scrubByEvent:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,o,a,i,s,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=e.dateFromScrubEvent(t),o=Object(E["a"])(n,4),a=o[0],i=o[1],s=o[2],c=o[3],r.next=3,e.scrub(a,i,s,c);case 3:case"end":return r.stop()}}),r)})))()},scrub:function(t,e,r,n){var o=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!(t>=o.scrollMonthStart&&t<o.scrollMonthStart+o.scrollMonthLength)){a.next=4;break}return console.log("scroll to :",[e,r,n]),o.photoGrid.scrollIntoView(e,r,n),a.abrupt("return");case 4:i=performance.now(),o.lastScrubTimestamp=i,o.scrubTimeout=setTimeout((function(){i===o.lastScrubTimestamp&&o.loadScrubData(t,e,r,n)}),300);case 7:case"end":return a.stop()}}),a)})))()},loadScrubData:function(t,e,r,n){var o=this;return Object(i["a"])(regeneratorRuntime.mark((function a(){var i,s,c,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return console.log("scrub to :",[e,r,n]),a.next=3,o.getPhotos({monthOffset:Math.max(0,t)});case 3:i=a.sent,s=Object(E["a"])(i,2),c=s[0],u=s[1],o.scrollMonthStart=t,o.scrollMonthLength=u,console.log("start",o.scrollMonthStart,"length",o.scrollMonthLength),o.directUpdate=!0,o.photos=c,o.scrollLoadPromise=new Promise((function(t){return setTimeout(t,200)})),o.photoGrid.$once("photosUpdate",(function(){return o.$nextTick((function(){o.photoGrid.scrollIntoView(e,r,n)}))}));case 14:case"end":return a.stop()}}),a)})))()},getScrollData:function(){var t=F.getFullYear(),e=F.getMonth()+1,r=this.homeElement.scrollTop+100,n=this.photoGrid.photoRows;if(0===n.length)return{y:0,year:t,month:e};var o,a=null,i=4,s=Object(L["a"])(n);try{for(s.s();!(o=s.n()).done;){var c,u=o.value,l=u[0].height+i,h=Object(L["a"])(u);try{for(h.s();!(c=h.n()).done;){var p=c.value;if(!p.hideDate){l+=22;break}}}catch(y){h.e(y)}finally{h.f()}if(r-=l,r<=0){a=u;break}}}catch(y){s.e(y)}finally{s.f()}null===a&&(a=n[n.length-1]);var d=new Date(a[0].date);e=d.getMonth()+1,t=d.getFullYear();for(var f=0,m=0;m<this.scrollMonthStart;m++){var v=this.photosPerMonth[m];f+=v.count/this.totalPhotos}r=this.homeElement.scrollTop;var g=this.photos.length/this.totalPhotos,b=(r+this.homeElement.clientHeight)/this.homeElement.scrollHeight,w=(f+g*b)*this.canvas.height;return{y:w,year:t,month:e}},homeScroll:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.scrolling=!0,clearTimeout(t.scrollTimeout),t.scrollTimeout=setTimeout((function(){return t.scrolling=!1}),1e3),t.scrollData=t.getScrollData(),r=t.homeElement.scrollTop,!(Math.abs(t.prevScroll-r)<180)){e.next=7;break}return e.abrupt("return");case 7:if(t.prevScroll=r,n=t.homeElement.scrollHeight-r-t.homeElement.clientHeight,!(r<2e3||n<2e3)){e.next=13;break}return e.next=12,t.scrollLoadPromise;case 12:t.scrollLoadPromise=t.loadScrollData(n,r);case 13:case"end":return e.stop()}}),e)})))()},loadScrollData:function(t,e){var r=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var o,a,i,s,c,u,l,h,p,d,f,m,v,g,b;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!(e<2e3)||r.gettingPhotos){n.next=17;break}if(i=0===r.scrollMonthStart,!i){n.next=4;break}return n.abrupt("return");case 4:return n.next=6,r.getPhotos({monthOffset:r.scrollMonthStart-1,up:!0});case 6:s=n.sent,c=Object(E["a"])(s,2),u=c[0],l=c[1],r.scrollMonthStart-=l,r.scrollMonthLength+=l,h=r.$refs.home,p=null!==(o=h.scrollHeight)&&void 0!==o?o:0,r.directUpdate=!0,(a=r.photos).unshift.apply(a,Object($["a"])(u)),r.photoGrid.$once("photosUpdate",(function(){return r.$nextTick((function(){var t;r.directUpdate=!1;var e=(null!==(t=h.scrollHeight)&&void 0!==t?t:0)-p;h.scrollBy({top:e,left:0})}))}));case 17:if(!(t<2e3)||r.gettingPhotos){n.next=29;break}if(f=r.scrollMonthStart+r.scrollMonthLength===r.photosPerMonth.length,!f){n.next=21;break}return n.abrupt("return");case 21:return n.next=23,r.getPhotos({monthOffset:r.scrollMonthStart+r.scrollMonthLength});case 23:m=n.sent,v=Object(E["a"])(m,2),g=v[0],b=v[1],r.scrollMonthLength+=b,(d=r.photos).push.apply(d,Object($["a"])(g));case 29:case"end":return n.stop()}}),n)})))()},getPhotos:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,o,a,i,s,c,u,l,h,p;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:n=t.requestMinimum,o=void 0===n?80:n,a=t.monthOffset,i=void 0===a?0:a,s=t.up,c=void 0!==s&&s,e.gettingPhotos=!0,u=[],l=i;case 4:if(!(c?l>=0:l<e.photosPerMonth.length)){r.next=13;break}if(h=e.photosPerMonth[l],u.push(h),o-=h.count,!(o<0)){r.next=10;break}return r.abrupt("break",13);case 10:l+=c?-1:1,r.next=4;break;case 13:return console.log("Requesting months",u.map((function(t){return[t.year,t.month].join(", ")}))),r.next=16,e.$store.dispatch("apiRequest",{url:"photos/month-photos",body:{months:u.map((function(t){return[t.year,t.month]}))}});case 16:return p=r.sent,c&&(p=p.reverse()),e.gettingPhotos=!1,r.abrupt("return",[p.flat(),u.length]);case 20:case"end":return r.stop()}}),r)})))()}},computed:{canvasHeight:function(){return this.$vuetify.breakpoint.height-this.$vuetify.application.top-this.$vuetify.application.bottom},totalPhotos:function(){var t,e=0,r=Object(L["a"])(this.photosPerMonth);try{for(r.s();!(t=r.n()).done;){var n=t.value;e+=n.count}}catch(o){r.e(o)}finally{r.f()}return e}}}),A=V,I=(r("0360"),Object(u["a"])(A,D,T,!1,null,"4dc01d74",null)),H=I.exports;n["a"].use(R["a"]);var N=[{path:"/",name:"Home",component:H},{path:"/search",name:"Search",component:function(){return r.e("chunk-a519ce8c").then(r.bind(null,"2d3b"))}},{path:"/login",name:"Login",component:function(){return r.e("chunk-704590ec").then(r.bind(null,"a55b"))}}],W=new R["a"]({routes:N}),B=W,G=r("5530"),U=r("2f62"),Y=r("bfa9"),J=new Y["a"]({reducer:function(t){return{email:t.email,password:t.password,verifiedLogin:t.verifiedLogin}},storage:window.localStorage});n["a"].use(U["a"]);var z=new U["a"].Store({state:{api:_["a"],searchResults:[],email:"",password:""},getters:{isLoggedIn:function(t){return""!==t.email&&""!==t.password}},mutations:{searchResults:function(t,e){return t.searchResults=e},login:function(t,e){var r=e.email,n=e.password;t.email=r,t.password=n}},actions:{apiRequest:function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(e,r){var n,o,a,i,s,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.state,o=e.getters,a=r.url,i=r.body,s=void 0===i?{}:i,o.isLoggedIn){t.next=4;break}return t.abrupt("return",{loggedIn:!1,result:null});case 4:return t.next=6,fetch("".concat(n.api,"/").concat(a),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object(G["a"])({auth:{email:n.email,password:n.password}},s))}).then((function(t){return t.text()}));case 6:return c=t.sent,t.prev=7,t.abrupt("return",JSON.parse(c));case 11:return t.prev=11,t.t0=t["catch"](7),console.warn("Can't parse",{url:a,txt:c}),t.abrupt("return",null);case 15:case"end":return t.stop()}}),t,null,[[7,11]])})));function e(e,r){return t.apply(this,arguments)}return e}(),checkLogin:function(t,e){return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,o,a,i,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=t.state,o=t.commit,a=e.email,i=e.password,r.next=4,fetch("".concat(n.api,"/auth"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({auth:{email:a,password:i}})}).then((function(t){return t.json()}));case 4:return s=r.sent,o("login",{email:a,password:i}),r.abrupt("return",s);case 7:case"end":return r.stop()}}),r)})))()},search:function(t,e){return Object(i["a"])(regeneratorRuntime.mark((function r(){var n,o,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n=t.dispatch,o=t.commit,t.state,r.next=3,n("apiRequest",{url:"photos/search?q=".concat(e)});case 3:a=r.sent,o("searchResults",a);case 5:case"end":return r.stop()}}),r)})))()}},modules:{},plugins:[J.plugin]}),K=r("f309");n["a"].use(K["a"]);var Q=new K["a"]({theme:{themes:{dark:{primary:"#5996d1"},light:{primary:"#318bd5"}}}});n["a"].config.productionTip=!1,new n["a"]({router:B,store:z,vuetify:Q,render:function(t){return t(j)}}).$mount("#app")},f1ae:function(t,e,r){}});
//# sourceMappingURL=app.2b83aebd.js.map